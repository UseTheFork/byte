
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="https://moonraker.readthedocs.io/en/latest/configuration/#configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://moonraker.readthedocs.io/en/latest/" title="Moonraker" class="md-header__button md-logo" aria-label="Moonraker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Moonraker
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Configuration
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="light-blue" aria-label="Switch to Dark Mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to Dark Mode" for="__palette_1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue" aria-label="Switch to Light Mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to Light Mode" for="__palette_0" hidden="">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required="">
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="https://moonraker.readthedocs.io/en/latest/configuration/?q=" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard="" data-clipboard-text="javascript:void(0)" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0">
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">Type to start searching</div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Arksine/moonraker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
  </div>
  <div class="md-source__repository md-source__repository--active">
    GitHub
  <ul class="md-source__facts"><li class="md-source__fact md-source__fact--version">v0.1.0</li><li class="md-source__fact md-source__fact--stars">1.4k</li><li class="md-source__fact md-source__fact--forks">505</li></ul></div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" style="top: 53px;">
                <div class="md-sidebar__scrollwrap" style="height: 340px;">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://moonraker.readthedocs.io/en/latest/" title="Moonraker" class="md-nav__button md-logo" aria-label="Moonraker" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>

    </a>
    Moonraker
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Arksine/moonraker" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
  </div>
  <div class="md-source__repository md-source__repository--active">
    GitHub
  <ul class="md-source__facts"><li class="md-source__fact md-source__fact--version">v0.1.0</li><li class="md-source__fact md-source__fact--stars">1.4k</li><li class="md-source__fact md-source__fact--forks">505</li></ul></div>
</a>
    </div>
  
  <ul class="md-nav__list">
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="https://moonraker.readthedocs.io/en/latest/configuration/" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc">
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#server" class="md-nav__link">
    <span class="md-ellipsis">
      [server]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#file_manager" class="md-nav__link">
    <span class="md-ellipsis">
      [file_manager]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#machine" class="md-nav__link">
    <span class="md-ellipsis">
      [machine]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[machine]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#allowed-services" class="md-nav__link">
    <span class="md-ellipsis">
      Allowed Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#reboot-shutdown-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Reboot / Shutdown from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#database" class="md-nav__link">
    <span class="md-ellipsis">
      [database]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#data_store" class="md-nav__link">
    <span class="md-ellipsis">
      [data_store]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#job_queue" class="md-nav__link">
    <span class="md-ellipsis">
      [job_queue]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#announcements" class="md-nav__link">
    <span class="md-ellipsis">
      [announcements]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#webcam" class="md-nav__link">
    <span class="md-ellipsis">
      [webcam]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      [authorization]
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#optional-components" class="md-nav__link">
    <span class="md-ellipsis">
      Optional Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      [analysis]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#ldap" class="md-nav__link">
    <span class="md-ellipsis">
      [ldap]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#octoprint_compat" class="md-nav__link">
    <span class="md-ellipsis">
      [octoprint_compat]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#paneldue" class="md-nav__link">
    <span class="md-ellipsis">
      [paneldue]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#power" class="md-nav__link">
    <span class="md-ellipsis">
      [power]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[power]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#options-common-to-all-power-devices" class="md-nav__link">
    <span class="md-ellipsis">
      Options common to all power devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#gpio-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      GPIO Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#klipper-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Klipper Device Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Klipper Device Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#gcode-macro-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      Gcode Macro Restrictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#rf-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      RF Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#tplink-smartplug-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      TPLink Smartplug Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#tasmota-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Tasmota Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#shelly-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Shelly Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#homeseer-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Homeseer Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#home-assistant-configuration-http" class="md-nav__link">
    <span class="md-ellipsis">
      Home Assistant Configuration (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#loxone-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Loxone Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      MQTT Device Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MQTT Device Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#discarding-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Discarding Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#smartthings-http" class="md-nav__link">
    <span class="md-ellipsis">
      SmartThings (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#domoticz-http" class="md-nav__link">
    <span class="md-ellipsis">
      Domoticz (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#hue-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Hue Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#usb-uhubctl-devices" class="md-nav__link">
    <span class="md-ellipsis">
      USB (uhubctl) devices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="USB (uhubctl) devices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#generic-http-devices" class="md-nav__link">
    <span class="md-ellipsis">
      Generic HTTP Devices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generic HTTP Devices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-template-context" class="md-nav__link">
    <span class="md-ellipsis">
      The template context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-request-object" class="md-nav__link">
    <span class="md-ellipsis">
      The HTTP Request object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-response-object" class="md-nav__link">
    <span class="md-ellipsis">
      The HTTP Response object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#toggling-device-state-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Toggling device state from Klipper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Toggling device state from Klipper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#power-on-a-device-when-a-print-starts" class="md-nav__link">
    <span class="md-ellipsis">
      Power on a device when a print starts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#force-a-power-device-to-change-state-during-a-print" class="md-nav__link">
    <span class="md-ellipsis">
      Force a power device to change state during a print
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#power-on-g-code-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      Power on G-Code Uploads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#external-power-events" class="md-nav__link">
    <span class="md-ellipsis">
      External Power Events
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#update_manager" class="md-nav__link">
    <span class="md-ellipsis">
      [update_manager]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[update_manager]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#extension-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Extension Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-release_infojson-file" class="md-nav__link">
    <span class="md-ellipsis">
      The release_info.json file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#web-type-front-end-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Web type (front-end) configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#git-repo-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Git Repo Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#zip-application-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Zip Application Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#executable-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Executable Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#python-application-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Python Application Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python Application Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-optional-python-release_info-file" class="md-nav__link">
    <span class="md-ellipsis">
      The optional python release_info file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-system-dependencies-file-format" class="md-nav__link">
    <span class="md-ellipsis">
      The System Dependencies File Format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt" class="md-nav__link">
    <span class="md-ellipsis">
      [mqtt]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[mqtt]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#publishing-topics-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing topics from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#wled" class="md-nav__link">
    <span class="md-ellipsis">
      [wled]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#zeroconf" class="md-nav__link">
    <span class="md-ellipsis">
      [zeroconf]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#button" class="md-nav__link">
    <span class="md-ellipsis">
      [button]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[button]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#button-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Button Templates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#secrets" class="md-nav__link">
    <span class="md-ellipsis">
      [secrets]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[secrets]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#accessing-secret-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing secret credentials
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#notifier" class="md-nav__link">
    <span class="md-ellipsis">
      [notifier]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[notifier]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#an-example" class="md-nav__link">
    <span class="md-ellipsis">
      An example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#notifying-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Notifying from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#simplyprint" class="md-nav__link">
    <span class="md-ellipsis">
      [simplyprint]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#sensor" class="md-nav__link">
    <span class="md-ellipsis">
      [sensor]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[sensor]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#options-common-to-all-sensor-devices" class="md-nav__link">
    <span class="md-ellipsis">
      Options common to all sensor devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-sensor-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      MQTT Sensor Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#spoolman" class="md-nav__link">
    <span class="md-ellipsis">
      [spoolman]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[spoolman]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#setting-the-active-spool-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Setting the active spool from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#include-directives" class="md-nav__link">
    <span class="md-ellipsis">
      Include directives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#jinja2-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja2 Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#option-moved-deprecations" class="md-nav__link">
    <span class="md-ellipsis">
      Option Moved Deprecations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Documentation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Documentation
          </label>
          <ul class="md-nav__list">
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1">
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    External API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            External API
          </label>
          <ul class="md-nav__list">
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server Administration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/printer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Printer Administration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Administration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/file_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/authorization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authorization and Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/database/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Database Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/job_queue/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Job Queue Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/history/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Job History Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/announcements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Announcements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/webcams/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Webcam Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/update_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/devices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Switches, Sensors, and Devices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/integrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Third Party Integrations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/extensions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extensions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/external_api/jsonrpc_notifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON-RPC Notifications
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/printer_objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Printer Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Components
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contribution Guidelines
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://moonraker.readthedocs.io/en/latest/changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" style="top: 53px;">
                <div class="md-sidebar__scrollwrap" style="height: 340px;">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc">
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#core-components" class="md-nav__link">
    <span class="md-ellipsis">
      Core Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#server" class="md-nav__link">
    <span class="md-ellipsis">
      [server]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#file_manager" class="md-nav__link">
    <span class="md-ellipsis">
      [file_manager]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#machine" class="md-nav__link">
    <span class="md-ellipsis">
      [machine]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[machine]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#allowed-services" class="md-nav__link">
    <span class="md-ellipsis">
      Allowed Services
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#reboot-shutdown-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Reboot / Shutdown from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#database" class="md-nav__link">
    <span class="md-ellipsis">
      [database]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#data_store" class="md-nav__link">
    <span class="md-ellipsis">
      [data_store]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#job_queue" class="md-nav__link">
    <span class="md-ellipsis">
      [job_queue]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#announcements" class="md-nav__link">
    <span class="md-ellipsis">
      [announcements]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#webcam" class="md-nav__link">
    <span class="md-ellipsis">
      [webcam]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#authorization" class="md-nav__link">
    <span class="md-ellipsis">
      [authorization]
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#optional-components" class="md-nav__link">
    <span class="md-ellipsis">
      Optional Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optional Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      [analysis]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#ldap" class="md-nav__link">
    <span class="md-ellipsis">
      [ldap]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#octoprint_compat" class="md-nav__link">
    <span class="md-ellipsis">
      [octoprint_compat]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#paneldue" class="md-nav__link">
    <span class="md-ellipsis">
      [paneldue]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#power" class="md-nav__link">
    <span class="md-ellipsis">
      [power]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[power]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#options-common-to-all-power-devices" class="md-nav__link">
    <span class="md-ellipsis">
      Options common to all power devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#gpio-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      GPIO Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#klipper-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Klipper Device Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Klipper Device Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#gcode-macro-restrictions" class="md-nav__link">
    <span class="md-ellipsis">
      Gcode Macro Restrictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#rf-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      RF Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#tplink-smartplug-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      TPLink Smartplug Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#tasmota-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Tasmota Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#shelly-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Shelly Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#homeseer-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Homeseer Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#home-assistant-configuration-http" class="md-nav__link">
    <span class="md-ellipsis">
      Home Assistant Configuration (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#loxone-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Loxone Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      MQTT Device Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MQTT Device Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#discarding-responses" class="md-nav__link">
    <span class="md-ellipsis">
      Discarding Responses
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#smartthings-http" class="md-nav__link">
    <span class="md-ellipsis">
      SmartThings (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#domoticz-http" class="md-nav__link">
    <span class="md-ellipsis">
      Domoticz (HTTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#hue-device-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Hue Device Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#usb-uhubctl-devices" class="md-nav__link">
    <span class="md-ellipsis">
      USB (uhubctl) devices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="USB (uhubctl) devices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#generic-http-devices" class="md-nav__link">
    <span class="md-ellipsis">
      Generic HTTP Devices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Generic HTTP Devices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-template-context" class="md-nav__link">
    <span class="md-ellipsis">
      The template context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-request-object" class="md-nav__link">
    <span class="md-ellipsis">
      The HTTP Request object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-response-object" class="md-nav__link">
    <span class="md-ellipsis">
      The HTTP Response object
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#toggling-device-state-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Toggling device state from Klipper
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Toggling device state from Klipper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#power-on-a-device-when-a-print-starts" class="md-nav__link">
    <span class="md-ellipsis">
      Power on a device when a print starts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#force-a-power-device-to-change-state-during-a-print" class="md-nav__link">
    <span class="md-ellipsis">
      Force a power device to change state during a print
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#power-on-g-code-uploads" class="md-nav__link">
    <span class="md-ellipsis">
      Power on G-Code Uploads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#external-power-events" class="md-nav__link">
    <span class="md-ellipsis">
      External Power Events
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#update_manager" class="md-nav__link">
    <span class="md-ellipsis">
      [update_manager]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[update_manager]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#extension-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Extension Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-release_infojson-file" class="md-nav__link">
    <span class="md-ellipsis">
      The release_info.json file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#web-type-front-end-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Web type (front-end) configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#git-repo-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Git Repo Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#zip-application-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Zip Application Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#executable-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Executable Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#python-application-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Python Application Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Python Application Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-optional-python-release_info-file" class="md-nav__link">
    <span class="md-ellipsis">
      The optional python release_info file
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-system-dependencies-file-format" class="md-nav__link">
    <span class="md-ellipsis">
      The System Dependencies File Format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt" class="md-nav__link">
    <span class="md-ellipsis">
      [mqtt]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[mqtt]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#publishing-topics-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Publishing topics from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#wled" class="md-nav__link">
    <span class="md-ellipsis">
      [wled]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#zeroconf" class="md-nav__link">
    <span class="md-ellipsis">
      [zeroconf]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#button" class="md-nav__link">
    <span class="md-ellipsis">
      [button]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[button]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#button-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Button Templates
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#secrets" class="md-nav__link">
    <span class="md-ellipsis">
      [secrets]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[secrets]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#accessing-secret-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing secret credentials
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#notifier" class="md-nav__link">
    <span class="md-ellipsis">
      [notifier]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[notifier]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#an-example" class="md-nav__link">
    <span class="md-ellipsis">
      An example:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#notifying-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Notifying from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#simplyprint" class="md-nav__link">
    <span class="md-ellipsis">
      [simplyprint]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#sensor" class="md-nav__link">
    <span class="md-ellipsis">
      [sensor]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[sensor]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#options-common-to-all-sensor-devices" class="md-nav__link">
    <span class="md-ellipsis">
      Options common to all sensor devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-sensor-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      MQTT Sensor Configuration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#spoolman" class="md-nav__link">
    <span class="md-ellipsis">
      [spoolman]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="[spoolman]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#setting-the-active-spool-from-klipper" class="md-nav__link">
    <span class="md-ellipsis">
      Setting the active spool from Klipper
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#include-directives" class="md-nav__link">
    <span class="md-ellipsis">
      Include directives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#jinja2-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Jinja2 Templates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#option-moved-deprecations" class="md-nav__link">
    <span class="md-ellipsis">
      Option Moved Deprecations
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="configuration">Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#configuration" title="Permanent link"></a></h1>
<p>This document describes Moonraker's full configuration. By default Moonraker
loads the configuration file from <code>~/moonraker.conf</code>, however prebuilt
images such as MainsailOS and FluiddPi configure Moonraker to load the
configuration from <code>~/printer_data/config/moonraker.conf</code>.</p>
<p>As this document references configuration for both Klipper (<code>printer.cfg</code>)
and Moonraker (<code>moonraker.conf</code>), each example contains a comment indicating
which configuration file is being referenced A basic
<a href="https://moonraker.readthedocs.io/en/latest/moonraker.conf">sample configuration</a> in the <code>docs</code> directory.</p>
<p>Moonraker uses an ini style configuration very close to that of Klipper.
Comments are supported and may be specified by either a <code>#</code> or <code>;</code> character.
Inline comments are also supported and are evaluated according to the following
rules:</p>
<ul>
<li>At least one whitespace character must separate the configuration data and the
  comment specifier.</li>
<li>Specifiers that are not preceded by whitespace will be considered part of
  the configuration.</li>
<li>If it is necessary for a value to include whitespace followed by one
  of the comment specifiers, the specifier may be escaped using a backslash,
  ie: <code>\#</code>.</li>
<li>Only specifiers preceded by whitespace may be escaped.</li>
</ul>
<p>For example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_0"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_0 &gt; code"></button><code><span class="c1"># This is a comment</span>
<span class="na">[section_name] # This is a comment</span>
<span class="na">opt_one</span><span class="o">:</span><span class="w"> </span><span class="s">http://this.is/</span><span class="c1">#not-a-comment</span>
<span class="na">opt_two</span><span class="o">:</span><span class="w"> </span><span class="s">This is also \</span><span class="c1"># not a comment</span>
<span class="na">opt_three</span><span class="o">:</span><span class="w"> </span><span class="s">This is the value</span><span class="w"> </span><span class="c1"># this is a comment</span>
<span class="na">opt_four</span><span class="o">:</span><span class="w"> </span><span class="s">Once again\</span><span class="c1"># not a comment</span>
</code></pre></div>
<ul>
<li>Option <code>opt_one</code> resolves to a value of <code>http://this.is/#not-a-comment</code>.
  The <code>#</code> is not preceded by whitespace and not evaluated as an inline comment.</li>
<li>Option <code>opt_two</code>, resolves to a value of <code>This is also # not a comment</code>.  The
  <code>\#</code> is evaluated as valid escape sequence.  The backslash is removed and the
  resulting <code>#</code> is stored in the value.</li>
<li>Option <code>opt_three</code> resolves to a value of <code>This is the value</code>.  The comment
  specifier is preceded by whitespace, thus the remainder of the line is
  evaluated as a comment and removed from the option.</li>
<li>Option <code>opt_four</code> resolves to a value of <code>Once again\# not a comment</code>.
  The <code>\</code> character is not preceded by whitespace and not evaluated as
  an escape sequence, thus the escape character is not removed from the value.</li>
</ul>
<p>Moonraker uses strict parsing rules.  A configuration file may not
contain multiple sections of the same name.  A section may not contain
multiple options of the same name.   However, configuration files included
using <a href="https://moonraker.readthedocs.io/en/latest/configuration/#include-directives">include directives</a> may contain sections
specified in other files, and those sections may contain options
specified in other files.</p>
<h2 id="core-components">Core Components<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#core-components" title="Permanent link"></a></h2>
<p>Moonraker's core components are always loaded regardless of configuration.</p>
<h3 id="server"><code>[server]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#server" title="Permanent link"></a></h3>
<p>The <code>[server]</code> section provides essential configuration for Moonraker.
This section is required.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_1"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_1 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="k">[server]</span>
<span class="na">host</span><span class="o">:</span><span class="w"> </span><span class="s">0.0.0.0</span>
<span class="c1">#  The host address in which to bind the HTTP server.  Default is to bind</span>
<span class="c1">#  to all ipv4 interfaces.  If set to "all" the server will bind to all</span>
<span class="c1">#  ipv4 an ipv6 interfaces.</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">7125</span>
<span class="c1">#   The port the HTTP server will listen on.  Default is 7125</span>
<span class="na">ssl_port</span><span class="o">:</span><span class="w"> </span><span class="s">7130</span>
<span class="c1">#   The port to listen on for SSL (HTTPS) connections.  Note that the HTTPS</span>
<span class="c1">#   server will only be started of the certificate and key options outlined</span>
<span class="c1">#   below are provided.  The default is 7130.</span>
<span class="na">klippy_uds_address</span><span class="o">:</span><span class="w"> </span><span class="s">/tmp/klippy_uds</span>
<span class="c1">#   The address of Unix Domain Socket used to communicate with Klippy. This</span>
<span class="c1">#   option accepts Jinja2 Templates, where the configured data path is</span>
<span class="c1">#   passed to the template context, for example:</span>
<span class="c1">#     klippy_uds_address: {data_path}/comms/klippy.sock</span>
<span class="c1">#</span>
<span class="c1">#   Default is /tmp/klippy_uds.</span>
<span class="na">route_prefix</span><span class="o">:</span>
<span class="c1">#   A prefix prepended to the path for each HTTP endpoint.  For example</span>
<span class="c1">#   if the route_prefix is set to moonraker/printer1, then the server info</span>
<span class="c1">#   endpoint is available at:</span>
<span class="c1">#     http://myprinter.local/moonraker/printer1/server/info</span>
<span class="c1">#</span>
<span class="c1">#   This is primarily useful for installations that feature multiple instances</span>
<span class="c1">#   of Moonraker, as it allows a reverse proxy identify the correct instance based</span>
<span class="c1">#   on the path and redirect requests without a rewrite.  Note that frontends must feature</span>
<span class="c1">#   support for HTTP endpoints with a route prefix to communicate with Moonraker when</span>
<span class="c1">#   this option is set. The default is no route prefix.</span>
<span class="na">max_upload_size</span><span class="o">:</span><span class="w"> </span><span class="s">1024</span>
<span class="c1">#   The maximum size allowed for a file upload (in MiB).  Default is 1024 MiB.</span>
<span class="na">max_websocket_connections</span><span class="o">:</span>
<span class="c1">#   The maximum number of concurrently open websocket connections.</span>
<span class="c1">#   The default is 50.</span>
<span class="na">enable_debug_logging</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   ***DEPRECATED***</span>
<span class="c1">#   Verbose logging is enabled by the '-v' command line option.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previously the <code>[server]</code> section contained <code>ssl_certificate_path</code> and
<code>ssl_key_path</code> options. These options are now deprecated, as both locations
are determined by the <code>data path</code> and <code>alias</code> configured on the command
line, ie <code>&lt;data_file_path&gt;/certs/&lt;alias&gt;.cert</code>.  By default the certificate
path resolves to <code>$HOME/moonraker_data/certs/moonraker.cert</code> and the key
path resolves to <code>$HOME/moonraker_data/certs/moonraker.key</code>.  Both files
may be symbolic links.</p>
</div>
<h3 id="file_manager"><code>[file_manager]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#file_manager" title="Permanent link"></a></h3>
<p>The <code>file_manager</code> section provides configuration for Moonraker's file
management functionality.  If omitted defaults will be used.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_2"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_2 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>
<span class="na">queue_gcode_uploads</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   When set to True the file manager will add uploads to the job_queue when</span>
<span class="c1">#   the `start_print` flag has been set.  The default if False.</span>
<span class="na">check_klipper_config_path</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   By default Moonraker will validate that Klipper's configuration file exists</span>
<span class="c1">#   within the data path's "config" folder, as this is a requirement for</span>
<span class="c1">#   Moonraker to write to the configuration.  If this validation check fails</span>
<span class="c1">#   Moonraker will warn the user. Installations that do not wish to use Moonraker</span>
<span class="c1">#   to manage Klipper's configuration may set this option to False to bypass the</span>
<span class="c1">#   location check.  The default is True.</span>
<span class="na">enable_object_processing</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   When set to True gcode files will be run through a "preprocessor"</span>
<span class="c1">#   during metadata extraction if object tags are detected.  This preprocessor</span>
<span class="c1">#   replaces object tags with G-Code commands compatible with Klipper's</span>
<span class="c1">#   "cancel object" functionality.  Note that this process is file I/O intensive,</span>
<span class="c1">#   it is not recommended for usage on low resource SBCs such as a Pi Zero.</span>
<span class="c1">#   The default is False.</span>
<span class="na">file_system_observer</span><span class="o">:</span><span class="w"> </span><span class="s">inotify</span>
<span class="c1">#   The observer used to monitor file system changes.  May be inotify or none.</span>
<span class="c1">#   When set to none file system observation is disabled.  The default is</span>
<span class="c1">#   inotify.</span>
<span class="na">enable_observer_warnings</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   When set to True Moonraker will generate warnings when an observer</span>
<span class="c1">#   encounters an error. This may be useful to determine if the observer</span>
<span class="c1">#   malfunctioning. The default is True.</span>
<span class="na">enable_inotify_warnings</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   *** DEPRECATED - SEE "enable_observer_warnings" ***</span>
<span class="c1">#   When set to True Moonraker will generate warnings when inotify attempts</span>
<span class="c1">#   to add a duplicate watch or when inotify encounters an error.  On some</span>
<span class="c1">#   file systems inotify may not work as expected, this gives users the</span>
<span class="c1">#   option to suppress warnings when necessary.  The default is True.</span>
<span class="na">enable_config_write_access</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   When enabled the configuration folder is writable over the API.  Some</span>
<span class="c1">#   installations, such as those in public areas, may wish to lock out</span>
<span class="c1">#   configuration changes.  The default is True.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Previously the <code>[file_manager]</code> section contained <code>config_path</code> and
<code>log_path</code> options. These options are now deprecated, as both locations
are determined by the <code>data path</code> configured on the command line.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is also possible to enable object processing directly in the slicer.
See the <a href="https://github.com/kageurufu/cancelobject-preprocessor">preprocess-cancellation</a>
documentation for details.</p>
</div>
<h3 id="machine"><code>[machine]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#machine" title="Permanent link"></a></h3>
<p>The <code>machine</code> section provides configuration for Moonraker's machine component, which
is responsible for for collecting "machine" (ie: PC, SBC, etc) data and communicating
with system services such as systemd.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_3"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_3 &gt; code"></button><code><span class="c1"># moonraker.conf</span>
<span class="k">[machine]</span>
<span class="na">provider</span><span class="o">:</span><span class="w"> </span><span class="s">systemd_dbus</span>
<span class="c1">#   The provider implementation used to collect system service information</span>
<span class="c1">#   and run service actions (ie: start, restart, stop).  This can be "none",</span>
<span class="c1">#   "supervisord_cli", "systemd_dbus", or "systemd_cli".  If the provider is</span>
<span class="c1">#   set to "none" service action APIs will be disabled.</span>
<span class="c1">#   The default is systemd_dbus.</span>
<span class="na">shutdown_action</span><span class="o">:</span><span class="w"> </span><span class="s">poweroff</span>
<span class="c1">#   Determines the action Moonraker will take when a shutdown is requested.</span>
<span class="c1">#   This option may be set to "halt" or "poweroff. Not all linux distributions</span>
<span class="c1">#   support poweroff, in such scenarios it is necessary to specify 'halt'.</span>
<span class="c1">#   The default is "poweroff".</span>
<span class="na">sudo_password</span><span class="o">:</span>
<span class="c1">#   The password for the linux user.  When set Moonraker can run linux commands</span>
<span class="c1">#   that require elevated permissions.  This option accepts Jinja2 Templates,</span>
<span class="c1">#   see the [secrets] section for details.  It is strongly recommended to only</span>
<span class="c1">#   set this option when required and to use the aforementioned secrets module</span>
<span class="c1">#   when doing so.  The default is no sudo password is set.</span>
<span class="na">validate_service</span><span class="o">:</span>
<span class="c1">#   Enables validation of Moonraker's systemd service unit.  If Moonraker</span>
<span class="c1">#   detects that a change is necessary it will attempt to do so.  Custom</span>
<span class="c1">#   installations and installations that do systemd should set this to False.</span>
<span class="c1">#   The default is True.</span>
<span class="na">validate_config</span><span class="o">:</span>
<span class="c1">#   Enables validation of Moonraker's configuration.  If Moonraker detects</span>
<span class="c1">#   deprecated options it will attempt to correct them.  The default is True.</span>
<span class="na">force_validation</span><span class="o">:</span>
<span class="c1">#   By default Moonraker will not attempt to revalidate if a previous attempt</span>
<span class="c1">#   at validation successfully completed. Setting this value to True will force</span>
<span class="c1">#   Moonraker to perform validation.  The default is False.</span>
<span class="na">supervisord_config_path</span><span class="o">:</span>
<span class="c1">#   Path to the supervisord config file. This is required when for multiple</span>
<span class="c1">#   supervisord are instances running on single machine and the default</span>
<span class="c1">#  '/var/run/supervisord.sock' is occupied by other services.</span>
<span class="c1">#   The default is no path.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a href="https://moonraker.readthedocs.io/en/latest/installation/#policykit-permissions">install documentation</a> for
details on PolicyKit permissions when using the DBus provider.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Some distributions (ie: DietPi) disable and mask the <code>systemd-logind</code>
service.  This service is necessary for the DBus provider to issue
<code>reboot</code> and <code>shutdown</code> commands.  In this scenario, Moonraker will fall
back to CLI based <code>reboot</code> and <code>shutdown</code> commands.  These commands require
that Moonraker be able to run <code>sudo</code> commands without a password or that the
<code>sudo_password</code> option is set.</p>
<p>Alternatively it may be possible to enable the <code>systemd-logind</code> service,
consult with your distributions's documentation.</p>
</div>
<h4 id="allowed-services">Allowed Services<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#allowed-services" title="Permanent link"></a></h4>
<p>The <code>machine</code> component uses the configured provider to manage services
on the system (ie: restart a service).  Moonraker is authorized to manage
the <code>moonraker</code> and <code>klipper</code> services, including those that match common
multi-instance patterns, such as <code>moonraker-1</code>, <code>klipper_2</code>, and <code>moonraker1</code>.</p>
<p>Moonraker may be authorized to manage additional services by modifying
<code>&lt;data_folder&gt;/moonraker.asvc</code>.  By default this file includes the
following services:</p>
<ul>
<li><code>klipper_mcu</code></li>
<li><code>webcamd</code></li>
<li><code>MoonCord</code></li>
<li><code>KlipperScreen</code></li>
<li><code>moonraker-telegam-bot</code></li>
<li><code>sonar</code></li>
<li><code>crowsnest</code></li>
</ul>
<p>Note that systemd units are case sensitive, so the case must match
when adding a value to <code>moonraker.asvc</code>.</p>
<h4 id="reboot-shutdown-from-klipper">Reboot / Shutdown from Klipper<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#reboot-shutdown-from-klipper" title="Permanent link"></a></h4>
<p>It is possible to call the <code>shutdown_machine</code> and <code>reboot_machine</code>
remote methods from a gcode macro in Klipper.  For example:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_4"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_4 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro SHUTDOWN]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method("shutdown_machine")}</span>

<span class="k">[gcode_macro REBOOT]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method("reboot_machine")}</span>
</code></pre></div>
<h3 id="database"><code>[database]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#database" title="Permanent link"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section no long has configuration options.  Previously the
<code>database_path</code> option was used to determine the location of
the database folder, it is now determined by the <code>data path</code>
configured on the command line.</p>
</div>
<h3 id="data_store"><code>[data_store]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#data_store" title="Permanent link"></a></h3>
<p>The <code>data_store</code> section provides configuration for Moonraker's volatile
data store.  Note that this is different from the <code>database</code>, as it stores
data in memory and does not persist between restarts.  If omitted defaults
will be used.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_5"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_5 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">temperature_store_size</span><span class="o">:</span><span class="w"> </span><span class="s">1200</span>
<span class="c1">#   The maximum number of temperature values to store for each sensor. Note</span>
<span class="c1">#   that this value also applies to the "target", "power", and "fan_speed"</span>
<span class="c1">#   if the sensor reports them.  The default is 1200, which is enough to</span>
<span class="c1">#   store approximately 20 minutes of data at one value per second.</span>
<span class="na">gcode_store_size</span><span class="o">:</span><span class="w">  </span><span class="s">1000</span>
<span class="c1">#   The maximum number "gcode lines" to store.  The default is 1000.</span>
</code></pre></div>
<h3 id="job_queue"><code>[job_queue]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#job_queue" title="Permanent link"></a></h3>
<p>The <code>job_queue</code> section provides configuration for Moonraker's gcode job
queuing.  If omitted defaults will be used.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_6"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_6 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">load_on_startup</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   When set to true the job queue will attempt to load the next</span>
<span class="c1">#   pending job when Klipper reports as "Ready".  If the queue has</span>
<span class="c1">#   been paused it will automatically resume.  Note that neither</span>
<span class="c1">#   the job_transition_delay nor the job_transition_gcode are</span>
<span class="c1">#   applied in this case.  The default is False.</span>
<span class="na">automatic_transition</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   When set to True the queue will automatically transition to</span>
<span class="c1">#   the next job in the queue after the current job is complete.</span>
<span class="c1">#   This is useful for belt printers and other machines with the</span>
<span class="c1">#   ability to automate clearing of the build area.  When False</span>
<span class="c1">#   the queue will be paused after each job is loaded, requiring</span>
<span class="c1">#   that users manually resume to load the next print.  The default</span>
<span class="c1">#   is False.</span>
<span class="na">job_transition_delay</span><span class="o">:</span>
<span class="c1">#   The amount of time to delay after completion of a job before</span>
<span class="c1">#   loading the next job on the queue.  The default is no delay.</span>
<span class="na">job_transition_gcode</span><span class="o">:</span>
<span class="c1">#   A gcode to execute after the completion of a job before the next</span>
<span class="c1">#   job is loaded.  If a "job_transition_delay" has been configured</span>
<span class="c1">#   this gcode will run after the delay.  The default is no gcode.</span>
</code></pre></div>
<h3 id="announcements"><code>[announcements]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#announcements" title="Permanent link"></a></h3>
<p>The <code>announcements</code> section provides supplemental configuration for
Moonraker announcements.  If omitted defaults will be used.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_7"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_7 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[announcements]</span>
<span class="na">subscriptions</span><span class="o">:</span>
<span class="c1">#   A newline separated list announcement "subscriptions".  Generally</span>
<span class="c1">#   this would refer to specific clients that are registered to provide</span>
<span class="c1">#   announcements.  All items specified here are added in addition to</span>
<span class="c1">#   "moonraker" and "klipper", which are always subscribed to.  The default</span>
<span class="c1">#   is no additional subscriptions.</span>
<span class="na">dev_mode</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   A developer option that fetches RSS announcements from a local folder when</span>
<span class="c1">#   set to True. The default behavior is for Moonraker to retrieve announcements</span>
<span class="c1">#   from RSS feeds generated by the "moonlight" repo on GitHub.</span>
</code></pre></div>
<h3 id="webcam"><code>[webcam]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#webcam" title="Permanent link"></a></h3>
<p>The <code>webcam</code> module provides unified webcam configuration management.  Webcams
may be configured directly through front-ends and added to the database,
however it is also possible for users to configure one or more webcams in
<code>moonraker.conf</code>.  If a webcam is configured in <code>moonraker.conf</code> it takes
precedent over a webcam in the database by the same name.  The options
available may not apply to all front ends, refer to your front end's
documentation for details on camera configuration.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_8"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_8 &gt; code"></button><code><span class="k">[webcam my_camera_name]</span>
<span class="na">location</span><span class="o">:</span><span class="w"> </span><span class="s">printer</span>
<span class="c1">#   A description of the webcam location, ie: what the webcam is observing.</span>
<span class="c1">#   The default is "printer".</span>
<span class="na">icon</span><span class="o">:</span>
<span class="c1">#   A name of the icon to use for the camera.  See the tip following this</span>
<span class="c1">#   example for known values.  The default is mdiWebcam.</span>
<span class="na">enabled</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   An optional boolean value to indicate if this webcam should be enabled.</span>
<span class="c1">#   Default is True.</span>
<span class="na">service</span><span class="o">:</span><span class="w"> </span><span class="s">mjpegstreamer</span>
<span class="c1">#   The name of the application or service hosting the webcam stream.  Front-</span>
<span class="c1">#   ends may use this configuration to determine how to connect to the service</span>
<span class="c1">#   and interpret its stream.  See the tip following this example for</span>
<span class="c1">#   currently known values.  The default is "mjpegstreamer".</span>
<span class="na">target_fps</span><span class="o">:</span><span class="w"> </span><span class="s">15</span>
<span class="c1">#   An integer value specifying the target framerate.  The default is 15 fps.</span>
<span class="na">target_fps_idle</span><span class="o">:</span><span class="w"> </span><span class="s">5</span>
<span class="c1">#   An integer value specifying the target framerate when the printer is idle.</span>
<span class="c1">#   The default is 5 fps.</span>
<span class="na">stream_url</span><span class="o">:</span>
<span class="c1">#   The url for the camera stream request.  This may be a full url or a</span>
<span class="c1">#   relative path (ie: /webcam?action=stream) if the stream is served on the</span>
<span class="c1">#   same host as Moonraker at port 80.  This parameter must be provided.</span>
<span class="na">snapshot_url</span><span class="o">:</span>
<span class="c1">#   The url for the camera snapshot request.  This may be a full url or a</span>
<span class="c1">#   relative path (ie: /webcam?action=stream) if the stream is served on the</span>
<span class="c1">#   same host as Moonraker at port 80.  The default is an empty url.</span>
<span class="na">flip_horizontal</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   A boolean value indicating whether the stream should be flipped</span>
<span class="c1">#   horizontally.  The default is false.</span>
<span class="na">flip_vertical</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   A boolean value indicating whether the stream should be flipped</span>
<span class="c1">#   vertically.  The default is false.</span>
<span class="na">rotation</span><span class="o">:</span><span class="w"> </span><span class="s">0</span>
<span class="c1">#   An integer value indicating the amount of clockwise rotation to apply</span>
<span class="c1">#   to the stream.  May be 0, 90, 180, or 270.  The default is 0.</span>
<span class="na">aspect_ratio</span><span class="o">:</span><span class="w"> </span><span class="s">4:3</span>
<span class="c1">#   The aspect ratio to display for the camera.  Note that this option</span>
<span class="c1">#   is specific to certain services, otherwise it is ignored.</span>
<span class="c1">#   The default is 4:3.</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The following are known <code>icon</code> values:</p>
<div class="md-typeset__scrollwrap"><div class="md-typeset__table"><table>
<thead>
<tr>
<th>Icon Description</th>
<th>[webcam] icon value</th>
<th>Supported Frontends</th>
</tr>
</thead>
<tbody>
<tr>
<td>Printer</td>
<td><code>mdiPrinter3d</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>Nozzle</td>
<td><code>mdiPrinter3dNozzle</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>Bed</td>
<td><code>mdiRadiatorDisabled</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>Webcam</td>
<td><code>mdiWebcam</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>Filament</td>
<td><code>mdiAlbum</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>Door</td>
<td><code>mdiDoor</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>MCU</td>
<td><code>mdiRaspberryPi</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>Hot</td>
<td><code>mdiCampfire</code></td>
<td>Mainsail</td>
</tr>
</tbody>
</table></div></div>
<p>The documentation for
<a href="https://docs.mainsail.xyz/overview/settings/webcams#service">Mainsail</a>
and <a href="https://docs.fluidd.xyz/features/cameras">Fluidd</a>
contain descriptions for their respective streaming service options.
Below is a table of values mapping currently known service types to
the values accepted by the webcam's <code>service</code> option:</p>
<div class="md-typeset__scrollwrap"><div class="md-typeset__table"><table>
<thead>
<tr>
<th>Service Type</th>
<th>[webcam] service value</th>
<th>Supported Frontends</th>
</tr>
</thead>
<tbody>
<tr>
<td>MJPEG-Streamer</td>
<td><code>mjpegstreamer</code></td>
<td>Mainsail, Fluidd</td>
</tr>
<tr>
<td>Adaptive MJPEG-Streamer</td>
<td><code>mjpegstreamer-adaptive</code></td>
<td>Mainsail, Fluidd</td>
</tr>
<tr>
<td>UV4L-MJPEG</td>
<td><code>uv4l-mjpeg</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>IP-Camera</td>
<td><code>ipstream</code></td>
<td>Mainsail, Fluidd</td>
</tr>
<tr>
<td>WebRTC (camera-streamer)</td>
<td><code>webrtc-camerastreamer</code></td>
<td>Mainsail, Fluidd</td>
</tr>
<tr>
<td>WebRTC (go2rtc)</td>
<td><code>webrtc-go2rtc</code></td>
<td>Mainsail, Fluidd</td>
</tr>
<tr>
<td>WebRTC (MediaMTX)</td>
<td><code>webrtc-mediamtx</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>WebRTC (Janus)</td>
<td><code>webrtc-janus</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>HLS Streamer</td>
<td><code>hlsstream</code></td>
<td>Mainsail, Fluidd</td>
</tr>
<tr>
<td>jMuxer</td>
<td><code>jmuxer-stream</code></td>
<td>Mainsail</td>
</tr>
<tr>
<td>HTTP Page</td>
<td><code>iframe</code></td>
<td>Fluidd</td>
</tr>
</tbody>
</table></div></div>
</div>
<h3 id="authorization"><code>[authorization]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#authorization" title="Permanent link"></a></h3>
<p>The <code>[authorization]</code> section provides configuration for Moonraker's
authorization module.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_9"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_9 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[authorization]</span>
<span class="na">enable_api_key</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   Enables API Key authentication.  The default is True.</span>
<span class="na">login_timeout</span><span class="o">:</span>
<span class="c1">#   The time, in days, after which a user is forced to re-enter their</span>
<span class="c1">#   credentials to log in.  This period begins when a logged out user</span>
<span class="c1">#   first logs in.  Successive logins without logging out will not</span>
<span class="c1">#   renew the timeout.  The default is 90 days.</span>
<span class="na">max_login_attempts</span><span class="o">:</span>
<span class="c1">#   Maximum number of consecutive failed login attempts before an IP address</span>
<span class="c1">#   is locked out.  Failed logins are tracked per IP and are reset upon a</span>
<span class="c1">#   successful login.  Locked out IPs are reset when Moonraker restarts.</span>
<span class="c1">#   By default there is no maximum number of logins.</span>
<span class="na">trusted_clients</span><span class="o">:</span>
<span class="w"> </span><span class="na">192.168.1.30</span>
<span class="w"> </span><span class="na">192.168.1.0/24</span>
<span class="w"> </span><span class="na">my-printer.lan</span>
<span class="c1">#   A list of newline separated ip addresses, ip ranges, or fully qualified</span>
<span class="c1">#   domain names that are trusted. Trusted clients are given full access to</span>
<span class="c1">#   the API.  Both IPv4 and IPv6 addresses and ranges are supported. Ranges</span>
<span class="c1">#   must be expressed in CIDR notation (see http://ip.sb/cidr for more info).</span>
<span class="c1">#   For example, an entry of 192.168.1.0/24 will authorize IPs in the range of</span>
<span class="c1">#   192.168.1.1 - 192.168.1.254.  Note that when specifying IPv4 ranges the</span>
<span class="c1">#   last segment of the ip address must be 0. The default is no IPs or</span>
<span class="c1">#   domains are trusted.</span>
<span class="na">cors_domains</span><span class="o">:</span>
<span class="w">  </span><span class="na">http</span><span class="o">:</span><span class="s">//klipper-printer.local</span>
<span class="w">  </span><span class="na">http</span><span class="o">:</span><span class="s">//second-printer.local:7125</span>
<span class="c1">#   Enables CORS for the specified domains.  One may specify * if they wish</span>
<span class="c1">#   to allow all domains, however this should be an option reserved for</span>
<span class="c1">#   client developers and not used in production.  A * can also be used</span>
<span class="c1">#   to specify a wildcard that matches several domains.  For example:</span>
<span class="c1">#     *.local</span>
<span class="c1">#     http://*.my-domain.com</span>
<span class="c1">#     *.my-domain.com:*</span>
<span class="c1">#   Are all valid entries.  However, a wildcard may not be specified in</span>
<span class="c1">#   the top level domain:</span>
<span class="c1">#      http://my-printer.*</span>
<span class="c1">#   The above example will be rejected.</span>
<span class="c1">#   When CORS is enabled by adding an entry to this option, all origins</span>
<span class="c1">#   matching the "trusted_clients" option will have CORS headers set as</span>
<span class="c1">#   well.  If this option is not specified then CORS is disabled.</span>
<span class="na">force_logins</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   When set to True a user login is required for authorization if at least</span>
<span class="c1">#   one user has been created, overriding the "trusted_clients" configuration.</span>
<span class="c1">#   If no users have been created then trusted client checks will apply.</span>
<span class="c1">#   The default is False.</span>
<span class="na">default_source</span><span class="o">:</span><span class="w"> </span><span class="s">moonraker</span>
<span class="c1">#   The default source used to authenticate user logins. Can be "ldap" or</span>
<span class="c1">#   "moonraker"  The default is "moonraker".</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When configuring the <code>trusted_clients</code> option it is generally recommended
to stick with IP ranges and avoid including domain names.  When attempting to
authenticate a request against a domain name Moonraker must perform a DNS
lookup. If the DNS service is not available then authentication will fail
and an error will be returned.  In addition, DNS lookups will introduce delay
in the response.</p>
</div>
<h2 id="optional-components">Optional Components<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#optional-components" title="Permanent link"></a></h2>
<p>Optional Components are only loaded if present in <code>moonraker.conf</code>.  This
includes components that may not have any configuration.</p>
<h3 id="analysis"><code>[analysis]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#analysis" title="Permanent link"></a></h3>
<p>The <code>analysis</code> component enables gcode file time analysis using
<a href="https://github.com/Annex-Engineering/klipper_estimator">Klipper Estimator</a>.
When enabled, Moonraker will automatically download the <code>klipper_estimator</code>
binary and optionally create an <a href="https://moonraker.readthedocs.io/en/latest/configuration/#update_manager">update manger</a> entry for it.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_10"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_10 &gt; code"></button><code><span class="c1"># moonraker.conf</span>
<span class="na">platform</span><span class="o">:</span><span class="w"> </span><span class="s">auto</span>
<span class="c1">#   The platform flavor of Klipper Estimator to use.  Must be a choice</span>
<span class="c1">#   from rpi, linux, osx, and auto. Note that "rpi" supports armv7 and</span>
<span class="c1">#   aarch64 linux platforms, whereas "linux" supports amd64 linux</span>
<span class="c1">#   platform.  The auto choice will attempt to automatically determine</span>
<span class="c1">#   the correct platform.  The default is auto.</span>
<span class="na">estimator_config</span><span class="o">:</span>
<span class="c1">#   A path relative to the "config" root specifying a config</span>
<span class="c1">#   file to use for Klipper Estimator.  The default is to</span>
<span class="c1">#   use a configuration dumped with data retrieved from Klipper's</span>
<span class="c1">#   current settings.</span>
<span class="na">auto_dump_default_config</span><span class="o">:</span><span class="w"> </span><span class="s">false</span>
<span class="c1">#   When set to true the default configuration for Klipper Estimator</span>
<span class="c1">#   will be dumped every time Klippy restarts.  When false the</span>
<span class="c1">#   configuration is only dumped if the default configuration file</span>
<span class="c1">#   does not exist.  The default is false.</span>
<span class="na">estimator_timeout</span><span class="o">:</span><span class="w"> </span><span class="s">600</span>
<span class="c1">#   The maximum amount of time (in seconds) Klipper Estimator</span>
<span class="c1">#   is given to process a gcode file before processing is</span>
<span class="c1">#   aborted.  The default is 600 seconds.</span>
<span class="na">enable_auto_analysis</span><span class="o">:</span><span class="w"> </span><span class="s">false</span>
<span class="c1">#   When set to true Klipper Estimator will be used to perform a</span>
<span class="c1">#   post-process on gcode files immediately prior to metadata extraction.</span>
<span class="c1">#   The post-process will update the time estimate and M73 commands present</span>
<span class="c1">#   in the gcode file.  This automates the time analysis for any event</span>
<span class="c1">#   that triggers metadata processing.   Default is false.</span>
<span class="na">enable_estimator_updates</span><span class="o">:</span><span class="w"> </span><span class="s">false</span>
<span class="c1">#   When true Moonraker will create and register an entry for</span>
<span class="c1">#   klipper_estimator with the update manager.  Default is false.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When the <code>[analysis]</code> component is configured Moonraker's metadata
processor will be able to detect if a file has been previously processed
by Klipper Estimator, even when <code>enable_auto_analysis</code> is <code>false</code>. This
information is reported in the metadata's <code>file_processors</code> field.</p>
<p>When <code>enable_auto_analysis</code> is set to <code>true</code> a post-process will
be performed if the file has not been previously processed.</p>
</div>
<h3 id="ldap"><code>[ldap]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#ldap" title="Permanent link"></a></h3>
<p>The <code>ldap</code> module may be used by <code>[authorization]</code> to perform user
authentication though an ldap server.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_11"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_11 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[ldap]</span>
<span class="na">ldap_host</span><span class="o">:</span><span class="w"> </span><span class="s">ldap.local</span>
<span class="c1">#   The host address of the LDAP server.  This parameter must be provided</span>
<span class="na">ldap_port</span><span class="o">:</span>
<span class="c1">#   The LDAP server's port.  The default is 389 for standard connections</span>
<span class="c1">#   and 636 for SSL/TLS connections.</span>
<span class="na">ldap_secure</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   Enables LDAP over SSL/TLS. The default is False.</span>
<span class="na">base_dn</span><span class="o">:</span><span class="w"> </span><span class="s">DC=ldap,DC=local</span>
<span class="c1">#   The base distinguished name used to search for users on the server.</span>
<span class="c1">#   This option accepts Jinja2 Templates, see the [secrets] section for details.</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">bind_dn</span><span class="o">:</span><span class="w"> </span><span class="s">{secrets.ldap_credentials.bind_dn}</span>
<span class="c1">#   The distinguished name for bind authentication.  For example:</span>
<span class="c1">#       CN=moonraker,OU=Users,DC=ldap,DC=local</span>
<span class="c1">#   This option accepts Jinja2 Templates, see the [secrets] section for</span>
<span class="c1">#   details.  By default the ldap client will attempt to bind anonymously.</span>
<span class="na">bind_password</span><span class="o">:</span><span class="w"> </span><span class="s">{secrets.ldap_credentials.bind_password}</span>
<span class="c1">#   The password for bind authentication. This option accepts Jinja2 Templates,</span>
<span class="c1">#   see the [secrets] section for details.  This parameter must be provided</span>
<span class="c1">#   if a "bind_dn" is specified, otherwise it must be omitted.</span>
<span class="na">group_dn</span><span class="o">:</span><span class="w"> </span><span class="s">CN=moonraker,OU=Groups,DC=ldap,DC=local</span>
<span class="c1">#   A group distinguished name in which the user must be a member of to pass</span>
<span class="c1">#   authentication.  This option accepts Jinja2 Templates, see the [secrets]</span>
<span class="c1">#   section for details. The default is no group requirement.</span>
<span class="na">is_active_directory</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   Enables support for Microsoft Active Directory. This option changes the</span>
<span class="c1">#   field used to lookup a user by username to sAMAccountName.</span>
<span class="c1">#   The default is False.</span>
<span class="na">user_filter</span><span class="o">:</span><span class="w"> </span><span class="s">(&amp;(objectClass=user)(cn=USERNAME))</span>
<span class="c1">#   Allows filter of users by custom LDAP query. Must contain the USERNAME</span>
<span class="c1">#   token, it will be replaced by the user's username during lookup. Will</span>
<span class="c1">#   override the change done by is_active_directory. This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details.</span>
<span class="c1">#   The default is empty, which will change the lookup query depending on</span>
<span class="c1">#   is_active_directory.</span>
<span class="na">membership_attribute</span><span class="o">:</span><span class="w"> </span><span class="s">memberOf</span>
<span class="c1">#   The name of the attribute that contains a list of groups the user is</span>
<span class="c1">#   a member of.  Can be "memberOf" or "isMemberOf".  Default is "memberOf".</span>
<span class="na">check_dn_case</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   Determines whether or not DN comparisons performed by Moonraker are</span>
<span class="c1">#   case sensitive.  Currently this applies to the 'group_dn' when it is</span>
<span class="c1">#   configured.  Default is True.</span>
<span class="c1">#   Note:  This option does NOT apply to LDAP search operations.  The LDAP</span>
<span class="c1">#   spec states that DN comparisons should not be case sensitive, however it</span>
<span class="c1">#   is possible for server and/or administrator to override this behavior.</span>
</code></pre></div>
<h3 id="octoprint_compat"><code>[octoprint_compat]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#octoprint_compat" title="Permanent link"></a></h3>
<p>Enables partial support of OctoPrint API is implemented with the purpose of
allowing uploading of sliced prints to a moonraker instance.
Currently PrusaSlicer derivatives and Cura with Cura-OctoPrint.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_12"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_12 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[octoprint_compat]</span>
<span class="na">enable_ufp</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   When set to True the octoprint_compat module will report that the UFP</span>
<span class="c1">#   plugin is available.  If the installed version of Cura supports UFP</span>
<span class="c1">#   files will be uploaded in UFP format.  When set to False Cura will</span>
<span class="c1">#   upload files in .gcode format.  This setting has no impact on other</span>
<span class="c1">#   slicers.  The default is True.</span>

<span class="na">flip_h</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   Set the webcam horizontal flip.  The default is False.</span>
<span class="na">flip_v</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   Set the webcam vertical flip.  The default is False.</span>
<span class="na">rotate_90</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   Set the webcam rotation by 90 degrees.  The default is False.</span>
<span class="na">stream_url</span><span class="o">:</span><span class="w"> </span><span class="s">/webcam/?action=stream</span>
<span class="c1">#   The URL to use for streaming the webcam.  It can be set to an absolute</span>
<span class="c1">#   URL if needed. In order to get the webcam to work in Cura through</span>
<span class="c1">#   an OctoPrint connection, you can set this value to</span>
<span class="c1">#   http://&lt;octoprint ip&gt;/webcam/?action=stream.  The default value is</span>
<span class="c1">#   /webcam/?action=stream.</span>
<span class="na">webcam_enabled</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   Enables the webcam.  The default is True.</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is possible to embed "Prusa" style thumbnails in .gcode files using
the latest version of Cura.  Select <code>Extensions</code> -&gt; <code>Post Processing</code> -&gt;
<code>Modify G-Code</code>.  In the dialog click the <code>Add a script</code> button and select
<code>Create Thumbnail</code>.   Change the width and height (most Moonraker clients
handle 300x300 well) then click close.  A single large thumbnail is all
that is necessary, Moonraker will generate a smaller 32x32 thumbnail from
it.  This is convenient for users who do not wish to upload in UFP format.</p>
</div>
<h3 id="paneldue"><code>[paneldue]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#paneldue" title="Permanent link"></a></h3>
<p>Enables PanelDue display support.  The PanelDue should be connected to the
host machine, either via the machine's UART GPIOs or through a USB-TTL
converter.  Currently PanelDue Firmware Version 1.24 is supported.  Other
releases may not behave correctly.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_13"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_13 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[paneldue]</span>
<span class="na">serial</span><span class="o">:</span>
<span class="c1">#   The serial port in which the PanelDue is connected.  This parameter</span>
<span class="c1">#   must be provided.</span>
<span class="na">baud</span><span class="o">:</span><span class="w"> </span><span class="s">57600</span>
<span class="c1">#   The baud rate to connect at.  The default is 57600 baud.</span>
<span class="na">machine_name</span><span class="o">:</span><span class="w"> </span><span class="s">Klipper</span>
<span class="c1">#   An optional unique machine name which displays on the PanelDue's</span>
<span class="c1">#   Header.  The default is "Klipper".</span>
<span class="na">macros</span><span class="o">:</span>
<span class="w"> </span><span class="na">LOAD_FILAMENT</span>
<span class="w"> </span><span class="na">UNLOAD_FILAMENT</span>
<span class="w"> </span><span class="na">PANELDUE_BEEP FREQUENCY</span><span class="o">=</span><span class="s">500 DURATION=1</span>
<span class="c1">#   A list of newline separated "macros" that are displayed in the</span>
<span class="c1">#   PanelDue's "macros" tab.  These can be gcode macros or simple</span>
<span class="c1">#   gcodes.  A macro may contain parameters.  The default is no</span>
<span class="c1">#   macros will be displayed by the PanelDue.</span>
<span class="na">confirmed_macros</span><span class="o">:</span>
<span class="w">  </span><span class="na">RESTART</span>
<span class="w">  </span><span class="na">FIRMWARE_RESTART</span>
<span class="c1">#  Like the "macros" option, this list is added to the macros tab.</span>
<span class="c1">#  When one of these macros is executed the PanelDue will prompt</span>
<span class="c1">#  the user with a confirmation dialog.  The default is to include</span>
<span class="c1">#  RESTART and FIRMWARE_RESTART.</span>
</code></pre></div>
<p>Most options above are self explanatory.  The "macros" option can be used
to specify commands (either built in or gcode_macros) that will show up
in the PanelDue's "macro" menu.</p>
<p>Note that buzzing the piezo requires the following gcode_macro in <code>printer.cfg</code>:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_14"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_14 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro PANELDUE_BEEP]</span>
<span class="c1"># Beep frequency</span>
<span class="na">default_parameter_FREQUENCY</span><span class="o">:</span><span class="w"> </span><span class="s">300</span>
<span class="c1"># Beep duration in seconds</span>
<span class="na">default_parameter_DURATION</span><span class="o">:</span><span class="w"> </span><span class="s">1.</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method("paneldue_beep",</span>
<span class="w">                             </span><span class="na">frequency</span><span class="o">=</span><span class="s">FREQUENCY|int,</span>
<span class="w">                             </span><span class="na">duration</span><span class="o">=</span><span class="s">DURATION|float)}</span>
</code></pre></div>
<h3 id="power"><code>[power]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#power" title="Permanent link"></a></h3>
<p>Enables device power control.  Multiple "power" devices may be configured,
each with their own section, ie: <code>[power my_printer]</code>, <code>[power my_led]</code>.</p>
<h4 id="options-common-to-all-power-devices">Options common to all power devices<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#options-common-to-all-power-devices" title="Permanent link"></a></h4>
<p>The following configuration options are available for all power device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_15"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_15 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power device_name]</span>
<span class="na">type</span><span class="o">:</span>
<span class="c1">#   The type of device.  Can be either gpio, klipper_device, rf,</span>
<span class="c1">#   tplink_smartplug, tasmota, shelly, homeseer, homeassistant, loxonev1,</span>
<span class="c1">#   smartthings, mqtt, hue, http or uhubctl.</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">initial_state</span><span class="o">:</span><span class="w"> </span><span class="s">off</span>
<span class="c1">#    The state the power device should be initialized to.  May be on or</span>
<span class="c1">#    off.  When this option is not specified no initial state will be set.</span>
<span class="na">off_when_shutdown</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   If set to True the device will be powered off when Klipper enters</span>
<span class="c1">#   the "shutdown" state.  This option applies to all device types.</span>
<span class="c1">#   The default is False.</span>
<span class="na">off_when_shutdown_delay</span><span class="o">:</span><span class="w"> </span><span class="s">0</span>
<span class="c1">#   If "off_when_shutdown" is set, this option specifies the amount of time</span>
<span class="c1">#   (in seconds) to wait before turning the device off. Default is 0 seconds.</span>
<span class="na">on_when_job_queued</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   If set to True the device will power on if a job is queued while the</span>
<span class="c1">#   device is off.  This allows for an automated "upload, power on, and</span>
<span class="c1">#   print" approach directly from the slicer, see the configuration example</span>
<span class="c1">#   below for details. The default is False.</span>
<span class="na">locked_while_printing</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   If True, locks the device so that the power cannot be changed while the</span>
<span class="c1">#   printer is printing. This is useful to avert an accidental shutdown to</span>
<span class="c1">#   the printer's power.  The default is False.</span>
<span class="na">restart_klipper_when_powered</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   If set to True, Moonraker will schedule a "FIRMWARE_RESTART" to command</span>
<span class="c1">#   after the device has been powered on. If it isn't possible to immediately</span>
<span class="c1">#   schedule a firmware restart (ie: Klippy is disconnected), the restart</span>
<span class="c1">#   will be postponed until Klippy reconnects and reports that startup is</span>
<span class="c1">#   complete.  Prior to scheduling the restart command the power device will</span>
<span class="c1">#   always check Klippy's state.  If Klippy reports that it is "ready", the</span>
<span class="c1">#   FIRMWARE_RESTART will be aborted as unnecessary.</span>
<span class="c1">#   The default is False.</span>
<span class="na">restart_delay</span><span class="o">:</span><span class="w"> </span><span class="s">1.</span>
<span class="c1">#   If "restart_klipper_when_powered" is set, this option specifies the amount</span>
<span class="c1">#   of time (in seconds) to delay the restart.  Default is 1 second.</span>
<span class="na">bound_services</span><span class="o">:</span>
<span class="c1">#   A newline separated list of services that are "bound" to the state of this</span>
<span class="c1">#   device.  When the device is powered on all bound services will be started.</span>
<span class="c1">#   When the device is powered off all bound services are stopped.</span>
<span class="c1">#</span>
<span class="c1">#   The items in this list are limited to those specified in the allow list,</span>
<span class="c1">#   see the [machine] configuration documentation for details.  Additionally,</span>
<span class="c1">#   the Moonraker service can not be bound to a power device.  Note that</span>
<span class="c1">#   service names are case sensitive.</span>
<span class="c1">#</span>
<span class="c1">#   When the "initial_state" option is explicitly configured bound services</span>
<span class="c1">#   will be synced with the current state.  For example, if the initial_state</span>
<span class="c1">#   is "off", all bound services will be stopped after device initialization.</span>
<span class="c1">#</span>
<span class="c1">#   The default is no services are bound to the device.</span>
<span class="na">restrict_action_processing</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   When set to True, this option will skip "action" processing when Moonraker</span>
<span class="c1">#   detects a change in state triggered by an external source (ie: toggled</span>
<span class="c1">#   by pressing a switch on the device or through another application).  Actions</span>
<span class="c1">#   are post trigger events, such as restarting Klippy and controlling a bound</span>
<span class="c1">#   service. When set to False actions are processed for all detected changes in</span>
<span class="c1">#   state.  Note that Moonraker can only detect external changes for devices</span>
<span class="c1">#   that receive asynchronous updates (Klipper and MQTT) or devices that support</span>
<span class="c1">#   polling and have the 'poll_interval' option set. The default is True.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a device has been bound to the <code>klipper</code> service and the
<code>restart_klipper_when_powered</code> option is set to <code>True</code>, the restart
will be scheduled to execute after Klipper reports that its startup
sequence is complete.</p>
</div>
<h4 id="gpio-device-configuration">GPIO Device Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#gpio-device-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>gpio</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_16"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_16 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpiochip0/gpio26</span>
<span class="c1">#   The pin to use for GPIO and RF devices.  The chip is optional, if left out</span>
<span class="c1">#   then the module will default to gpiochip0.  If one wishes to invert</span>
<span class="c1">#   the signal, a "!" may be prefixed to the pin.  Valid examples:</span>
<span class="c1">#      gpiochip0/gpio26</span>
<span class="c1">#      gpio26</span>
<span class="c1">#      !gpiochip0/gpio26</span>
<span class="c1">#      !gpio26</span>
<span class="c1">#    This parameter must be provided for "gpio" type devices</span>
<span class="na">timer</span><span class="o">:</span>
<span class="c1">#    A time (in seconds) after which the device will power off after being.</span>
<span class="c1">#    switched on. This effectively turns the device into a  momentary switch.</span>
<span class="c1">#    This option is available for gpio, klipper_device, tplink_smartplug,</span>
<span class="c1">#    shelly, and tasmota devices.  The timer may be a floating point value</span>
<span class="c1">#    for gpio types, it should be an integer for all other types.  The</span>
<span class="c1">#    default is no timer is set.</span>
</code></pre></div>
<p>Examples:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_17"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_17 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="c1"># Control a relay providing power to the printer</span>
<span class="k">[power printer]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">gpio</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpio26</span><span class="w">  </span><span class="c1"># uses pin 26 on gpiochip0</span>
<span class="na">off_when_shutdown</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="na">initial_state</span><span class="o">:</span><span class="w"> </span><span class="s">off</span>

<span class="c1"># Control a status led</span>
<span class="k">[power printer_led]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">gpio</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">!gpiochip0/gpio16</span><span class="w">  </span><span class="c1"># inverts pin</span>
<span class="na">initial_state</span><span class="o">:</span><span class="w"> </span><span class="s">off</span>

<span class="c1"># Control a printer illumination, powers on when</span>
<span class="c1"># Moonraker starts</span>
<span class="k">[power light_strip]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">gpio</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpiochip0/gpio17</span>
<span class="na">initial_state</span><span class="o">:</span><span class="w"> </span><span class="s">on</span>
</code></pre></div>
<h4 id="klipper-device-configuration">Klipper Device Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#klipper-device-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>klipper_device</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_18"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_18 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="na">object_name</span><span class="o">:</span><span class="w"> </span><span class="s">output_pin my_pin</span>
<span class="c1">#    The Klipper object_name (as defined in your Klipper config).  Valid examples:</span>
<span class="c1">#      output_pin my_pin</span>
<span class="c1">#      gcode_macro MY_MACRO</span>
<span class="c1">#    Currently, only `output_pin` and `gcode_macro` Klipper devices are</span>
<span class="c1">#    supported.  See the note below for macro restrictions. Keep in mind that</span>
<span class="c1">#    the object name is case sensitive.  This parameter must be provided.</span>
<span class="na">timer</span><span class="o">:</span>
<span class="c1">#    A time (in seconds) after which the device will power off after being.</span>
<span class="c1">#    switched on. This effectively turns the device into a  momentary switch.</span>
<span class="c1">#    This option is available for gpio, klipper_device, tplink_smartplug,</span>
<span class="c1">#    shelly, and tasmota devices.  The timer may be a floating point value</span>
<span class="c1">#    for gpio types, it should be an integer for all other types.  The</span>
<span class="c1">#    default is no timer is set.</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Klipper devices cannot be used to toggle the printer's power supply as they
require that Klipper be running and in the "Ready" state.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some of the options common to all <code>[power]</code> devices are not available for
the <code>klipper_device</code> type.  Specifically <code>off_when_shutdown</code> and
<code>restart_klipper_when_powered</code> may not be configured.  The <code>bound_service</code>
option is restricted, it may not be set to an instance of <code>klipper</code> or
<code>klipper_mcu</code>.</p>
</div>
<h5 id="gcode-macro-restrictions">Gcode Macro Restrictions<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#gcode-macro-restrictions" title="Permanent link"></a></h5>
<p>To control "gcode_macro" klipper devices, macros must be configured to accept a
VALUE parameter, and they must report and update a <code>value</code> variable.  The value
should be 1 when the device is on, and 0 when the device is off.  For example,
a macro could be configured like the following in <code>printer.cfg</code>:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_19"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_19 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="c1"># Assume we have a neopixel we want to control</span>
<span class="k">[neopixel extruder_flare]</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">PA13</span>

<span class="k">[gcode_macro SET_FLARE]</span>
<span class="c1"># The variable below should be initialized to the startup value.  If your</span>
<span class="c1"># device is configured to be on at startup use "variable_value: 1"</span>
<span class="na">variable_value</span><span class="o">:</span><span class="w"> </span><span class="s">0</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% if 'VALUE' not in params %}</span>
<span class="w">    </span><span class="na">{action_raise_error("Parameter 'VALUE' missing from 'SET_FLARE'")}</span>
<span class="w">  </span><span class="na">{% endif %}</span>
<span class="w">  </span><span class="na">{% set state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.VALUE|int %}</span>
<span class="w">  </span><span class="na">{% if state %}</span>
<span class="w">    </span><span class="c1"># turn the neopixel on</span>
<span class="w">    </span><span class="na">SET_LED LED</span><span class="o">=</span><span class="s">extruder_flare RED=0.75 BLUE=0.2 GREEN=0.2 SYNC=0</span>
<span class="w">  </span><span class="na">{% else %}</span>
<span class="w">    </span><span class="c1"># turn the neopixel off</span>
<span class="w">    </span><span class="na">SET_LED LED</span><span class="o">=</span><span class="s">extruder_flare RED=0 BLUE=0 GREEN=0 SYNC=0</span>
<span class="w">  </span><span class="na">{% endif %}</span>
<span class="w">  </span><span class="c1"># Update the state of our variable.  This will inform Moonraker that</span>
<span class="w">  </span><span class="c1"># the device has changed its state.</span>
<span class="w">  </span><span class="na">SET_GCODE_VARIABLE MACRO</span><span class="o">=</span><span class="s">SET_FLARE VARIABLE=value value={state}</span>
</code></pre></div>
<p>This can be controlled via Moonraker with the following in <code>moonraker.conf</code>:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_20"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_20 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power flare]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">klipper_device</span>
<span class="na">object_name</span><span class="o">:</span><span class="w"> </span><span class="s">gcode_macro SET_FLARE</span>
<span class="c1"># The option below locks out requests to toggle the flare</span>
<span class="c1"># when Klipper is printing, however it cannot prevent a</span>
<span class="c1"># direct call to the SET_FLARE gcode macro.</span>
<span class="na">locked_while_printing</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
</code></pre></div>
<p>Output Pin Example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_21"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_21 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="c1"># Control a relay providing power to the printer</span>
<span class="k">[power my_pin]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">klipper_device</span>
<span class="na">object_name</span><span class="o">:</span><span class="w"> </span><span class="s">output_pin my_pin</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you need to use pwm you can wrap the call to <code>SET_PIN</code> in a
gcode_macro and configure Moonraker to toggle the Macro rather than
the pin directly.</p>
</div>
<h4 id="rf-device-configuration">RF Device Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#rf-device-configuration" title="Permanent link"></a></h4>
<p>The following options are available for gpio controlled <code>rf</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_22"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_22 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpiochip0/gpio26</span>
<span class="c1">#   The pin to use for GPIO and RF devices.  The chip is optional, if left out</span>
<span class="c1">#   then the module will default to gpiochip0.  If one wishes to invert</span>
<span class="c1">#   the signal, a "!" may be prefixed to the pin.  Valid examples:</span>
<span class="c1">#      gpiochip0/gpio26</span>
<span class="c1">#      gpio26</span>
<span class="c1">#      !gpiochip0/gpio26</span>
<span class="c1">#      !gpio26</span>
<span class="c1">#    This parameter must be provided for "gpio" type devices</span>
<span class="na">timer</span><span class="o">:</span>
<span class="c1">#    A time (in seconds) after which the device will power off after being.</span>
<span class="c1">#    switched on. This effectively turns the device into a  momentary switch.</span>
<span class="c1">#    This option is available for gpio, klipper_device, tplink_smartplug,</span>
<span class="c1">#    shelly, and tasmota devices.  The timer may be a floating point value</span>
<span class="c1">#    for gpio types, it should be an integer for all other types.  The</span>
<span class="c1">#    default is no timer is set.</span>
<span class="na">on_code</span><span class="o">:</span>
<span class="na">off_code</span><span class="o">:</span>
<span class="c1">#   Valid binary codes that are sent via the RF transmitter.</span>
<span class="c1">#   For example: 1011.</span>
</code></pre></div>
<h4 id="tplink-smartplug-configuration">TPLink Smartplug Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#tplink-smartplug-configuration" title="Permanent link"></a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>TPLink has removed access to the local API for some of its Kasa devices
in recent firmware releases.  As such, it is possible that Moonraker
will be unable to communicate with your device.  While TPLink claims that
they will provide a new local API, they have have not done so as of
December 22<sup>nd</sup>, 2021.
See <a href="https://community.tp-link.com/en/smart-home/forum/topic/239364">this TPLink forum post</a>
and <a href="https://alerts.home-assistant.io/#tplink.markdown">this Home Assistant Alert</a>
for details.</p>
</div>
<p>The following options are available for <code>tplink_smartplug</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_23"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_23 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">address</span><span class="o">:</span>
<span class="c1">#   A valid ip address or hostname for the tplink device.  For example:</span>
<span class="c1">#     192.168.1.127</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">port</span><span class="o">:</span>
<span class="c1">#   The port to connect to.  Default is 9999.</span>
<span class="c1">#</span>
<span class="na">output_id</span><span class="o">:</span>
<span class="c1">#   For power strips, the socket index to use. Default is 0 which indicates the</span>
<span class="c1">#   device is not a power strip.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<p>Example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_24"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_24 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power printer_plug]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">tplink_smartplug</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">192.168.1.123</span>
</code></pre></div>
<h4 id="tasmota-configuration">Tasmota Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#tasmota-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>tasmota</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_25"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_25 &gt; code"></button><code><span class="c1"># moonraker.conf</span>
<span class="c1">#</span>
<span class="c1">#   Note:</span>
<span class="c1">#   If your single-relay Tasmota device switches on/off successfully,</span>
<span class="c1">#   but fails to report its state, ensure that 'SetOption26' is set in</span>
<span class="c1">#   Tasmota.</span>
<span class="na">address</span><span class="o">:</span>
<span class="c1">#   A valid ip address or hostname for the tasmota device.  This parameter</span>
<span class="c1">#   must be provided.</span>
<span class="na">password</span><span class="o">:</span>
<span class="c1">#   A password used to authenticate requests.  Default is no password.</span>
<span class="na">output_id</span><span class="o">:</span>
<span class="c1">#   The output_id (or relay id) to use if the Tasmota device supports</span>
<span class="c1">#   more than one output.  Default is 1.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This implementation communicates with Tasmota firmware through its
HTTP APIs.  It is also possible to use <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-device-configuration">MQTT</a>
to control devices flashed with Tasmota.</p>
</div>
<p>Example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_26"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_26 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power tasmota_plug]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">tasmota</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">192.168.1.124</span>
<span class="na">password</span><span class="o">:</span><span class="w"> </span><span class="s">mypassword</span>
</code></pre></div>
<h4 id="shelly-configuration">Shelly Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#shelly-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>shelly</code> device types:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently only Gen 1 Shelly devices support Authentication</p>
</div>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_27"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_27 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">address</span><span class="o">:</span>
<span class="c1">#   A valid ip address or hostname for the shelly device.  This parameter</span>
<span class="c1">#   must be provided.</span>
<span class="na">user</span><span class="o">:</span>
<span class="c1">#   A user name to use for request authentication.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details.  If no password</span>
<span class="c1">#   is set the the default is no user, otherwise the default is "admin".</span>
<span class="na">password</span><span class="o">:</span>
<span class="c1">#   The password to use for request authentication.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details. The default is no</span>
<span class="c1">#   password.</span>
<span class="na">output_id</span><span class="o">:</span>
<span class="c1">#   The output_id (or relay id) to use if the Shelly device supports</span>
<span class="c1">#   more than one output.  Default is 1.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This implementation communicates with Shelly firmware through its
HTTP APIs.  It is also possible to use <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-device-configuration">MQTT</a>
to control Shelly devices.</p>
</div>
<p>Example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_28"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_28 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power shelly_plug]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">shelly</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">192.168.1.125</span>
<span class="na">user</span><span class="o">:</span><span class="w"> </span><span class="s">user2</span>
<span class="na">password</span><span class="o">:</span><span class="w"> </span><span class="s">password2</span>
</code></pre></div>
<h4 id="homeseer-configuration">Homeseer Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#homeseer-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>homeseer</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_29"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_29 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">address</span><span class="o">:</span>
<span class="c1">#   A valid ip address or hostname for the homeseer device.  This parameter</span>
<span class="c1">#   must be provided.</span>
<span class="na">device</span><span class="o">:</span>
<span class="c1">#   The ID of the device to control.</span>
<span class="c1">#   To find out the ID in the HomeSeer UI, click on the device you want to</span>
<span class="c1">#   control (Make sure to click the sub-device that actually has On/Off</span>
<span class="c1">#   buttons).  And then go to the "status/graphics" tab and it should list</span>
<span class="c1">#   "ID" in the "advanced information" section.  This parameter must be</span>
<span class="c1">#   provided.</span>
<span class="na">user</span><span class="o">:</span>
<span class="c1">#   The user name for request authentication.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details.  This</span>
<span class="c1">#   default is "admin".</span>
<span class="na">password</span><span class="o">:</span>
<span class="c1">#   The password for request authentication.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details. The</span>
<span class="c1">#   default is no password.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<h4 id="home-assistant-configuration-http">Home Assistant Configuration (HTTP)<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#home-assistant-configuration-http" title="Permanent link"></a></h4>
<p>The following options are available for <code>homeassistant</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_30"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_30 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">address</span><span class="o">:</span>
<span class="c1">#   A valid ip address or hostname for the Home Assistant server.  This</span>
<span class="c1">#   parameter must be provided.</span>
<span class="na">protocol</span><span class="o">:</span>
<span class="c1">#   The protocol for the URL to the Home Assistant server. Default is http.</span>
<span class="na">port</span><span class="o">:</span>
<span class="c1">#   The port the Home Assistant server is listening on.  Default is 8123.</span>
<span class="na">device</span><span class="o">:</span>
<span class="c1">#   The entity ID of the switch to control. This parameter must be provided.</span>
<span class="na">token</span><span class="o">:</span>
<span class="c1">#   A token used for request authorization.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details. This parameter</span>
<span class="c1">#   must be provided.</span>
<span class="na">domain</span><span class="o">:</span>
<span class="c1">#   The class of device managed by Home Assistant. Default is "switch".</span>
<span class="na">status_delay</span><span class="o">:</span><span class="w"> </span><span class="s">1.0</span>
<span class="c1">#   The time (in seconds) to delay between requesting a device to turn</span>
<span class="c1">#   on/off and requesting its current status.  This is a workaround used</span>
<span class="c1">#   to validate that Home Assistant has successfully toggled the device,</span>
<span class="c1">#   as the API is currently broken on their end.  Default is 1 second.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<p>Example:
</p><div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_31"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_31 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power homeassistant_switch]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">homeassistant</span>
<span class="na">protocol</span><span class="o">:</span><span class="w"> </span><span class="s">http</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">192.168.1.126</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">8123</span>
<span class="na">device</span><span class="o">:</span><span class="w"> </span><span class="s">switch.1234567890abcdefghij</span>
<span class="na">token</span><span class="o">:</span><span class="w"> </span><span class="s">home-assistant-very-long-token</span>
<span class="na">domain</span><span class="o">:</span><span class="w"> </span><span class="s">switch</span>
</code></pre></div><p></p>
<h4 id="loxone-device-configuration">Loxone Device Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#loxone-device-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>loxone</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_32"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_32 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">address</span><span class="o">:</span>
<span class="c1">#   A valid ip address or hostname for the Loxone server.  This</span>
<span class="c1">#   parameter must be provided.</span>
<span class="na">user</span><span class="o">:</span>
<span class="c1">#   The user name used for request authorization.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details. The default is</span>
<span class="c1">#   "admin".</span>
<span class="na">password</span><span class="o">:</span>
<span class="c1">#   The password used for request authorization.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details. The default</span>
<span class="c1">#   is "admin".</span>
<span class="na">output_id</span><span class="o">:</span>
<span class="c1">#   The name of a programmed output, virtual input or virtual</span>
<span class="c1">#   output in the loxone configuration.  The default is no output id.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<h4 id="mqtt-device-configuration">MQTT Device Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-device-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>mqtt</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_33"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_33 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="na">qos</span><span class="o">:</span>
<span class="c1">#  The MQTT QOS level to use when publishing and subscribing to topics.</span>
<span class="c1">#  The default is to use the setting supplied in the [mqtt] section.</span>
<span class="na">command_topic</span><span class="o">:</span>
<span class="c1">#  The mqtt topic used to publish commands to the device.  This parameter must</span>
<span class="c1">#  be provided.</span>
<span class="na">command_payload</span><span class="o">:</span>
<span class="c1">#  The payload sent with the topic.  This can be a template, with a "command"</span>
<span class="c1">#  variable included in the template context, where "command" is either "on"</span>
<span class="c1">#  or "off".  For example:</span>
<span class="c1">#    {% if command == "on" %}</span>
<span class="c1">#      TURN_ON</span>
<span class="c1">#    {% else %}</span>
<span class="c1">#      TURN_OFF</span>
<span class="c1">#    {% endif %}</span>
<span class="c1">#  The above example would resolve to "TURN_ON" if the request is turn the</span>
<span class="c1">#  the device on, and "TURN_OFF" if the request is to turn the device off.</span>
<span class="c1">#  This parameter must be provided.</span>
<span class="na">retain_command_state</span><span class="o">:</span>
<span class="c1">#  If set to True the retain flag will be set when the command topic is</span>
<span class="c1">#  published.  Default is False.</span>
<span class="na">state_topic</span><span class="o">:</span>
<span class="c1">#  The mqtt topic to subscribe to for state updates.  This parameter must be</span>
<span class="c1">#  provided.</span>
<span class="na">state_response_template</span><span class="o">:</span>
<span class="c1">#  A template used to parse the payload received with the state topic.  The</span>
<span class="c1">#  template's context will include  "payload", "last_request", and</span>
<span class="c1">#  "response_count" variables. This template must resolve to "on", "off" or</span>
<span class="c1">#  "discard".  For example:</span>
<span class="c1">#    {% set resp = payload|fromjson %}</span>
<span class="c1">#    {resp["POWER"]}</span>
<span class="c1">#  The above example assumes a json response is received, with a "POWER" field</span>
<span class="c1">#  that set to either "ON" or "OFF".  The resolved response will always be</span>
<span class="c1">#  trimmed of whitespace and converted to lowercase.  See the "Discarding</span>
<span class="c1">#  Responses" section below for details on how to discard unwanted responses.</span>
<span class="c1">#  The default is to render the contents the payload directly.</span>
<span class="na">state_timeout</span><span class="o">:</span>
<span class="c1">#  The amount of time (in seconds) to wait for the state topic to receive an</span>
<span class="c1">#  update. If the timeout expires the device revert to an "error" state.  This</span>
<span class="c1">#  timeout is applied during initialization and after a command has been sent.</span>
<span class="c1">#  The default is 2 seconds.</span>
<span class="na">query_topic</span><span class="o">:</span>
<span class="c1">#  The topic used to query command state.  It is expected that the device will</span>
<span class="c1">#  respond by publishing to the "state_topic".  This parameter is optional,</span>
<span class="na">query_payload</span><span class="o">:</span>
<span class="c1">#  The payload to send with the query topic.  This may be a template or a string.</span>
<span class="c1">#  The default is no payload.</span>
<span class="na">query_after_command</span><span class="o">:</span>
<span class="c1">#  If set to True Moonraker will publish the query topic after publishing the</span>
<span class="c1">#  command topic.  This should only be necessary if the device does not publish a</span>
<span class="c1">#  response to a command request to the state topic.  The default is False.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Moonraker's MQTT client must be properly configured to add a MQTT device.
See the <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt">mqtt</a> section for details.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>MQTT is the most robust way of managing networked devices through
Moonraker.  A well implemented MQTT device will publish all
changes in state to the <code>state_topic</code>.  Moonraker receives these changes,
updates its internal state, and notifies connected clients.  This allows
for device control outside of Moonraker.  Note however that post command
actions, such as bound services, will not be run if a device is toggled
outside of Moonraker.</p>
</div>
<p>Example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_34"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_34 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="c1"># Example configuration for ing with Tasmota firmware over mqtt</span>
<span class="k">[power mqtt_plug]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">mqtt</span>
<span class="na">command_topic</span><span class="o">:</span><span class="w"> </span><span class="s">cmnd/tasmota_switch/POWER</span>
<span class="c1"># Tasmota uses "on" and "off" as the payload, so our template simply renders</span>
<span class="c1"># the command</span>
<span class="na">command_payload</span><span class="o">:</span>
<span class="w">  </span><span class="na">{command}</span>
<span class="c1"># There is no need to set the retain flag for Tasmota devices.  Moonraker</span>
<span class="c1"># will use the query topic to initialize the device.  Tasmota will publish</span>
<span class="c1"># all changes in state to the state topic.</span>
<span class="na">retain_command_state</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1"># To query a tasmota device we send the command topic without a payload.</span>
<span class="c1"># Optionally we could send a "?" as the payload.</span>
<span class="na">query_topic</span><span class="o">:</span><span class="w"> </span><span class="s">cmnd/tasmota_switch/POWER</span>
<span class="c1"># query_payload: ?</span>
<span class="na">state_topic</span><span class="o">:</span><span class="w"> </span><span class="s">stat/tasmota_switch/POWER</span>
<span class="c1"># The response is either "ON" or "OFF".  Moonraker will handle converting to</span>
<span class="c1"># lower case.</span>
<span class="na">state_response_template</span><span class="o">:</span>
<span class="w">  </span><span class="na">{payload}</span>
<span class="c1"># Tasmota updates the state topic when the device state changes, so it is not</span>
<span class="c1"># not necessary to query after a command</span>
<span class="na">query_after_command</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
</code></pre></div>
<h5 id="discarding-responses">Discarding Responses<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#discarding-responses" title="Permanent link"></a></h5>
<p>Some devices may publish a response prior executing a power request, then
publish an additional response after.  The context provided to the
<code>state_response_template</code> includes two variables in addition to the <code>payload</code>
that can be used to discard undesirable responses:</p>
<ul>
<li><code>last_request</code>: The name of the last requested action, will be <code>refresh</code>,
  <code>power_on</code>, <code>power_off</code>.  Will be an empty string in the scenario where an
  update is published outside of a request from Moonraker.</li>
<li><code>response_count</code>: The number of responses received since Moonraker last
  requested an action from the MQTT device.</li>
</ul>
<p>An example using the above variables to discard a response may look like the
following:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_35"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_35 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="c1"># Example configuration for ing with Tasmota firmware over mqtt</span>
<span class="k">[power mqtt_plug]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">mqtt</span>
<span class="na">state_response_template</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Discard the first response for power on and power off requests</span>
<span class="w">  </span><span class="na">{% if response_count</span><span class="w"> </span><span class="o">=</span><span class="s">= 1 and last_request.startswith("power_") %}</span>
<span class="w">    </span><span class="na">discard</span>
<span class="w">  </span><span class="na">{% else %}</span>
<span class="w">    </span><span class="c1"># render the payload of the second response for power requests, and the</span>
<span class="w">    </span><span class="c1"># first response for refresh requests or updates published as a result</span>
<span class="w">    </span><span class="c1"># of actions taken outside of Moonraker.</span>
<span class="w">    </span><span class="na">{payload|lower}</span>
<span class="w">  </span><span class="na">{% endif %}</span>
</code></pre></div>
<h4 id="smartthings-http">SmartThings (HTTP)<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#smartthings-http" title="Permanent link"></a></h4>
<div class="admonition attention">
<p class="admonition-title">Important</p>
<p>SmartThings Developer API Topics:</p>
<ul>
<li>See <a href="https://developer-preview.smartthings.com/docs/advanced/authorization-and-permissions/">Getting a Bearer Token</a></li>
<li>See <a href="https://developer-preview.smartthings.com/api/public#operation/getDevices">Getting a list of devices</a></li>
</ul>
</div>
<p>The following options are available for <code>smartthings</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_36"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_36 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">api.smartthings.com</span>
<span class="na">protocol</span><span class="o">:</span><span class="w"> </span><span class="s">https</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">443</span>
<span class="na">token</span><span class="o">:</span>
<span class="c1">#   A token used for request authorization.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details. This parameter</span>
<span class="c1">#   must be provided.</span>
<span class="na">device</span><span class="o">:</span>
<span class="c1">#   The Device guid of the switch to control. This parameter must be provided.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<p>Example:
</p><div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_37"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_37 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power smartthings_switch]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">smartthings</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">api.smartthings.com</span>
<span class="na">protocol</span><span class="o">:</span><span class="w"> </span><span class="s">https</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">443</span>
<span class="na">token</span><span class="o">:</span><span class="w"> </span><span class="s">smartthings-bearer-token</span>
<span class="na">device</span><span class="o">:</span><span class="w"> </span><span class="s">smartthings-device-id</span>
</code></pre></div><p></p>
<h4 id="domoticz-http">Domoticz (HTTP)<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#domoticz-http" title="Permanent link"></a></h4>
<p>Here an example for a Domoticz Light/Switch device with idx 1234.
https://www.domoticz.com/wiki/Domoticz_API/JSON_URL%27s#Turn_a_light.2Fswitch_on.2Foff</p>
<p>Authentication with basic header stored in Moonraker.secrets (see the [secrets]
documentation for details).
You have to convert your "username:password" to base64 and put in Moonraker.secrets file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If http unsecure is required, configure Domoticz to allow basic auth on http.
https://www.domoticz.com/wiki/Security#API_Protection</p>
</div>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_38"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_38 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="k">[power printer_domoticz]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">http</span>
<span class="na">on_url</span><span class="o">:</span><span class="w"> </span><span class="s">https://domoticz-ip&lt;:port&gt;/json.htm?type=command&amp;param=switchlight&amp;switchcmd=On&amp;idx=1234</span>
<span class="na">off_url</span><span class="o">:</span><span class="w"> </span><span class="s">https://domoticz-ip&lt;:port&gt;/json.htm?type=command&amp;param=switchlight&amp;switchcmd=Off&amp;idx=1234</span>
<span class="na">status_url</span><span class="o">:</span><span class="w"> </span><span class="s">https://domoticz-ip&lt;:port&gt;/json.htm?type=command&amp;param=getdevices&amp;rid=1234</span>
<span class="na">request_template</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% do http_request.add_header("Authorization", "Basic %s" % secrets.domoticz_credentials.base64userpass) %}</span>
<span class="w">  </span><span class="na">{% do http_request.send() %}</span>
<span class="na">response_template</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Domoticz does not return device state in the response to on and off</span>
<span class="w">  </span><span class="c1"># commands making it necessary to request device status.</span>
<span class="w">  </span><span class="na">{% if command in ["on", "off"] %}</span>
<span class="w">    </span><span class="c1"># Some delay is necessary to ensure that Domoticz has finished processing</span>
<span class="w">    </span><span class="c1"># the command.  This example sleeps for 1 second, more or less may be required</span>
<span class="w">    </span><span class="c1"># depending on the type of switch, speed of the Domoticz host, etc.</span>
<span class="w">    </span><span class="na">{% do async_sleep(1.0) %}</span>
<span class="w">    </span><span class="c1"># Set the request method, clear the body, set the url</span>
<span class="w">    </span><span class="na">{% do http_request.set_method("GET") %}</span>
<span class="w">    </span><span class="na">{% do http_request.set_body(None) %}</span>
<span class="w">    </span><span class="na">{% do http_request.set_url(urls.status) %}</span>
<span class="w">    </span><span class="c1"># Note: The Authorization header was set in the "request_template".  Since the</span>
<span class="w">    </span><span class="c1"># http request object is shared between both templates it is not necessary to</span>
<span class="w">    </span><span class="c1"># add it again unless we perform a "reset()" on the request.</span>
<span class="w">    </span><span class="na">{% set response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http_request.send() %}</span>
<span class="w">    </span><span class="c1"># Raise an exception if we don't get a successful response.  This is handled</span>
<span class="w">    </span><span class="c1"># for us after executing the response template, however sending a request here</span>
<span class="w">    </span><span class="c1"># requires that</span>
<span class="w">    </span><span class="na">{% do response.raise_for_status() %}</span>
<span class="w">  </span><span class="na">{% endif %}</span>
<span class="w">  </span><span class="c1"># We use the `last_response` method to fetch the result and decode the</span>
<span class="w">  </span><span class="c1"># json response.</span>
<span class="w">  </span><span class="na">{% set resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http_request.last_response().json() %}</span>
<span class="w">  </span><span class="c1"># The expression below will render "on" or "off".</span>
<span class="w">  </span><span class="na">{resp.result[0].Status.lower()}</span>
</code></pre></div>
<h4 id="hue-device-configuration">Hue Device Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#hue-device-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>hue</code> device types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_39"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_39 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="na">address</span><span class="o">:</span>
<span class="c1">#   A valid ip address or hostname of the Philips Hue Bridge. This</span>
<span class="c1">#   parameter must be provided.</span>
<span class="na">port</span><span class="o">:</span>
<span class="c1">#   A port number if an alternative Zigbee bridge is used on a HTTP port</span>
<span class="c1">#   different from the default 80/443</span>
<span class="na">user</span><span class="o">:</span>
<span class="c1">#   The api key used for request authorization.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details.</span>
<span class="c1">#   An explanation how to get the api key can be found here:</span>
<span class="c1">#   https://developers.meethue.com/develop/get-started-2/#so-lets-get-started</span>
<span class="na">device_id</span><span class="o">:</span>
<span class="c1">#   The device id of the light/socket you want to control.</span>
<span class="c1">#   An explanation on how you could get the device id, can be found here:</span>
<span class="c1">#   https://developers.meethue.com/develop/get-started-2/#turning-a-light-on-and-off</span>
<span class="na">device_type</span><span class="o">:</span><span class="w"> </span><span class="s">light</span>
<span class="c1">#   Set to light to control a single hue light, or group to control a hue light group.</span>
<span class="c1">#   If device_type is set to light, the device_id should be the light id,</span>
<span class="c1">#   and if the device_type is group, the device_id should be the group id.</span>
<span class="c1">#   The default is "light".</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<h4 id="usb-uhubctl-devices">USB (uhubctl) devices<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#usb-uhubctl-devices" title="Permanent link"></a></h4>
<p>Support for toggling USB powered devices via <a href="https://github.com/mvp/uhubctl">uhubctl</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The host machine must have <code>uhubctl</code> installed as a prerequisite.  In addition,
the required <a href="https://github.com/mvp/uhubctl#linux-usb-permissions">udev rules</a>
must be installed on the host to give Moonraker permission to toggle hub
power without sudo.</p>
</div>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_40"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_40 &gt; code"></button><code><span class="na">location</span><span class="o">:</span>
<span class="c1">#  Device location of the USB Hub connected to the device to control.  The</span>
<span class="c1">#  location corresponds to the "-l" option of "uhubctl". This parameter</span>
<span class="c1">#  must be provided.</span>
<span class="na">port</span><span class="o">:</span>
<span class="c1">#  Port of the USB device to control.  The port corresponds to the "-p"</span>
<span class="c1">#  option of "ububctl".  When omitted no port is provided to the uhubctl</span>
<span class="c1">#  command.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code>uhubctl</code> software can be used to list all compatible hubs on the
system by simply executing <code>uhubctl</code> with no arguments.  The following
is example output from a Raspberry Pi 3B+:</p>
<div class="highlight"><pre id="__code_41"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_41 &gt; code"></button><code tabindex="0">Current status for hub 1-1.1 [0424:2514, USB 2.00, 3 ports, ppps]
  Port 1: 0503 power highspeed enable connect [0424:7800]
  Port 2: 0100 power
  Port 3: 0100 power
Current status for hub 1-1 [0424:2514, USB 2.00, 4 ports, ppps]
  Port 1: 0503 power highspeed enable connect [0424:2514, USB 2.00, 3 ports, ppps]
  Port 2: 0100 power
  Port 3: 0103 power enable connect [1d50:614e Klipper rp2040 45503571290B1068]
  Port 4: 0100 power
Current status for hub 1 [1d6b:0002 Linux 6.6.28+rpt-rpi-v7 dwc_otg_hcd DWC OTG Controller 3f980000.usb, USB 2.00, 1 ports, ppps]
  Port 1: 0503 power highspeed enable connect [0424:2514, USB 2.00, 4 ports, ppps]
</code></pre></div>
</div>
<h5 id="example">Example<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#example" title="Permanent link"></a></h5>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_42"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_42 &gt; code"></button><code><span class="c1"># moonraker.config</span>

<span class="c1"># Example for controlling a device connected to a Raspberry Pi 3B+.</span>
<span class="c1"># Location 1-1 Port 2 controls power for all 4 exposed ports.</span>
<span class="k">[power my_usb_dev]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">uhubctl</span>
<span class="na">location</span><span class="o">:</span><span class="w"> </span><span class="s">1-1</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">2</span>
</code></pre></div>
<h4 id="generic-http-devices">Generic HTTP Devices<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#generic-http-devices" title="Permanent link"></a></h4>
<p>Support for configurable HTTP switches.  This device type may be used when
no specific implementation is available for a switch.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_43"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_43 &gt; code"></button><code><span class="na">on_url</span><span class="o">:</span>
<span class="na">off_url</span><span class="o">:</span>
<span class="na">status_url</span><span class="o">:</span>
<span class="c1">#   The urls used to control a device and report its status.  These options</span>
<span class="c1">#   accept Jinja2 templates with access to "secrets", see the [secrets]</span>
<span class="c1">#   documentation for details.  It is required that any special characters</span>
<span class="c1">#   be escaped per RFC 3986 section 2.  These options must be provided.</span>
<span class="na">request_template</span><span class="o">:</span>
<span class="c1">#   An optional Jinja2 template used to customize the http request.  This</span>
<span class="c1">#   template can set the request method, additional headers, and the body.</span>
<span class="c1">#   When this option is not specified all commands will use a "GET" method</span>
<span class="c1">#   with no body and no additional headers.</span>
<span class="na">response_template</span><span class="o">:</span>
<span class="c1">#   A Jinja2 template used to process the http response for each command.  This</span>
<span class="c1">#   template should always render to "on" or "off" based on the response.  See</span>
<span class="c1">#   the following section for details on the fields provided to the Jinja2</span>
<span class="c1">#   context.  This parameter must be provided.</span>
<span class="na">poll_interval</span><span class="o">:</span>
<span class="c1">#   A float indicating the number of seconds between each status request when</span>
<span class="c1">#   polling the device.  The minimum value is 1.0 seconds.  When this option</span>
<span class="c1">#   is omitted polling is disabled.</span>
</code></pre></div>
<h6 id="the-template-context">The template context<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#the-template-context" title="Permanent link"></a></h6>
<p>The <code>request_template</code> and <code>response_template</code> options are each provided
a Jinja2 context with the following fields:</p>
<ul>
<li><code>command</code>: The command associated with this call.  Will be one of "on"
  "off", or "status".</li>
<li><code>async_sleep</code>:  An alias for the <code>asyncio.sleep</code> method.  This may be used
  to add delays if necessary.</li>
<li><code>log_debug</code>: An alias for <code>logging.debug</code>.  This can be used to log messages
  and data to <code>moonraker.log</code> to aid in debugging an implementation.  Note that
  verbose logging must be
  <a href="https://moonraker.readthedocs.io/en/latest/installation/#debug-options-for-developers">enabled</a> for these messages
  to appear in the log.</li>
<li><code>http_request</code>: A request object used to build and send http requests.
  This object exposes several methods detailed in the following section.
  When a <code>request_template</code> is configured it will share the same http
  request object with the <code>response_template</code>.</li>
<li><code>urls</code>: A <code>Dict</code> object containing the configured urls for each command.
  Specifically this object contains "on", "off", and "status" fields, where
  each field points to the url specified in the configuration.</li>
</ul>
<h6 id="the-http-request-object">The HTTP Request object<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-request-object" title="Permanent link"></a></h6>
<p>The HTTP Request Object is a wrapper around Moonraker's internal HTTP Client
that facilitates building HTTP requests. By default the request object will be
initialized as a "GET" request with the URL configured for the specified command
(ie: if the command is <code>on</code> then the request is initialized with the <code>on_url</code>).
The request provides the following methods that may be called from a Jinja2
script:</p>
<p><strong><code>http_request.set_method(method)</code></strong></p>
<blockquote>
<p>Sets the request method (ie: <code>GET</code>, <code>POST</code>, <code>PUT</code>).</p>
</blockquote>
<p><strong><code>http_request.set_url(url)</code></strong></p>
<blockquote>
<p>Sets the request URL.  Reserved characters in the url must be encoded
per <a href="https://www.rfc-editor.org/rfc/rfc3986#section-2">RFC3986</a>.</p>
</blockquote>
<p><strong><code>http_request.set_body(body)</code></strong></p>
<blockquote>
<p>Sets the request body.  This may be a <code>string</code>, <code>List</code>, or <code>Dict</code> object.
<code>List</code> and <code>Dict</code> objects will be encoded to json and the <code>Content-Type</code>
header will be set to <code>application/json</code>.</p>
</blockquote>
<p><strong><code>http_request.add_header(name, value)</code></strong></p>
<blockquote>
<p>Adds a request header.</p>
</blockquote>
<p><strong><code>http_request.set_headers(headers)</code></strong></p>
<blockquote>
<p>Sets the request headers to supplied <code>Dict</code> object.  This will overwrite any
headers previously added or set.</p>
</blockquote>
<p><strong><code>http_request.reset()</code></strong></p>
<blockquote>
<p>Resets the request object to the default values.  The request method will be
set to <code>GET</code>, the body will be empty, and the headers will be cleared.  The
url will be reset to the configured URL for the current command.</p>
</blockquote>
<p><strong><code>http_request.last_response()</code></strong></p>
<blockquote>
<p>Returns the most recent <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-response-object">HTTP response</a>.  If no
request has been sent this will return <code>None</code>.</p>
</blockquote>
<p><strong><code>http_request.send(**kwargs)</code></strong></p>
<blockquote>
<p>Sends the request and returns an <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-response-object">HTTP response</a>.</p>
</blockquote>
<h6 id="the-http-response-object">The HTTP Response object<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#the-http-response-object" title="Permanent link"></a></h6>
<p>A response object provides access to http response data.  The methods and
properties available will look familiar for those who have experience with
the Python <code>requests</code> module.</p>
<p><strong><code>http_response.json()</code></strong></p>
<blockquote>
<p>Decodes the body and returns a resulting <code>Dict</code>.</p>
</blockquote>
<p><strong><code>http_response.has_error()</code></strong></p>
<blockquote>
<p>Returns if the response is an error.  This is typically true if
the response returns a status code outside of the 200-299 range.</p>
</blockquote>
<p><strong><code>http_response.raise_for_status(message=None)</code></strong></p>
<blockquote>
<p>Raises an exception if the response is an error.  The optional "message"
may be specified to replace the error message received from the response.</p>
</blockquote>
<p><strong><code>http_response.text</code></strong></p>
<blockquote>
<p>A property that returns the body as a UTF-8 encoded string.</p>
</blockquote>
<p><strong><code>http_response.content</code></strong></p>
<blockquote>
<p>A property that returns the body as a python <code>bytes</code> object.</p>
</blockquote>
<p><strong><code>http_response.url</code></strong></p>
<blockquote>
<p>A property that returns the url of the request associated with this response.</p>
</blockquote>
<p><strong><code>http_response.final_url</code></strong></p>
<blockquote>
<p>A property that returns "effective" url of the request after all redirects.</p>
</blockquote>
<p><strong><code>http_response.headers</code></strong></p>
<blockquote>
<p>A property that returns the response headers as a python <code>Dict</code>.</p>
</blockquote>
<p><strong><code>http_response.status_code</code></strong></p>
<blockquote>
<p>A property that returns the HTTP status code received with the response.</p>
</blockquote>
<h6 id="examples">Examples<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#examples" title="Permanent link"></a></h6>
<p>The following examples re-implement some of the <code>[power]</code> modules existing
types using generic http.  The first example shows how a <a href="https://moonraker.readthedocs.io/en/latest/configuration/#tasmota-configuration">tasmota</a>
switch may be implemented.  Tasmota depends on <code>GET</code> http requests for all actions,
making it the most simple type of generic implementation:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_44"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_44 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="k">[power generic_tasmota]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">http</span>
<span class="na">on_url</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Build the query string so we can encode it.  This example assumes a password is</span>
<span class="w">  </span><span class="c1"># supplied in a "secrets" file.  If no password is required the "password" field can</span>
<span class="w">  </span><span class="c1"># be omitted or set to an empty string</span>
<span class="w">  </span><span class="na">{% set qs = {"user"</span><span class="o">:</span><span class="w"> </span><span class="s">"admin"</span><span class="na">, "password": secrets.tasmota.password, "cmnd"</span><span class="o">:</span><span class="w"> </span><span class="s">"Power1 on"</span><span class="na">} %}</span>
<span class="w">  </span><span class="na">http</span><span class="o">:</span><span class="s">//tasmota-switch.lan/cm?{qs|urlencode}</span>
<span class="na">off_url</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set qs = {"user"</span><span class="o">:</span><span class="w"> </span><span class="s">"admin"</span><span class="na">, "password": secrets.tasmota.password, "cmnd"</span><span class="o">:</span><span class="w"> </span><span class="s">"Power1 off"</span><span class="na">} %}</span>
<span class="w">  </span><span class="na">http</span><span class="o">:</span><span class="s">//tasmota-switch.lan/cm?{qs|urlencode}</span>
<span class="na">status_url</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set qs = {"user"</span><span class="o">:</span><span class="w"> </span><span class="s">"admin"</span><span class="na">, "password": secrets.tasmota.password, "cmnd"</span><span class="o">:</span><span class="w"> </span><span class="s">"Power1"</span><span class="na">} %}</span>
<span class="w">  </span><span class="na">http</span><span class="o">:</span><span class="s">//tasmota-switch.lan/cm?{qs|urlencode}</span>
<span class="na">response_template</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># The module will perform the "GET" request using the appropriate url.</span>
<span class="w">  </span><span class="c1"># We use the `last_response` method to fetch the result and decode the</span>
<span class="w">  </span><span class="c1"># json response.  Tasmota devices return a similar response for all</span>
<span class="w">  </span><span class="c1"># commands, so the response does not require special processing.</span>
<span class="w">  </span><span class="na">{% set resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http_request.last_response().json() %}</span>
<span class="w">  </span><span class="c1"># The expression below will render "on" or "off".</span>
<span class="w">  </span><span class="na">{resp["POWER1"].lower()}</span>
</code></pre></div>
<p>The next example implements a <a href="https://moonraker.readthedocs.io/en/latest/configuration/#home-assistant-configuration-http">Home Assistant</a>
device.  Home Assistant requires <code>POST</code> requests for the on and off commands,
and a <code>GET</code> request for the status command.  The Home Assistant API uses Token
based authentication, requiring that the request add an <code>Authorization</code> header.
Finally, the on and off HTTP requests do not consistently return device state,
making necessary to send a status request after an on or off request.</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_45"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_45 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="k">[power generic_homeassistant]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">http</span>
<span class="na">on_url</span><span class="o">:</span><span class="w"> </span><span class="s">http://homeassistant.lan:8123/api/services/switch/turn_on</span>
<span class="na">off_url</span><span class="o">:</span><span class="w"> </span><span class="s">http://homeassistant.lan:8123/api/services/switch/turn_off</span>
<span class="na">status_url</span><span class="o">:</span><span class="w"> </span><span class="s">http://homeassistant.lan:8123/api/states/switch.test_switch</span>
<span class="na">request_template</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Home Assistant uses token authorization, add the correct authorization header</span>
<span class="w">  </span><span class="na">{% do http_request.add_header("Authorization", "Bearer %s" % secrets.homeassistant.token) %}</span>
<span class="w">  </span><span class="na">{% if command in ["on", "off"] %}</span>
<span class="w">    </span><span class="c1"># On and Off commands are POST requests.  Additionally they require that we add</span>
<span class="w">    </span><span class="c1"># a json body.  The content type header will be automatically set for us in this</span>
<span class="w">    </span><span class="c1"># instance.</span>
<span class="w">    </span><span class="na">{% do http_request.set_method("POST") %}</span>
<span class="w">    </span><span class="na">{% do http_request.set_body({"entity_id"</span><span class="o">:</span><span class="w"> </span><span class="s">"switch.test_switch"</span><span class="na">}) %}</span>
<span class="w">  </span><span class="na">{% endif %}</span>
<span class="w">  </span><span class="na">{% do http_request.send() %}</span>
<span class="na">response_template</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Home Assistant does not return device state in the response to on and off</span>
<span class="w">  </span><span class="c1"># commands making it necessary to request device status.</span>
<span class="w">  </span><span class="na">{% if command in ["on", "off"] %}</span>
<span class="w">    </span><span class="c1"># Some delay is necessary to ensure that Home Assistant has finished processing</span>
<span class="w">    </span><span class="c1"># the command.  This example sleeps for 1 second, more or less may be required</span>
<span class="w">    </span><span class="c1"># depending on the type of switch, speed of the Home Assistant host, etc.</span>
<span class="w">    </span><span class="na">{% do async_sleep(1.0) %}</span>
<span class="w">    </span><span class="c1"># Set the request method, clear the body, set the url</span>
<span class="w">    </span><span class="na">{% do http_request.set_method("GET") %}</span>
<span class="w">    </span><span class="na">{% do http_request.set_body(None) %}</span>
<span class="w">    </span><span class="na">{% do http_request.set_url(urls.status) %}</span>
<span class="w">    </span><span class="c1"># Note: The Authorization header was set in the "request_template".  Since the</span>
<span class="w">    </span><span class="c1"># http request object is shared between both templates it is not necessary to</span>
<span class="w">    </span><span class="c1"># add it again unless we perform a "reset()" on the request.</span>
<span class="w">    </span><span class="na">{% set response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http_request.send() %}</span>
<span class="w">    </span><span class="c1"># Raise an exception if we don't get a successful response.  This is handled</span>
<span class="w">    </span><span class="c1"># for us after executing the response template, however sending a request here</span>
<span class="w">    </span><span class="c1"># requires that</span>
<span class="w">    </span><span class="na">{% do response.raise_for_status() %}</span>
<span class="w">  </span><span class="na">{% endif %}</span>
<span class="w">  </span><span class="na">{% set resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">http_request.last_response().json() %}</span>
<span class="w">  </span><span class="na">{resp["state"]}</span>
</code></pre></div>
<h4 id="toggling-device-state-from-klipper">Toggling device state from Klipper<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#toggling-device-state-from-klipper" title="Permanent link"></a></h4>
<p>It is possible to toggle device power from the Klippy host, this can be done
with a gcode_macro, such as:
</p><div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_46"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_46 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro POWER_OFF_PRINTER]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method(</span>
<span class="w">    </span><span class="na">"set_device_power", device</span><span class="o">=</span><span class="s">"printer"</span><span class="na">, state</span><span class="o">=</span><span class="s">"off"</span>
<span class="w">  </span><span class="na">)}</span>
</code></pre></div><p></p>
<p>The <code>device</code> parameter must be the name of a configured power device.
The <code>state</code> parameter must be <code>on</code>, <code>off</code>, or <code>toggle</code>.  In the example above
a device configured as <code>[power printer]</code> will be powered off.</p>
<p>The <code>POWER_OFF_PRINTER</code> gcode can be run to turn off the "printer" device.
This could be used in conjunction with Klipper's idle timeout to turn the
printer off when idle with a configuration similar to that of below:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_47"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_47 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[delayed_gcode delayed_printer_off]</span>
<span class="na">initial_duration</span><span class="o">:</span><span class="w"> </span><span class="s">0.</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% if printer.idle_timeout.state =</span><span class="o">=</span><span class="w"> </span><span class="s">"Idle"</span><span class="w"> </span><span class="na">%}</span>
<span class="w">    </span><span class="na">POWER_OFF_PRINTER</span>
<span class="w">  </span><span class="na">{% endif %}</span>

<span class="k">[idle_timeout]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">M84</span>
<span class="w">  </span><span class="na">TURN_OFF_HEATERS</span>
<span class="w">  </span><span class="na">UPDATE_DELAYED_GCODE ID</span><span class="o">=</span><span class="s">delayed_printer_off DURATION=60</span>
</code></pre></div>
<h5 id="power-on-a-device-when-a-print-starts">Power on a device when a print starts<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#power-on-a-device-when-a-print-starts" title="Permanent link"></a></h5>
<p>Some users have their logic wired to a separate power supply from heaters,
fans, etc.  This keeps Klipper in the "ready" state when power is removed
from such devices.  It is possible to configure Klipper to power up such
devices just before a print is started by overriding the <code>SDCARD_PRINT_FILE</code>
gcode command.</p>
<p>The following example presumes that the user a <code>[power heaters]</code>
device configured in <code>moonraker.conf</code>:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_48"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_48 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="c1"># Create a Macro to Power on the Heaters.  This is necessary to be</span>
<span class="c1"># sure that the template evaluates the call in the correct order.</span>
<span class="k">[gcode_macro POWER_ON_HEATERS]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method(</span>
<span class="w">    </span><span class="na">"set_device_power", device</span><span class="o">=</span><span class="s">"heaters"</span><span class="na">, state</span><span class="o">=</span><span class="s">"on"</span>
<span class="w">  </span><span class="na">)}</span>

<span class="c1"># Override SDCARD_PRINT_FILE</span>
<span class="k">[gcode_macro SDCARD_PRINT_FILE]</span>
<span class="na">rename_existing</span><span class="o">:</span><span class="w"> </span><span class="s">DO_PRINT</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">   </span><span class="c1"># Step 1: Call the remote method to turn on the power device</span>
<span class="w">   </span><span class="na">POWER_ON_HEATERS</span>
<span class="w">   </span><span class="c1"># Step 2: Pause while the device powers up.  The following example</span>
<span class="w">   </span><span class="c1"># pauses for 4 seconds.  It may be necessary to tweak this value.</span>
<span class="w">   </span><span class="na">G4 P4000</span>
<span class="w">   </span><span class="c1"># Step 3: Call the renamed command to start the print</span>
<span class="w">   </span><span class="na">DO_PRINT {rawparams}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>SDCARD_PRINT_FILE</code> G-Code command will be executed when a Moonraker
forwards a request to start a print.  Do not put this command in a G-Code
file or in a macro that is run from a G-Code file.  This will result in an
<code>SD Busy</code> error and abort the print.</p>
</div>
<h5 id="force-a-power-device-to-change-state-during-a-print">Force a power device to change state during a print<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#force-a-power-device-to-change-state-during-a-print" title="Permanent link"></a></h5>
<p>Another exotic use case is the addition of a "conditional" peripheral,
such as an MMU device.  The user may not wish to power on this device
for every print, and instead power it on from within the "Start G-GCode"
conditionally.  Additionally we do not want this device to be turned on/off
unintentionally during a print.  The <code>set_device_power</code> remote method takes
an optional <code>force</code> argument that can be used to accommodate this scenario.</p>
<p>The following example presumes that the user has a <code>[power mmu]</code> device
configured in <code>moonraker.conf</code> with the <code>locked_when_printing</code> option
set to <code>True</code>.  The slicer would be configured to set <code>USE_MMU=1</code> for
the print start macro when the MMU is in use.</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_49"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_49 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro POWER_ON_MMU]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method(</span>
<span class="w">    </span><span class="na">"set_device_power", device</span><span class="o">=</span><span class="s">"mmu"</span><span class="na">, state</span><span class="o">=</span><span class="s">"on"</span><span class="na">, force</span><span class="o">=</span><span class="s">True</span>
<span class="w">  </span><span class="na">)}</span>

<span class="k">[gcode_macro PRINT_START]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set use_mmu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.USE_MMU|default(0)|int %}</span>
<span class="w">  </span><span class="na">{% if use_mmu $}</span>
<span class="w">    </span><span class="c1"># Turn on power supply for extruders/bed</span>
<span class="w">    </span><span class="na">POWER_ON_MMU</span>
<span class="w">    </span><span class="c1"># Add a bit of delay to give the switch time</span>
<span class="w">    </span><span class="na">G4 P2000</span>
<span class="w">  </span><span class="na">{% endif %}</span>
<span class="w">  </span><span class="c1"># Add the rest of your "Start G-Code"...</span>
</code></pre></div>
<h4 id="power-on-g-code-uploads">Power on G-Code Uploads<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#power-on-g-code-uploads" title="Permanent link"></a></h4>
<p>To power on a device after an upload, <code>queue_gcode_uploads: True</code> must
be set in the <code>[file_manager]</code>, <code>load_on_startup: True</code> must be set in
<code>[job_queue]</code> and <code>one_when_job_queued: True</code> must be set in <code>[power dev_name]</code>,
where "dev_name" the the name of your power device.  For example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_50"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_50 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="c1"># Configure the file manager to queue uploaded files when the "start" flag</span>
<span class="c1"># is set and Klipper cannot immediately start the print.</span>
<span class="k">[file_manager]</span>
<span class="na">queue_gcode_uploads</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>


<span class="c1"># Configure the Job Queue to start a queued print when Klipper reports as</span>
<span class="c1"># ready.</span>
<span class="k">[job_queue]</span>
<span class="na">load_on_startup</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1"># Configure the job_transition_delay and job_transition_gcode options</span>
<span class="c1"># if desired.  Note that they do no apply to prints loaded on startup.</span>

<span class="c1"># Configure the "power" device to turn on when jobs are queued.</span>
<span class="k">[power printer]</span>
<span class="na">on_when_job_queued</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1"># configure the type and any type specific options.  This example</span>
<span class="c1"># uses a gpio</span>
<span class="c1">#type: gpio</span>
<span class="c1">#pin: gpio26</span>
<span class="c1">#initial_state: off</span>
</code></pre></div>
<p>With the above configuration options set, an upload with the "start"
flag set to true will be queued.  This "printer" device will be
notified and powered on.  Finally, the job_queue will load and start
the queued print after Klipper reports itself as "ready".</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This procedure assumes that the printer is powered off when the
gcode file is uploaded.  It also assumes that the <code>job_queue</code> is
empty, if any jobs exist in the queue then the next job on the
queue will be loaded.</p>
</div>
<h4 id="external-power-events">External Power Events<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#external-power-events" title="Permanent link"></a></h4>
<p>Many switches are capable of operation outside of Moonraker's scope. When these
devices are toggled by an external source their state may become inconsistent
with Moonraker's internal state.  Some device types, such as <code>mqtt</code> and
<code>klipper_device</code>, receive status updates asynchronously, avoiding consistency
issues.  Consistency with other devices may be resolved by configuring the
<code>poll_interval</code> option, which enables device status polling.</p>
<p>When an external state change is detected, Moonraker updates its internal state and
notifies all connected clients.  By default Moonraker will not run any post
event actions, such as restarting Klippy or managing bound services, when devices
are toggled outside of Moonraker.  This behavior may be overridden per device by
setting the <code>restrict_action_processing</code> option to <code>False</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>External events do not apply to <code>gpio</code> and <code>rf</code> devices.  When a gpio
is configured Moonraker retains exclusive control over it.  RF devices
are not capable of receiving status updates.</p>
</div>
<h3 id="update_manager"><code>[update_manager]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#update_manager" title="Permanent link"></a></h3>
<p>This enables moonraker's update manager.  Note that updates can only be
performed on pristine git repos.  Repos that have been modified on
disk or cloned from unofficial sources are not supported.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_51"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_51 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="k">[update_manager]</span>
<span class="na">enable_auto_refresh</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   When set to True, Moonraker will check roughly every 1 hour (only within</span>
<span class="c1">#   the update window) whether it's time to fetch status about available updates.</span>
<span class="c1">#   When set to False Moonraker will only fetch update state on startup</span>
<span class="c1">#   and clients will need to request that Moonraker updates state.  The</span>
<span class="c1">#   default is False.</span>
<span class="na">refresh_window</span><span class="o">:</span><span class="w"> </span><span class="s">0-5</span>
<span class="c1">#   The hours between which the periodic update check will be done.</span>
<span class="c1">#   Default is 0-5, meaning the refresh can only occur from midnight until 5am.</span>
<span class="c1">#   It can go over midnight, e.g. 22-6.</span>
<span class="na">refresh_interval</span><span class="o">:</span><span class="w"> </span><span class="s">672</span>
<span class="c1">#   The default interval (in hours) between which the update manager will</span>
<span class="c1">#   check for new updates.  The default is 672 hours (28 days).</span>
<span class="na">enable_system_updates</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   A boolean value that can be used to toggle system package updates.</span>
<span class="c1">#   Currently Moonraker only supports updating packages via APT, so</span>
<span class="c1">#   this option is useful for users that wish to experiment with linux</span>
<span class="c1">#   distros that use other package management applications, or users</span>
<span class="c1">#   that prefer to manage their packages directly.  Note that if this</span>
<span class="c1">#   is set to False users will be need to make sure that all system</span>
<span class="c1">#   dependencies are up to date.  The default is True.</span>
<span class="na">enable_packagekit</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   This option is available when system updates are enabled via the</span>
<span class="c1">#   "enable_system_updates" option.  When set to True, system package</span>
<span class="c1">#   updates will be processed via PackageKit over D-Bus.  When set to False</span>
<span class="c1">#   the "apt cli" fallback will be used.  The default is True.</span>
<span class="na">channel</span><span class="o">:</span><span class="w"> </span><span class="s">dev</span>
<span class="c1">#   The default update channel applied to Klipper and Moonraker.  May be</span>
<span class="c1">#   stable, beta, or dev.  The dev channel will update to the latest commit</span>
<span class="c1">#   pushed to the repo, whereas the beta channel will update to the latest</span>
<span class="c1">#   commit tagged by Moonraker.  The beta and stable channels will see less</span>
<span class="c1">#   frequent updates.  When omitted, Moonraker and Klipper will default to</span>
<span class="c1">#   the channel based extension type.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Configuration is automatically detected for Moonraker and Klipper, however
it is possible to override the <code>channel</code>, <code>pinned_commit</code>, and
<code>refresh_interval</code> options on a per application basis for each.  This can be
done by specifying the configuration in <code>moonraker.conf</code>.  For example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_52"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_52 &gt; code"></button><code><span class="k">[update_manager klipper]</span>
<span class="na">channel</span><span class="o">:</span><span class="w"> </span><span class="s">dev</span>
<span class="na">pinned_commit</span><span class="o">:</span><span class="w"> </span><span class="s">79930ed99a1fc284f41af5755908aa1fab948ce1</span>
<span class="na">refresh_interval</span><span class="o">:</span><span class="w"> </span><span class="s">168</span>
</code></pre></div>
</div>
<h4 id="extension-configuration">Extension Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#extension-configuration" title="Permanent link"></a></h4>
<p>The update manager may be configured manage additional software, henceforth
referred to as "extensions".  In general terms, an extension may be defined
as a piece of software hosted on GitHub.  The update manager breaks this
down into 4 basic types:</p>
<ul>
<li><code>web</code>: A front-end such as Mainsail or Fluidd.  Updates are deployed via
  zip files created for GitHub releases.</li>
<li><code>git_repo</code>:  Used to manage extensions that do not fall into the "web" type.
  Updates are deployed directly via git.  Typical usage scenarios are to
  manage extensions installed a service such as KlipperScreen, repos containing
  configuration, and unofficial 3<sup>rd</sup> party extensions for Klipper and Moonraker.
  See the note below in reference to unofficial extensions.</li>
<li><code>zip</code>:  This can be used to manage various extensions like the <code>git_repo</code>
  type, however its updates are deployed via zipped GitHub releases.</li>
<li><code>executable</code>:  Like the <code>zip</code> type this can be used to manage applications
  and extensions.  An executable type must be a pre-built binary executable
  file hosted on GitHub.</li>
<li><code>python</code>:  The python type can be used to update python applications installed
  using <code>pip</code> in a virtual environment.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To benefit the community Moonraker facilitates updates for 3<sup>rd</sup> party
"Klippy Extras" and "Moonraker Components".  While many of these
extensions are well developed and tested, users should always be
careful when using such code extensions.  Moonraker and Klipper provide
no official support for such extensions, thus users experiencing an
issue should not create bug reports on the Klipper or Moonraker issue
trackers without first reproducing the issue using pristine versions
of Moonraker and/or Klipper.</p>
</div>
<h4 id="the-release_infojson-file">The release_info.json file<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#the-release_infojson-file" title="Permanent link"></a></h4>
<p>The <code>web</code>, <code>zip</code>, and <code>executable</code> types require that the install
folder contain a <code>release_info.json</code> file.  This file contains
information the update manager uses to validate the local install.</p>
<div class="md-typeset__scrollwrap"><div class="md-typeset__table"><table id="release-info-json-spec"><caption>Release Info Specification</caption><thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>project_name</code></td>
<td>The name of the GitHub project hosting the software.</td>
</tr>
<tr>
<td><code>project_owner</code></td>
<td>The User or Organization that owns the project.</td>
</tr>
<tr>
<td><code>version</code></td>
<td>The version of the installed software.  This should match the release tag on GitHub.</td>
</tr>
<tr>
<td><code>asset_name</code></td>
<td>The name of the asset to download on GitHub.  This is optional for <code>web</code> and <code>zip</code> types, they will default to <code>{config_section_name}.zip</code>.  The <code>executable</code> type <strong>REQUIRES</strong> this field.</td>
</tr>
</tbody>
</table></div></div>
<div class="highlight"><span class="filename">Web Type Release Info Example</span><pre id="__code_53"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_53 &gt; code"></button><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"project_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mainsail"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"project_owner"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mainsail-crew"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v2.5.1"</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><span class="filename">Executable Type Release Info Example</span><pre id="__code_54"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_54 &gt; code"></button><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"project_name"</span><span class="p">:</span><span class="s2">"klipper_estimator"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"project_owner"</span><span class="p">:</span><span class="s2">"Annex-Engineering"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"version"</span><span class="p">:</span><span class="s2">"v3.7.3"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"asset_name"</span><span class="p">:</span><span class="s2">"klipper_estimator_rpi"</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Moonraker automatically creates the above <code>release_info.json</code>
file for Klipper Estimator when the <a href="https://moonraker.readthedocs.io/en/latest/configuration/#analysis">analysis</a>
section is configured in <code>moonraker.conf</code>.  When the
<code>enable_updates</code> option is enabled Moonraker will register
Klipper Estimator with the update manager, so there is no
need to add a <code>[update manager klipper_estimator]</code> section
to the configuration.</p>
</div>
<h4 id="web-type-front-end-configuration">Web type (front-end) configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#web-type-front-end-configuration" title="Permanent link"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Software using the <code>web</code> type should host their distribution
in a zip file as a GitHub release.  The zip file MUST contain
<a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-release_infojson-file">release_info.json</a>.</p>
</div>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_55"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_55 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[update_manager extension_name]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">web</span>
<span class="c1">#   The management type.  This should always be "web" for browser based</span>
<span class="c1">#   front-ends. This parameter must be provided.</span>
<span class="na">channel</span><span class="o">:</span><span class="w"> </span><span class="s">stable</span>
<span class="c1">#   May be stable or beta.  When beta is specified "pre-release"</span>
<span class="c1">#   updates are available.</span>
<span class="na">repo</span><span class="o">:</span>
<span class="c1">#   This is the GitHub repo of the front-end, in the format of owner/repo_name.</span>
<span class="c1">#   For example, this could be set to fluidd-core/fluidd to update Fluidd or</span>
<span class="c1">#   mainsail-crew/mainsail to update Mainsail.  This parameter must be provided.</span>
<span class="na">path</span><span class="o">:</span>
<span class="c1">#   The path to the front-end's files on disk.  This folder must contain a</span>
<span class="c1">#   a previously installed client.   The folder must not be located within a</span>
<span class="c1">#   git repo and it must not be located within a path that Moonraker has</span>
<span class="c1">#   reserved, ie: it cannot share a path with another extension. This parameter</span>
<span class="c1">#   must be provided.</span>
<span class="na">persistent_files</span><span class="o">:</span>
<span class="c1">#   A list of newline separated file names that should persist between</span>
<span class="c1">#   updates.  This is useful for static configuration files, or perhaps</span>
<span class="c1">#   themes.  The default is no persistent files.</span>
<span class="na">refresh_interval</span><span class="o">:</span>
<span class="c1">#   This overrides the refresh_interval set in the primary [update_manager]</span>
<span class="c1">#   section.</span>
<span class="na">info_tags</span><span class="o">:</span>
<span class="c1">#   Optional information tags about this extension that are reported via</span>
<span class="c1">#   Moonraker's API as a list of strings. Each tag should be separated by</span>
<span class="c1">#   a new line. For example:</span>
<span class="c1">#       info_tags:</span>
<span class="c1">#           desc=My Client App</span>
<span class="c1">#           action=webcam_restart</span>
<span class="c1">#   Frontends may use these tags to perform additional actions or display</span>
<span class="c1">#   information, see your extension documentation for details on configuration.</span>
<span class="c1">#   The default is an empty list.</span>
<span class="na">report_anomalies</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   When set to True all detected anomalies are reported to front-ends.  When</span>
<span class="c1">#   set to False anomalies are logged but not reported. For a typical frontend</span>
<span class="c1">#   this can be used to silence messages when it anomalies are expected. The</span>
<span class="c1">#   default is True.</span>
</code></pre></div>
<h4 id="git-repo-configuration">Git Repo Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#git-repo-configuration" title="Permanent link"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Git repos must have at least one tag for Moonraker to identify its
version.  The tag may be lightweight or annotated.  The tag must be in
semantic version format, <code>vX.Y.Z</code>, where X, Y, and Z are all unsigned
integer values.  For example, a repos first tag might be <code>v0.0.1</code>.</p>
<p>Moonraker can update repos without tags, however front ends may disable
update controls when version information is not reported by Moonraker.</p>
</div>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_56"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_56 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="c1"># When defining a service, the "extension_name" must be the name of the</span>
<span class="c1"># systemd service</span>
<span class="k">[update_manager extension_name]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">git_repo</span>
<span class="c1">#   Currently must be git_repo.  This value is set depending on how an</span>
<span class="c1">#   extension chooses to deploy updates, see its documentation for details.</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">channel</span><span class="o">:</span><span class="w"> </span><span class="s">dev</span>
<span class="c1">#   The update channel.  May be set to stable, beta, or dev.</span>
<span class="c1">#   The default is dev.</span>
<span class="na">refresh_interval</span><span class="o">:</span>
<span class="c1">#   This overrides the refresh_interval set in the primary [update_manager]</span>
<span class="c1">#   section.</span>
<span class="na">path</span><span class="o">:</span>
<span class="c1">#   The absolute path to the client's files on disk. This parameter must be</span>
<span class="c1">#   provided.</span>
<span class="c1">#   Example:</span>
<span class="c1">#     path: ~/service_name</span>
<span class="na">origin</span><span class="o">:</span>
<span class="c1">#   The full git URL of the "origin" remote for the repository.  This can</span>
<span class="c1">#   be be viewed by navigating to your repository and running:</span>
<span class="c1">#     git remote -v</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">primary_branch</span><span class="o">:</span>
<span class="c1">#   The name of the primary branch used for release code on this repo.  This</span>
<span class="c1">#   option allows clients to specify 'main', or their own unique name, as</span>
<span class="c1">#   the branch used for repo validity checks.  The default is master.</span>
<span class="na">virtualenv</span><span class="o">:</span>
<span class="c1">#   An optional path to the virtualenv folder for Python Applications. For</span>
<span class="c1">#   example, Moonraker's default virtualenv is located at ~/moonraker-env.</span>
<span class="c1">#   When a virtualenv is specified Moonraker can update its Python</span>
<span class="c1">#   dependencies when it detects a change to the requirements file.  The</span>
<span class="c1">#   default is no virtualenv.</span>
<span class="na">env</span><span class="o">:</span>
<span class="c1">#   *** DEPRECATED FOR NEW CONFIGURATIONS - USE the 'virtualenv' OPTION ***</span>
<span class="c1">#</span>
<span class="c1">#   The path to the extension's virtual environment executable on disk.  For</span>
<span class="c1">#   example, Moonraker's venv is located at ~/moonraker-env/bin/python.</span>
<span class="c1">#   The default is no env, which disables updating python packages.</span>
<span class="na">requirements</span><span class="o">:</span>
<span class="c1">#  This is the location in the repository to the extension's python</span>
<span class="c1">#  requirements file. This location is relative to the root of the repository.</span>
<span class="c1">#  This parameter must be provided if the 'virtualenv' or 'env' option is set,</span>
<span class="c1">#  otherwise it must be omitted.</span>
<span class="na">system_dependencies</span><span class="o">:</span>
<span class="c1">#  A path, relative to the repository, to a json file containing operating</span>
<span class="c1">#  system package dependencies.  Application developers should refer to the</span>
<span class="c1">#  "System Dependencies File Format" section of this document for details on how</span>
<span class="c1">#  this file should be formatted. The default is no system dependencies.</span>
<span class="na">install_script</span><span class="o">:</span>
<span class="c1">#  *** DEPRECATED FOR NEW CONFIGURATIONS - USE the 'system_dependencies' OPTION ***</span>
<span class="c1">#</span>
<span class="c1">#  The file location, relative to the repository, for the installation script</span>
<span class="c1">#  associated with this application.  Moonraker will not run this script, instead</span>
<span class="c1">#  it will parse the script searching for new "system" package dependencies that</span>
<span class="c1">#  require installation.  Packages in the script must be defined as follows for</span>
<span class="c1">#  Moonraker to successfully parse them:</span>
<span class="c1">#      PKGLIST="packagename1 packagename2 packagename3"</span>
<span class="c1">#      PKGLIST="${PKGLIST} packagename4 packagename5"</span>
<span class="c1">#</span>
<span class="c1">#  Note that the "packagenameX" items in the example above should be the names</span>
<span class="c1">#  of valid system packages.  The second line in the example is optional and</span>
<span class="c1">#  additional lines in the same format may be added.</span>
<span class="c1">#</span>
<span class="c1">#  The default is no install script.</span>
<span class="na">enable_node_updates</span><span class="o">:</span>
<span class="c1">#   When set to True, Moonraker will assume that this repo relies upon node</span>
<span class="c1">#   and will attempt to execute "npm ci --only=prod" when it detects a change</span>
<span class="c1">#   to package-lock.json.  Note that if your project does not have a</span>
<span class="c1">#   package-lock.json in its root directory then the plugin will fail to load.</span>
<span class="c1">#   Default is False.</span>
<span class="na">is_system_service</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   This should be set to False for repos that are not installed as a service</span>
<span class="c1">#   or do not need to restart a service after updates. This option sets the</span>
<span class="c1">#   default value for the "managed_services" option.  When set to False,</span>
<span class="c1">#   "managed_services" defaults to an empty list.  When set to True,</span>
<span class="c1">#   "managed_services" defaults to a list containing a single item, a service</span>
<span class="c1">#   matching the "extension_name" provided in the section header. The default</span>
<span class="c1">#   is True.</span>
<span class="c1">#   NOTE: In the future this option will be deprecated.  In preparation</span>
<span class="c1">#   for this, extensions that are installed as service, such as "KlipperScreen"</span>
<span class="c1">#   should ignore this option and set the "managed_services" option.</span>
<span class="na">managed_services</span><span class="o">:</span>
<span class="c1">#   A list of one or more systemd services that must be restarted after an</span>
<span class="c1">#   update is complete.  Multiple services must be separated by whitespace.</span>
<span class="c1">#   Currently this option is restricted to the following values:</span>
<span class="c1">#       &lt;name&gt;    - The name configured in the extension's section header.</span>
<span class="c1">#                   If the section header is [update_manager KlipperScreen]</span>
<span class="c1">#                   then KlipperScreen would be a valid value.</span>
<span class="c1">#       klipper   - The Klipper service associated with this instance of</span>
<span class="c1">#                   Moonraker will be restarted after an update.</span>
<span class="c1">#       moonraker - The Moonraker service will be restarted after an update.</span>
<span class="c1">#</span>
<span class="c1">#   NOTE: Moonraker will resolve the service names for the "klipper" and</span>
<span class="c1">#   "moonraker" services if they are not the default values.  Specific names</span>
<span class="c1">#   such as "klipper-1" or "moonraker_2" should not be entered in this option.</span>
<span class="c1">#</span>
<span class="c1">#   When this option is specified it overrides the "is_system_service" option.</span>
<span class="c1">#   Thus it is not required to specify both, only one or the other.  The</span>
<span class="c1">#   default is no managed services if "is_system_service" is set to False,</span>
<span class="c1">#   otherwise the default is the service named in the section header.</span>
<span class="na">refresh_interval</span><span class="o">:</span>
<span class="c1">#   This overrides the refresh_interval set in the primary [update_manager]</span>
<span class="c1">#   section.</span>
<span class="na">info_tags</span><span class="o">:</span>
<span class="c1">#   Optional information tags about this application that will be reported to</span>
<span class="c1">#   frontends as a list of strings. Each tag should be separated by a new line.</span>
<span class="c1">#   For example:</span>
<span class="c1">#       info_tags:</span>
<span class="c1">#           desc=Special Application</span>
<span class="c1">#   Frontends my use these tags to perform additional actions or display</span>
<span class="c1">#   information, see your extension documentation for details on configuration.</span>
<span class="c1">#   The default is an empty list (no info tags).</span>
<span class="na">pinned_commit</span><span class="o">:</span>
<span class="c1">#   A git commit hash to "pin" updates to.  When specified Moonraker will not</span>
<span class="c1">#   update the repo beyond the pinned commit.  If the repo is already beyond</span>
<span class="c1">#   the specified commit, or if the commit is not in the repo, further updates</span>
<span class="c1">#   are disabled until the pinned_commit is changed.  It is recommended to</span>
<span class="c1">#   specify the complete hash, however abbreviated hashes with a minimum of</span>
<span class="c1">#   8 characters are accepted.  The "pinned_commit" overrides the update</span>
<span class="c1">#   behavior set by the "channel" option.  The default is no pinned commit.</span>
<span class="na">report_anomalies</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   When set to True all detected anomalies are reported to front-ends.  When</span>
<span class="c1">#   set to False anomalies are logged but not reported. For a typical frontend</span>
<span class="c1">#   this can be used to silence messages when it anomalies are expected. The</span>
<span class="c1">#   default is True.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If this application requires a restart after an update it may be necessary
to grant Moonraker permission to manage its service. See the
<a href="https://moonraker.readthedocs.io/en/latest/configuration/#allowed-services">allowed services</a> section for details on which
services Moonraker is allowed to manage and how to add additional services.</p>
<p>Also not that systemd services are case sensitive.  The <code>extension_name</code>
in the section header and the value provided in the <code>managed_services</code>
option must match the case of the systemd unit file.</p>
</div>
<h4 id="zip-application-configuration">Zip Application Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#zip-application-configuration" title="Permanent link"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Software using the <code>zip</code> type should host their distribution
in a zip file as a GitHub release.  The zip file MUST contain
<a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-release_infojson-file">release_info.json</a>.</p>
</div>
<p>The <code>zip</code> type can be used to deploy zipped application updates through GitHub
releases.  They can be thought of as a combination of the <code>web</code> and <code>git_repo</code>
types.  Like <code>web</code> types, the are GitHub hosted zip archives.  Like <code>git_repo</code>
types, <code>zip</code> types can be configured to update dependencies and manage
services.</p>
<p>The <code>zip</code> type is ideal for applications that must bundle multiple files in
a release.  If bundling executable files, keep in mind that Moonraker runs
on multiple architectures.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_57"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_57 &gt; code"></button><code tabindex="0"><span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">zip</span>
<span class="na">channel</span><span class="o">:</span><span class="w"> </span><span class="s">stable</span>
<span class="c1">#   May be stable or beta.  When beta is specified "pre-release"</span>
<span class="c1">#   updates are available.  The default is stable.</span>
<span class="na">repo</span><span class="o">:</span>
<span class="c1">#   This is the GitHub repo of the application, in the format of owner/repo_name.</span>
<span class="c1">#   For example, this could be set to Donkie/Spoolman to update Spoolman.</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">path</span><span class="o">:</span>
<span class="c1">#   The path to the Application files on disk.  This folder must contain a</span>
<span class="c1">#   a previously installed application and a valid release_info.json file.</span>
<span class="c1">#   The folder must not be located within a git repo and it must not be located</span>
<span class="c1">#   within a path that Moonraker has reserved, ie: it cannot share a path with</span>
<span class="c1">#   another extension. This parameter must be provided.</span>
<span class="na">refresh_interval</span><span class="o">:</span>
<span class="c1">#   This overrides the refresh_interval set in the primary [update_manager]</span>
<span class="c1">#   section.</span>
<span class="na">persistent_files</span><span class="o">:</span>
<span class="c1">#   A list of newline separated file names that should persist between</span>
<span class="c1">#   updates.  This is useful for virtualenv's and other files/folders that</span>
<span class="c1">#   should not be deleted when Moonraker overwrites the folder.  The default</span>
<span class="c1">#   is no persistent files.</span>
<span class="na">virtualenv</span><span class="o">:</span>
<span class="na">requirements</span><span class="o">:</span>
<span class="na">system_dependencies</span><span class="o">:</span>
<span class="na">enable_node_updates</span><span class="o">:</span>
<span class="na">is_system_service</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="na">managed_services</span><span class="o">:</span>
<span class="na">info_tags</span><span class="o">:</span>
<span class="na">report_anomalies</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   See the git_repo type documentation for detailed descriptions of the above</span>
<span class="c1">#   options.</span>
</code></pre></div>
<h4 id="executable-configuration">Executable Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#executable-configuration" title="Permanent link"></a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Software using the <code>executable</code> type should host their binaries
on GitHub as a release.  The initial installer for the executable
MUST create <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-release_infojson-file">release_info.json</a> in
the folder containing the executable.</p>
</div>
<p>The <code>executable</code> type can be used to deploy pre-built executable binaries
through GitHub releases.  Executable types can be installed as system services
and may specify OS package dependencies.</p>
<p>Like <code>web</code> and <code>zip</code> types, <code>executable</code> types must include a <code>release_info.json</code>
file (see the <a href="https://moonraker.readthedocs.io/en/latest/configuration/#web-type-front-end-configuration">web type</a> not for details).
In addition, <code>executable</code> types can be configured to update dependencies and manage
services.</p>
<p>The <code>executable</code> type is ideal for applications that need to be built before deployment.
The thing to keep in mind is that any application updated through Moonraker needs
either be cross-platform, or it needs to deploy binaries for multiple platforms
and be able to choose the correct one based on the system.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_58"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_58 &gt; code"></button><code tabindex="0"><span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">executable</span>
<span class="na">channel</span><span class="o">:</span><span class="w"> </span><span class="s">stable</span>
<span class="c1">#   May be stable or beta.  When beta is specified "pre-release"</span>
<span class="c1">#   updates are available.  The default is stable.</span>
<span class="na">repo</span><span class="o">:</span>
<span class="c1">#   This is the GitHub repo of the application, in the format of owner/repo_name.</span>
<span class="na">path</span><span class="o">:</span>
<span class="c1">#   The path to folder containing the executable on disk.  This folder must contain a</span>
<span class="c1">#   a previously installed application and a valid release_info.json file.</span>
<span class="c1">#   The folder must not be located within a git repo and it must not be located</span>
<span class="c1">#   within a path that Moonraker has reserved, ie: it cannot share a path with</span>
<span class="c1">#   another extension. This parameter must be provided.</span>
<span class="na">refresh_interval</span><span class="o">:</span>
<span class="c1">#   This overrides the refresh_interval set in the primary [update_manager]</span>
<span class="c1">#   section.</span>
<span class="na">system_dependencies</span><span class="o">:</span>
<span class="na">is_system_service</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="na">managed_services</span><span class="o">:</span>
<span class="na">info_tags</span><span class="o">:</span>
<span class="c1">#   See the git_repo type documentation for detailed descriptions of the above</span>
<span class="c1">#   options.</span>
</code></pre></div>
<h4 id="python-application-configuration">Python Application Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#python-application-configuration" title="Permanent link"></a></h4>
<p>The <code>python</code> type can be used to update python applications installed via pip
in a virtual environment.  Moonraker can update applications installed from
a python index such as <a href="https://pypi.org/">PyPI</a>, or from a
<a href="https://pip.pypa.io/en/stable/topics/vcs-support/">github repo</a>.  The source
is automatically detected based on the metadata of the currently installed
package.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_59"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_59 &gt; code"></button><code tabindex="0"><span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">python</span>
<span class="na">channel</span><span class="o">:</span><span class="w"> </span><span class="s">stable</span>
<span class="c1">#   May be stable or beta.  When beta is specified "pre-release"</span>
<span class="c1">#   updates are available.  The default is stable.</span>
<span class="na">refresh_interval</span><span class="o">:</span>
<span class="c1">#   This overrides the refresh_interval set in the primary [update_manager]</span>
<span class="c1">#   section.</span>
<span class="na">virtualenv</span><span class="o">:</span>
<span class="c1">#   Path to the virtual environment containing the python application.</span>
<span class="na">project_name</span><span class="o">:</span>
<span class="c1">#   Name of the python project as listed in the python package index.  If</span>
<span class="c1">#   the packaged is sourced from GitHub, this will be the name of the project</span>
<span class="c1">#   specified in the build.  Optional "extras" may be added, see the tip</span>
<span class="c1">#   following this example for details.  The default is the name specified by the</span>
<span class="c1">#   configuration section.</span>
<span class="na">primary_branch</span><span class="o">:</span>
<span class="c1">#   For packages sourced from GitHub, this option may be used to specify the</span>
<span class="c1">#   branch to fetch updates from when the channel is set to "dev".  The default</span>
<span class="c1">#   is no primary branch.</span>
<span class="na">is_system_service</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="na">managed_services</span><span class="o">:</span>
<span class="na">info_tags</span><span class="o">:</span>
<span class="c1">#   See the git_repo type documentation for detailed descriptions of the above</span>
<span class="c1">#   options.</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Python packages with "extras" may be specified using the <code>project_name</code>
option.  For example, assume we want to update a project named "pyapp"
that has an "extra" defined named "requests":</p>
<div class="highlight"><pre id="__code_60"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_60 &gt; code"></button><code>[update_manager pyapp]
type: python
project_name: pyapp[requests]
virtualenv: ~/pyapp
</code></pre></div>
</div>
<h5 id="the-optional-python-release_info-file">The optional python release_info file<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#the-optional-python-release_info-file" title="Permanent link"></a></h5>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This file has a different specification than the
<a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-release_infojson-file">release_info.json</a>
file required by other types.</p>
</div>
<p>Python applications may include a <code>release_info</code> file in the package
folder that provides supplemental information for the application.  The
<code>release_info</code> file should contain a json object with the following fields:</p>
<ul>
<li><code>project_name</code>: The name of the project as listed in the python index.</li>
<li><code>package_name</code>: The name of the package as installed.  This is often the
  same of the <code>project_name</code>, but may differ.</li>
<li><code>urls</code>: An object containing a mapping of url types to urls.  These urls
  should match urls provided in the metadata.</li>
<li><code>package_version</code>:  The version of the built package.</li>
<li><code>git_version</code>:  The git version as returned by
  <code>git describe --tags --always --long --dirty</code></li>
<li><code>commit_sha</code>:  The hash of the git commit the build was based on.</li>
<li><code>build_time</code>:  The time of the build in ISO format.</li>
<li><code>system_dependencies</code>:  An object containing a mapping of OS packages
  the python application depends on.  The object should be of the same
  format described in the
  <a href="https://moonraker.readthedocs.io/en/latest/configuration/#the-system-dependencies-file-format">system dependencies file</a> used
  by the <code>git_repo</code> and <code>zip</code> types.</li>
</ul>
<p>For example, Moonraker's <code>release_info</code> looks similar to the following:</p>
<div class="highlight"><span class="filename">Python release_info example</span><pre id="__code_61"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_61 &gt; code"></button><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"project_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"moonraker"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"package_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"moonraker"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"urls"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"homepage"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/Arksine/moonraker"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"repository"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://github.com/Arksine/moonraker"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"documentation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://moonraker.readthedocs.io"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"changelog"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://moonraker.readthedocs.io/en/latest/changelog/"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"package_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.9.0"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"git_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v0.9.0-0-g2abdb11"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"commit_sha"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2abdb112a5f16e6d5286df3680cf7fdb77aed845"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"build_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-05-26T18:59:52+00:00"</span><span class="p">,</span>
<span class="w">    </span><span class="nt">"system_dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"debian"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="s2">"python3-virtualenv"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"python3-dev"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"libopenjp2-7"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"libsodium-dev"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"zlib1g-dev"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"libjpeg-dev"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"packagekit"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"wireless-tools"</span><span class="p">,</span>
<span class="w">            </span><span class="s2">"curl"</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Moonraker uses the <a href="https://backend.pdm-project.org/">PDM backend</a> to perform
its package builds.  An example of a pdm build script that generates a
<code>release_info</code> file may be found
<a href="https://github.com/Arksine/moonraker/blob/master/pdm_build.py">here</a>.</p>
<h4 id="the-system-dependencies-file-format">The System Dependencies File Format<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#the-system-dependencies-file-format" title="Permanent link"></a></h4>
<p>When a <code>zip</code> or <code>git_repo</code> application depends on OS packages it is possible
to specify them in a file that Moonraker can refer to.  During an update
Moonraker will use this file to install new dependencies if they are detected.</p>
<p>Below is an example of Moonraker's system dependencies file, located at
in the repository at
<a href="https://github.com/Arksine/moonraker/blob/master/scripts/system-dependencies.json">scripts/system-dependencies.json</a>:</p>
<div class="highlight"><pre id="__code_62"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_62 &gt; code"></button><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"debian"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">"python3-virtualenv"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"python3-dev"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"python3-libgpiod"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"liblmdb-dev"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"libopenjp2-7"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"libsodium-dev"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"zlib1g-dev"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"libjpeg-dev"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"packagekit"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"wireless-tools"</span><span class="p">,</span>
<span class="w">        </span><span class="s2">"curl"</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
<p>The general format is an object, where each key is the name of a linux
distribution, and the value is an array of strings each naming a dependency.
Moonraker uses Python's <a href="https://distro.readthedocs.io/en/latest/">distro</a>
package to match the detected operating system against keys in the system
dependencies file.  It will first attempt to match against the return value
of <code>distro.id()</code>, the fall back on the values reported by <code>distro.like()</code>.
Following this logic, the <code>debian</code> key will be applied to Debian, Raspberry
Pi OS, Ubuntu, and likely other Debian derived distributions.</p>
<h3 id="mqtt"><code>[mqtt]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt" title="Permanent link"></a></h3>
<p>Enables an MQTT Client.  When configured most of Moonraker's APIs are available
by publishing JSON-RPC requests to <code>{instance_name}/moonraker/api/request</code>.
Responses will be published to <code>{instance_name}/moonraker/api/response</code>. See
the <a href="https://moonraker.readthedocs.io/en/latest/external_api/introduction/#json-rpc-api-overview">API Documentation</a>
for details on on JSON-RPC.</p>
<p>It is also possible for other components within Moonraker to use MQTT to
publish and subscribe to topics.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_63"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_63 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[mqtt]</span>
<span class="na">address</span><span class="o">:</span>
<span class="c1">#   Address of the Broker.  This may be a hostname or IP Address.  This</span>
<span class="c1">#   parameter must be provided.</span>
<span class="na">port</span><span class="o">:</span>
<span class="c1">#   Port the Broker is listening on.  Default is 1883.</span>
<span class="na">client_id</span><span class="o">:</span>
<span class="c1">#   A string client identifier sent by the client to the broker after</span>
<span class="c1">#   connecting.  The default is a randomly assigned client id.</span>
<span class="na">enable_tls</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   Enables SSL/TLS connections when set to true.  Note that if a user intends</span>
<span class="c1">#   to connect to a local MQTT service using a self signed certificate then</span>
<span class="c1">#   it will be necessary to install the root CA certificate on the machine</span>
<span class="c1">#   hosting Moonraker.  Default is False.</span>
<span class="na">username</span><span class="o">:</span>
<span class="c1">#   An optional username used to log in to the Broker.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details. The default is</span>
<span class="c1">#   no username (an anonymous login will be attempted).</span>
<span class="na">password</span><span class="o">:</span>
<span class="c1">#   An optional password used to log in to the Broker.  This option accepts</span>
<span class="c1">#   Jinja2 Templates, see the [secrets] section for details.  The default is</span>
<span class="c1">#   no password.</span>
<span class="na">password_file</span><span class="o">:</span>
<span class="c1">#   *** DEPRECATED - Use the "password" option ***</span>
<span class="c1">#   An optional path to a text file containing a password used to log in</span>
<span class="c1">#   to the broker.  It is strongly recommended that this file be located</span>
<span class="c1">#   in a folder not served by Moonraker.  It is also recommended that the</span>
<span class="c1">#   password be unique and not used for other logins, as it is stored in</span>
<span class="c1">#   plain text.  To create a password file, one may ssh in to the device</span>
<span class="c1">#   and enter the following commands:</span>
<span class="c1">#      cd ~</span>
<span class="c1">#      echo mypassword &gt; .mqttpass</span>
<span class="c1">#   Then set this option to:</span>
<span class="c1">#     ~/.mqttpass</span>
<span class="c1">#   If this option is omitted no password will be used to login.</span>
<span class="na">mqtt_protocol</span><span class="o">:</span><span class="w"> </span><span class="s">v3.1.1</span>
<span class="c1">#   The protocol to use when connecting to the Broker.  May be v3.1,</span>
<span class="c1">#   v3.1.1, and v5.  The default is v3.1.1</span>
<span class="na">enable_moonraker_api</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
<span class="c1">#   If set to true the MQTT client will subscribe to API topic, ie:</span>
<span class="c1">#     {instance_name}/moonraker/api/request</span>
<span class="c1">#   This can be set to False if the user does not wish to allow API</span>
<span class="c1">#   requests over MQTT.  The default is True.</span>
<span class="na">instance_name</span><span class="o">:</span>
<span class="c1">#   An identifier used to create unique API topics for each instance of</span>
<span class="c1">#   Moonraker on network.  This name cannot contain wildcards (+ or #).</span>
<span class="c1">#   For example, if the instance name is set to my_printer, Moonraker</span>
<span class="c1">#   will subscribe to the following topic for API requests:</span>
<span class="c1">#     my_printer/moonraker/api/request</span>
<span class="c1">#   Responses will be published to the following topic:</span>
<span class="c1">#     my_printer/moonraker/api/response</span>
<span class="c1">#   The default is the machine's hostname.</span>
<span class="na">status_objects</span><span class="o">:</span>
<span class="c1">#   A newline separated list of Klipper objects whose state will be</span>
<span class="c1">#   published.  There are two different ways to publish the states - you</span>
<span class="c1">#   can use either or both depending on your need.  See the</span>
<span class="c1">#   "publish_split_status" options for details.</span>
<span class="c1">#</span>
<span class="c1">#   For example, this option could be set as follows:</span>
<span class="c1">#</span>
<span class="c1">#     status_objects:</span>
<span class="c1">#       webhooks</span>
<span class="c1">#       toolhead=position,print_time,homed_axes</span>
<span class="c1">#       extruder=temperature</span>
<span class="c1">#</span>
<span class="c1">#   In the example above, all fields of the "webhooks" object will be tracked</span>
<span class="c1">#   and changes will be published.  Only the "position", "print_time", and</span>
<span class="c1">#   "homed_axes" fields of the "toolhead" will be tracked.  Likewise, only the</span>
<span class="c1">#   "temperature" field of the extruder will be tracked. See the</span>
<span class="c1">#   "Printer Objects" section of the documentation for an overview of the most</span>
<span class="c1">#   common objects available.</span>
<span class="c1">#</span>
<span class="c1">#   Note that Klipper will only push an update to an object/field if the field</span>
<span class="c1">#   has changed.  An object with no fields that have changed will not be part</span>
<span class="c1">#   of the payload.  Object state is checked and published roughly every 250 ms.</span>
<span class="c1">#</span>
<span class="c1">#   If not configured then no objects will be tracked and published to</span>
<span class="c1">#   the klipper/status topic.</span>
<span class="na">status_interval</span><span class="o">:</span>
<span class="c1">#   The interval (in seconds) between published status updates.  This value</span>
<span class="c1">#   can be used to limit the rate of updates published.  By default Moonraker</span>
<span class="c1">#   will publish Klipper status updates as it receives them.</span>
<span class="na">publish_split_status</span><span class="o">:</span><span class="w"> </span><span class="s">False</span>
<span class="c1">#   Configures how to publish status updates to MQTT.</span>
<span class="c1">#</span>
<span class="c1">#   When set to False (default), all Klipper object state updates will be</span>
<span class="c1">#   published to a single mqtt state with the following topic:</span>
<span class="c1">#     {instance_name}/klipper/status</span>
<span class="c1">#</span>
<span class="c1">#   When set to True, all Klipper object state updates will be published to</span>
<span class="c1">#   separate mqtt topics derived from the object and item in the following</span>
<span class="c1">#   format:</span>
<span class="c1">#     {instance_name}/klipper/state/{objectname}/{statename}</span>
<span class="c1">#</span>
<span class="c1">#   The actual value of the state is published as "value" to the topic above.</span>
<span class="c1">#   For example, if the heater_bed temperature was 24.0, this is the payload:</span>
<span class="c1">#     {"eventtime": {timestamp}, "value": 24.0}</span>
<span class="c1">#   It would be published to this topic:</span>
<span class="c1">#     {instance_name}/klipper/state/heater_bed/temperature</span>
<span class="na">default_qos</span><span class="o">:</span><span class="w"> </span><span class="s">0</span>
<span class="c1">#   The default QOS level used when publishing or subscribing to topics.</span>
<span class="c1">#   Must be an integer value from 0 to 2.  The default is 0.</span>
<span class="na">api_qos</span><span class="o">:</span>
<span class="c1">#   The QOS level to use for the API topics. If not provided, the</span>
<span class="c1">#   value specified by "default_qos" will be used.</span>
</code></pre></div>
<h4 id="publishing-topics-from-klipper">Publishing topics from Klipper<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#publishing-topics-from-klipper" title="Permanent link"></a></h4>
<p>It is possible to publish a topic from a Klipper gcode macro with the
<code>publish_mqtt_topic</code> remote method.  For example:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_64"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_64 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro PUBLISH_ALERT]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.PAYLOAD|default(None) %}</span>
<span class="w">  </span><span class="na">{action_call_remote_method("publish_mqtt_topic",</span>
<span class="w">                             </span><span class="na">topic</span><span class="o">=</span><span class="s">"klipper/alert"</span><span class="na">,</span>
<span class="w">                             </span><span class="na">payload</span><span class="o">=</span><span class="s">data,</span>
<span class="w">                             </span><span class="na">qos</span><span class="o">=</span><span class="s">0,</span>
<span class="w">                             </span><span class="na">retain</span><span class="o">=</span><span class="s">False,</span>
<span class="w">                             </span><span class="na">use_prefix</span><span class="o">=</span><span class="s">True)}</span>
</code></pre></div>
<p>The <code>topic</code> is required, all other parameters are optional.  Below is a brief
explanation of each parameter:</p>
<ul>
<li><code>topic</code>: a valid mqtt topic</li>
<li><code>payload</code>: Defaults to an empty payload.  This can be set to string, integer,
  float, boolean, any json object (dict or list) or None. The default
  value is None, in which no payload will be sent with the topic</li>
<li><code>qos</code>: an integer value in the range from 0 to 2.  The default is the qos
  set in the configuration.</li>
<li><code>retain</code>: When set to True the retain flag will be set with the published topic.
  Defaults to False.</li>
<li><code>use_prefix</code>: When set to True the configured <code>instance_name</code> will be prefixed
  to the topic.  For example, if the instance_name is <code>my_printer</code> and the topic
  is <code>klipper/alert</code> the published topic will be <code>my_printer/klipper/alert</code>.  The
  default is False.</li>
</ul>
<h3 id="wled"><code>[wled]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#wled" title="Permanent link"></a></h3>
<p>Enables control of a <a href="https://kno.wled.ge/">WLED</a> strip. Moonraker always
supports 4 color channel strips - the color order is defined within WLED
itself.</p>
<p></p><div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_65"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_65 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[wled strip_name]</span>
<span class="na">type</span><span class="o">:</span>
<span class="c1">#   The type of device. Can be either http, or serial.</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">address</span><span class="o">:</span>
<span class="c1">#   The address should be a valid ip or hostname for the wled webserver.</span>
<span class="c1">#   Required when type: http</span>
<span class="na">serial</span><span class="o">:</span>
<span class="c1">#   The serial port to be used to communicate directly to wled. Requires wled</span>
<span class="c1">#   0.13 Build 2108250 or later.</span>
<span class="c1">#   Required when type: serial</span>
<span class="na">initial_preset</span><span class="o">:</span>
<span class="c1">#   Initial preset ID (favorite) to use. If not specified initial_colors</span>
<span class="c1">#   will be used instead.</span>
<span class="na">initial_red</span><span class="o">:</span>
<span class="na">initial_green</span><span class="o">:</span>
<span class="na">initial_blue</span><span class="o">:</span>
<span class="na">initial_white</span><span class="o">:</span>
<span class="c1">#   Initial colors to use for all neopixels should initial_preset not be set,</span>
<span class="c1">#   initial_white will only be used for RGBW wled strips (defaults: 0.5)</span>
<span class="na">chain_count</span><span class="o">:</span>
<span class="c1">#   Number of addressable neopixels for use (default: 1)</span>
<span class="na">color_order</span><span class="o">:</span>
<span class="c1">#   *** DEPRECATED - Color order is defined per GPIO in WLED directly ***</span>
<span class="c1">#   Color order for WLED strip, RGB or RGBW (default: RGB)</span>
</code></pre></div>
Below are some examples:
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_66"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_66 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[wled case]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">http</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">led1.lan</span>
<span class="na">initial_preset</span><span class="o">:</span><span class="w"> </span><span class="s">45</span>
<span class="na">chain_count</span><span class="o">:</span><span class="w"> </span><span class="s">76</span>

<span class="k">[wled lounge]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">http</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">192.168.0.45</span>
<span class="na">initial_red</span><span class="o">:</span><span class="w"> </span><span class="s">0.5</span>
<span class="na">initial_green</span><span class="o">:</span><span class="w"> </span><span class="s">0.4</span>
<span class="na">initial_blue</span><span class="o">:</span><span class="w"> </span><span class="s">0.3</span>
<span class="na">chain_count</span><span class="o">:</span><span class="w"> </span><span class="s">42</span>

<span class="k">[wled stealthburner]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">serial</span>
<span class="na">serial</span><span class="o">:</span><span class="w"> </span><span class="s">/dev/serial/by-id/usb-1a86_USB_Serial-if00-port0</span>
<span class="na">initial_white</span><span class="o">:</span><span class="w"> </span><span class="s">0.6</span>
<span class="na">chain_count</span><span class="o">:</span><span class="w"> </span><span class="s">3</span>
</code></pre></div><p></p>
<p>It is possible to control wled from the klippy host, this can be done using
one or more macros, such as:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_67"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_67 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro WLED_ON]</span>
<span class="na">description</span><span class="o">:</span><span class="w"> </span><span class="s">Turn WLED strip on using optional preset and resets led colors</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.STRIP|string %}</span>
<span class="w">  </span><span class="na">{% set preset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.PRESET|default(-1)|int %}</span>

<span class="w">  </span><span class="na">{action_call_remote_method("set_wled_state",</span>
<span class="w">                             </span><span class="na">strip</span><span class="o">=</span><span class="s">strip,</span>
<span class="w">                             </span><span class="na">state</span><span class="o">=</span><span class="s">True,</span>
<span class="w">                             </span><span class="na">preset</span><span class="o">=</span><span class="s">preset)}</span>

<span class="k">[gcode_macro WLED_CONTROL]</span>
<span class="na">description</span><span class="o">:</span><span class="w"> </span><span class="s">Control effect values and brightness</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.STRIP|default('lights')|string %}</span>
<span class="w">  </span><span class="na">{% set brightness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.BRIGHTNESS|default(-1)|int %}</span>
<span class="w">  </span><span class="na">{% set intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.INTENSITY|default(-1)|int %}</span>
<span class="w">  </span><span class="na">{% set speed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.SPEED|default(-1)|int %}</span>

<span class="w">  </span><span class="na">{action_call_remote_method("set_wled_state",</span>
<span class="w">                             </span><span class="na">strip</span><span class="o">=</span><span class="s">strip,</span>
<span class="w">                             </span><span class="na">brightness</span><span class="o">=</span><span class="s">brightness,</span>
<span class="w">                             </span><span class="na">intensity</span><span class="o">=</span><span class="s">intensity,</span>
<span class="w">                             </span><span class="na">speed</span><span class="o">=</span><span class="s">speed)}</span>

<span class="k">[gcode_macro WLED_OFF]</span>
<span class="na">description</span><span class="o">:</span><span class="w"> </span><span class="s">Turn WLED strip off</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.STRIP|string %}</span>

<span class="w">  </span><span class="na">{action_call_remote_method("set_wled_state",</span>
<span class="w">                             </span><span class="na">strip</span><span class="o">=</span><span class="s">strip,</span>
<span class="w">                             </span><span class="na">state</span><span class="o">=</span><span class="s">False)}</span>

<span class="k">[gcode_macro SET_WLED]</span>
<span class="na">description</span><span class="o">:</span><span class="w"> </span><span class="s">SET_LED like functionality for WLED, applies to all active segments</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">    </span><span class="na">{% set strip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.STRIP|string %}</span>
<span class="w">    </span><span class="na">{% set red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.RED|default(0)|float %}</span>
<span class="w">    </span><span class="na">{% set green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.GREEN|default(0)|float %}</span>
<span class="w">    </span><span class="na">{% set blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.BLUE|default(0)|float %}</span>
<span class="w">    </span><span class="na">{% set white</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.WHITE|default(0)|float %}</span>
<span class="w">    </span><span class="na">{% set index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.INDEX|default(-1)|int %}</span>
<span class="w">    </span><span class="na">{% set transmit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.TRANSMIT|default(1)|int %}</span>

<span class="w">    </span><span class="na">{action_call_remote_method("set_wled",</span>
<span class="w">                               </span><span class="na">strip</span><span class="o">=</span><span class="s">strip,</span>
<span class="w">                               </span><span class="na">red</span><span class="o">=</span><span class="s">red, green=green, blue=blue, white=white,</span>
<span class="w">                               </span><span class="na">index</span><span class="o">=</span><span class="s">index, transmit=transmit)}</span>
</code></pre></div>
<h3 id="zeroconf"><code>[zeroconf]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#zeroconf" title="Permanent link"></a></h3>
<p>Enables support for Zeroconf (Apple Bonjour) discovery, allowing external services
detect and use Moonraker instances.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_68"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_68 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[zeroconf]</span>
<span class="na">mdns_hostname</span><span class="o">:</span>
<span class="c1">#   The hostname used when registering the multicast DNS service.</span>
<span class="c1">#   The instance will be available at:</span>
<span class="c1">#       http://{mdns_hostname}.local:{port}/</span>
<span class="c1">#   The default is the operating system's configured hostname.</span>
<span class="na">enable_ssdp</span><span class="o">:</span>
<span class="c1">#   Enables discovery over UPnP/SSDP in ad.  The default is False</span>
</code></pre></div>
<h3 id="button"><code>[button]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#button" title="Permanent link"></a></h3>
<p>Enables support for handling <code>button</code> events.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_69"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_69 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="k">[button my_button]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">gpio</span>
<span class="c1">#   Reserved for future use.  Currently the only button type available is</span>
<span class="c1">#   'gpio', which is the default.</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpiochip0/gpio26</span>
<span class="c1">#   The gpio pin to watch for button events.  The chip is optional, if</span>
<span class="c1">#   omitted then the module will default to gpiochip0.  The pin may be</span>
<span class="c1">#   inverted by specifying a "!" may be prefix.  Valid examples:</span>
<span class="c1">#      gpiochip0/gpio26</span>
<span class="c1">#      gpio26</span>
<span class="c1">#      !gpiochip0/gpio26</span>
<span class="c1">#      !gpio26</span>
<span class="c1">#   Systems with libgpiod 1.5 or greater installed also support pullup and</span>
<span class="c1">#   pulldown modes.  Prefix a "^" to enable the internal pullup and a "~" to</span>
<span class="c1">#   enable the internal pulldown:</span>
<span class="c1">#      ^gpiochip0/gpio26</span>
<span class="c1">#      ^gpio26</span>
<span class="c1">#      ~gpiochip0/gpio26</span>
<span class="c1">#      ~gpio26</span>
<span class="c1">#      # Its also possible to invert a pin with the pullup/pulldown enabled</span>
<span class="c1">#      ^!gpiochip0/gpio26</span>
<span class="c1">#      ~!gpiochip0/gpio26</span>
<span class="c1">#   This parameter must be provided</span>
<span class="na">debounce_period</span><span class="o">:</span><span class="w"> </span><span class="s">.05</span>
<span class="c1">#   The time (in seconds) an event is delayed to debounce the response.</span>
<span class="c1">#   The minimum debounce period is .01 seconds.  The default is .05 seconds.</span>
<span class="na">minimum_event_time</span><span class="o">:</span><span class="w"> </span><span class="s">0</span>
<span class="c1">#   The minimum event duration (in seconds) required to trigger a response.</span>
<span class="c1">#   This can be used as a secondary debounce procedure. The default is 0</span>
<span class="c1">#   seconds (no minimum duration).</span>
<span class="na">on_press</span><span class="o">:</span>
<span class="na">on_release</span><span class="o">:</span>
<span class="c1">#   Jinja2 templates to be executed when a button event is detected.  At least one</span>
<span class="c1">#   must be provided.</span>
</code></pre></div>
<h4 id="button-templates">Button Templates<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#button-templates" title="Permanent link"></a></h4>
<p>Both the <code>on_press</code> and <code>on_release</code> templates are provided a context with the
with two methods that may be called in addition to Jinja2's default filters
adn methods:</p>
<ul>
<li><code>call_method</code>:  Calls an internal API method.  See the
  <a href="https://moonraker.readthedocs.io/en/latest/external_api/introduction/#jinja2-template-api-calls">API documentation</a>
  for  details.</li>
<li><code>send_notification</code>:  Emits a websocket notification.  This is useful if you
   wish to use buttons to notify attached clients of some action.  This
   method takes an optional argument that may contain any JSON object.
   If provided, this value will be sent as part of the payload with
   the notification.</li>
</ul>
<p>Additionally, the following context variables are available:</p>
<ul>
<li><code>event</code>:  This is a dictionary with details about the event:<ul>
<li><code>elapsed_time</code>:  The time elapsed (in seconds) since the last detected
  button event</li>
<li><code>received_time</code>: The time the event was detected according to asyncio's
  monotonic clock.  Note that this is not in "unix time".</li>
<li><code>render_time</code>: The time the template was rendered (began execution)
  according to asyncio's monotonic clock.  It is possible execution of
  an event may be delayed well beyond the <code>received_time</code>.</li>
<li><code>pressed</code>: A boolean value to indicate if the button is currently pressed.</li>
</ul>
</li>
<li><code>user_data</code>:  This is a dictionary in which templates can store information
  that will persist across events.  This may be useful to track the number of
  events, specific timing of events, return values from previous API calls,
  etc.  Note that the data in this field does not persist across Moonraker
  restarts.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is recommended to avoid API calls that may block (ie: the <code>update</code> APIs).
Only one event may be rendered at a time, subsequent events received will be
delayed. Calling a blocking API would effectively make the button
non-responsive until the API call returns.</p>
</div>
<p>Button Template Examples:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_70"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_70 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="c1"># Emergency Stop Example</span>
<span class="k">[button estop]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">gpio</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpio26</span>
<span class="na">on_press</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Executes immediately after a press is detected</span>
<span class="w">  </span><span class="na">{% do call_method("printer.emergency_stop") %}</span>

<span class="c1"># Reboot Long Press Example</span>
<span class="k">[button reboot]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">gpio</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpio26</span>
<span class="na">on_release</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Only call reboot if the button was held for more than 1 second.</span>
<span class="w">  </span><span class="c1"># Note that this won't execute until the button has been released.</span>
<span class="w">  </span><span class="na">{% if event.elapsed_time &gt; 1.0 %}</span>
<span class="w">    </span><span class="na">{% do call_method("machine.reboot") %}</span>
<span class="w">  </span><span class="na">{% endif %}</span>

<span class="c1"># Double Click Notification Example</span>
<span class="k">[button notify_btn]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">gpio</span>
<span class="na">pin</span><span class="o">:</span><span class="w"> </span><span class="s">gpio26</span>
<span class="na">on_press</span><span class="o">:</span>
<span class="w">  </span><span class="c1"># Use the "user_data" context variable to track a single click</span>
<span class="w">  </span><span class="na">{% set clicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">user_data.clicked|default(false) %}</span>
<span class="w">  </span><span class="c1"># It isn't possible to assign a value to a context variable in Jinja2,</span>
<span class="w">  </span><span class="c1"># however since user_data is a dict we can call its methods.  The</span>
<span class="w">  </span><span class="c1"># call to __setitem__ below is equivalent to:</span>
<span class="w">  </span><span class="c1">#   user_data["clicked"] = true</span>
<span class="w">  </span><span class="na">{% do user_data.__setitem__("clicked", true) %}</span>
<span class="w">  </span><span class="na">{% if event.elapsed_time &lt; 0.5 and clicked %}</span>
<span class="w">    </span><span class="c1"># We will consider this a double click if the second click occurs</span>
<span class="w">    </span><span class="c1"># within .5 seconds of releasing the first</span>
<span class="w">    </span><span class="na">{% do user_data.__setitem__("clicked", false) %}</span>
<span class="w">    </span><span class="na">{% do user_data.__setitem__("double_clicked", true) %}</span>
<span class="w">  </span><span class="na">{% endif %}</span>
<span class="na">on_release</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set double_clicked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">user_data.double_clicked|default(false) %}</span>
<span class="w">  </span><span class="na">{% if double_clicked %}</span>
<span class="w">    </span><span class="na">{% do user_data.__setitem__("double_clicked", false) %}</span>
<span class="w">    </span><span class="na">{% do send_notification("Double Clicked!") %}</span>
<span class="w">  </span><span class="na">{% endif %}</span>
</code></pre></div>
<h3 id="secrets"><code>[secrets]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#secrets" title="Permanent link"></a></h3>
<p>Retrieves credentials and other information from a "secrets" file
separate from <code>moonraker.conf</code>.  This allows users to safely distribute
their configuration and log files without revealing credentials and
other sensitive information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section no longer has configuration options.  Previously the
<code>secrets_path</code> option was used to specify the location of the file.
The secrets file name and location is now determined by the <code>data path</code>
and <code>alias</code> command line options, ie: <code>&lt;data_base_path&gt;/moonraker.secrets</code>.
For a typical single instance installation this resolves to
<code>$HOME/printer_data/moonraker.secrets</code>. This may be a symbolic link.</p>
</div>
<div class="highlight"><span class="filename">Example moonraker.secrets ini file</span><pre id="__code_71"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_71 &gt; code"></button><code><span class="c1"># /home/pi/printer_data/moonraker.secrets</span>

<span class="k">[mqtt_credentials]</span>
<span class="na">username</span><span class="o">:</span><span class="w"> </span><span class="s">mqtt_user</span>
<span class="na">password</span><span class="o">:</span><span class="w"> </span><span class="s">my_mqtt_password</span>

<span class="k">[home_assistant]</span>
<span class="na">token</span><span class="o">:</span><span class="w"> </span><span class="s">long_token_string</span>
</code></pre></div>
<div class="highlight"><span class="filename">Example moonraker.secrets json file</span><pre id="__code_72"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_72 &gt; code"></button><code><span class="p">{</span>
<span class="w">    </span><span class="nt">"mqtt_credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mqtt_user"</span><span class="p">,</span>
<span class="w">        </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my_mqtt_password"</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">"home_assistant"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">"token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long_token_string"</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Generally speaking <code>ini</code> files are easier to manually edit.  However,
options are limited to string values without parsing and converting.
The strength of <code>json</code> is that a field may be an integer, string,
float, boolean, array, or object.</p>
</div>
<h4 id="accessing-secret-credentials">Accessing secret credentials<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#accessing-secret-credentials" title="Permanent link"></a></h4>
<p>The <code>secrets</code> object is added to Moonraker's Jinja2 environment as a
global, thus it is available in all templates. All options in
Moonraker's configuration that accept credentials support templates.</p>
<p>MQTT configuration example with secret credentials:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_73"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_73 &gt; code"></button><code><span class="k">[mqtt]</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">mqtt-broker.local</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">1883</span>
<span class="c1"># The username and password options below may be templates that</span>
<span class="c1"># we can use to resolve stored secrets</span>
<span class="na">username</span><span class="o">:</span><span class="w"> </span><span class="s">{secrets.mqtt_credentials.username}</span>
<span class="na">password</span><span class="o">:</span><span class="w"> </span><span class="s">{secrets.mqtt_credentials.password}</span>
<span class="na">enable_moonraker_api</span><span class="o">:</span><span class="w"> </span><span class="s">True</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The purpose of the <code>[secrets]</code> module is to keep credentials and
other sensitive information out of configuration files and Moonraker's
log.  These items are stored in plain text, it is wise to use
unique credentials. Never leave a Moonraker client application open
unattended in an untrusted location, as it would be possible for a
malicious actor to reconfigure moonraker to send items stored in the
secrets file to themselves via <code>mqtt</code>, <code>notifier</code>, etc.</p>
</div>
<p>Home Assistant Switch Example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_74"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_74 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power homeassistant_switch]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">homeassistant</span>
<span class="na">address</span><span class="o">:</span><span class="w"> </span><span class="s">home-assistant-host.local</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">8123</span>
<span class="na">device</span><span class="o">:</span><span class="w"> </span><span class="s">switch.1234567890abcdefghij</span>
<span class="c1"># The token option may be a template</span>
<span class="na">token</span><span class="o">:</span><span class="w"> </span><span class="s">{secrets.home_assistant.token}</span>
<span class="na">domain</span><span class="o">:</span><span class="w"> </span><span class="s">switch</span>
</code></pre></div>
<h3 id="notifier"><code>[notifier]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#notifier" title="Permanent link"></a></h3>
<p>Enables the notification service. Multiple "notifiers" may be configured,
each with their own section, ie: <code>[notifier my_discord_server]</code>,
<code>[notifier my_phone]</code>.</p>
<p>All notifiers require an url for a service to be set up. Moonraker depends on
<a href="https://github.com/caronc/apprise">Apprise</a> to emit notifications.
Available services and their corresponding at urls may be found on the
<a href="https://github.com/caronc/apprise/wiki">Apprise Wiki</a>.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_75"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_75 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="k">[notifier telegram]</span>
<span class="na">url</span><span class="o">:</span><span class="w"> </span><span class="s">tgram://{bottoken}/{ChatID}</span>
<span class="c1">#   The url for your notifier. This URL accepts Jinja2 templates,</span>
<span class="c1">#   so you can use [secrets] if you want.  This parameter must be</span>
<span class="c1">#   provided.</span>
<span class="na">events</span><span class="o">:</span><span class="w"> </span><span class="s">*</span>
<span class="c1">#   The events this notifier should trigger to. '*' means all events.</span>
<span class="c1">#   You can use multiple events, comma separated.</span>
<span class="c1">#   Valid events:</span>
<span class="c1">#      started</span>
<span class="c1">#      complete</span>
<span class="c1">#      error</span>
<span class="c1">#      cancelled</span>
<span class="c1">#      paused</span>
<span class="c1">#      resumed</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">body</span><span class="o">:</span><span class="w"> </span><span class="s">"Your printer status has changed to {event_name}"</span>
<span class="c1">#   The body of the notification. This option accepts Jinja2 templates, where</span>
<span class="c1">#   the template is passed a context containing the following fields:</span>
<span class="c1">#      event_name: The name of the event that triggered the notification</span>
<span class="c1">#                  (ie: started, complete, error, etc)</span>
<span class="c1">#      event_args: A list containing the arguments passed to the event.</span>
<span class="c1">#                  See the "Tip" below for additional details on this field.</span>
<span class="c1">#      event_message: An additional message passed to the notification when</span>
<span class="c1">#                     triggered.  This is commonly used when the notification</span>
<span class="c1">#                     is received from Klippy using a gcode_macro.</span>
<span class="c1">#   The default is a body containing the "name" of the notification as entered</span>
<span class="c1">#   in the section header.</span>
<span class="na">body_format</span><span class="o">:</span>
<span class="c1">#   The formatting to use for the body, can be `text`, `html` and `markdown`.</span>
<span class="c1">#   The default is `text`.</span>
<span class="na">title</span><span class="o">:</span>
<span class="c1">#   The optional title of the notification. This option accepts Jinja2 templates,</span>
<span class="c1">#   the template will receive a context with the same fields as the body.  The</span>
<span class="c1">#   default is an empty string as the title.</span>
<span class="na">attach</span><span class="o">:</span>
<span class="c1">#   One or more items to attach to the notification. This may be a path to a</span>
<span class="c1">#   local file or a url (such as a webcam snapshot).  Multiple attachments must be</span>
<span class="c1">#   separated by a newline.  This option accepts Jinja2 templates, the template</span>
<span class="c1">#   will receive the same context as the "body" and "title" options.  The default</span>
<span class="c1">#   is no attachment will be sent with the notification.</span>
<span class="c1">#</span>
<span class="c1">#   Note: Attachments are not available for all notification services, you can</span>
<span class="c1">#   check if it's supported on the Apprise Wiki.  Be aware that links to items</span>
<span class="c1">#   hosted on your local network can only be viewed within that network.</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code>event_args</code> field of the Jinja2 context passed to templates in
this section receives a list of "arguments" passed to the event.  For
those familiar with Python this list is known as "variable arguments".
Currently the notifier only supports two kinds of events: those
triggered by a change in the job state and those triggered from a remote
method call frm a <code>gcode_macro</code>.</p>
<p>For <code>remote method</code> events the <code>event_args</code> field will always be
an empty list.  For <code>job state</code> events the <code>event_args</code> field will
contain two items. The first item (<code>event_args[0]</code>) contains the
job state recorded prior to the event, the second item (<code>event_args[1]</code>)
contains the current job state.  In most cases users will be interested
in the current job state (<code>event_args[1]</code>).</p>
<p>The <code>job state</code> is a dict that contains the values reported by
Klipper's <a href="https://moonraker.readthedocs.io/en/latest/printer_objects/#print_stats">print_stats</a> object.</p>
</div>
<h4 id="an-example">An example:<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#an-example" title="Permanent link"></a></h4>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_76"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_76 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[notifier print_start]</span>
<span class="na">url</span><span class="o">:</span><span class="w"> </span><span class="s">tgram://{bottoken}/{ChatID}</span>
<span class="na">events</span><span class="o">:</span><span class="w"> </span><span class="s">started</span>
<span class="na">body</span><span class="o">:</span><span class="w"> </span><span class="s">Your printer started printing '{event_args[1].filename}'</span>

<span class="k">[notifier print_complete]</span>
<span class="na">url</span><span class="o">:</span><span class="w"> </span><span class="s">tgram://{bottoken}/{ChatID}</span>
<span class="na">events</span><span class="o">:</span><span class="w"> </span><span class="s">complete</span>
<span class="na">body</span><span class="o">:</span><span class="w"> </span><span class="s">Your printer completed printing '{event_args[1].filename}'</span>
<span class="na">attach</span><span class="o">:</span><span class="w"> </span><span class="s">http://192.168.1.100/webcam/?action=snapshot</span>

<span class="k">[notifier print_error]</span>
<span class="na">url</span><span class="o">:</span><span class="w"> </span><span class="s">tgram://{bottoken}/{ChatID}</span>
<span class="na">events</span><span class="o">:</span><span class="w"> </span><span class="s">error</span>
<span class="na">body</span><span class="o">:</span><span class="w"> </span><span class="s">{event_args[1].message}</span>
<span class="na">attach</span><span class="o">:</span><span class="w"> </span><span class="s">http://192.168.1.100/webcam/?action=snapshot</span>

<span class="k">[notifier my_telegram_notifier]</span>
<span class="na">url</span><span class="o">:</span><span class="w"> </span><span class="s">tgram://{bottoken}/{ChatID}</span>
<span class="na">events</span><span class="o">:</span><span class="w"> </span><span class="s">gcode</span>
<span class="na">body</span><span class="o">:</span><span class="w"> </span><span class="s">{event_message}</span>
<span class="na">attach</span><span class="o">:</span><span class="w"> </span><span class="s">http://192.168.1.100/webcam/?action=snapshot</span>
</code></pre></div>
<h4 id="notifying-from-klipper">Notifying from Klipper<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#notifying-from-klipper" title="Permanent link"></a></h4>
<p>It is possible to invoke your notifiers from the Klippy host, this can be done
with a gcode_macro, such as:
</p><div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_77"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_77 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro NOTIFY_FILAMENT_CHANGE]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method("notify",</span>
<span class="w">                             </span><span class="na">name</span><span class="o">=</span><span class="s">"my_telegram_notifier"</span><span class="na">,</span>
<span class="w">                             </span><span class="na">message</span><span class="o">=</span><span class="s">"Filament change needed!"</span><span class="na">)}</span>
</code></pre></div><p></p>
<h3 id="simplyprint"><code>[simplyprint]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#simplyprint" title="Permanent link"></a></h3>
<p>Enables support for print monitoring through
<a href="https://simplyprint.io">SimplyPrint</a>,
publicly launched Moonraker integration Nov 21<sup>st</sup> 2022.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_78"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_78 &gt; code"></button><code><span class="c1"># moonraker.conf</span>
<span class="k">[simplyprint]</span>
<span class="na">webcam_name</span><span class="o">:</span>
<span class="c1">#   Optional name of a configured webcam for use by the SimplyPrint service.</span>
<span class="c1">#   This can either be a webcam configured through the `[webcam]` module or</span>
<span class="c1">#   a webcam added via a front-end like Mainsail.  The default is to attempt</span>
<span class="c1">#   to autodetect a webcam.</span>
<span class="na">power_device</span><span class="o">:</span>
<span class="c1">#   The name of a configured [power] device available to toggle over using</span>
<span class="c1">#   the SimplyPrint service.  For example, to toggle a device specified</span>
<span class="c1">#   as [power printer] may be configured as:</span>
<span class="c1">#       power_device: printer</span>
<span class="c1">#   By default no power device is configured.</span>
<span class="na">filament_sensor</span><span class="o">:</span>
<span class="c1">#   The name of a configured filament sensor to be monitored by SimplyPrint.</span>
<span class="c1">#   The filament sensor must be configured in Klipper and the full name,</span>
<span class="c1">#   including the prefix, must be specified.  For example, to monitor a sensor</span>
<span class="c1">#   specified as [filament_switch_sensor fsensor] may be configured as:</span>
<span class="c1">#       filament_sensor:  filament_switch_sensor fsensor</span>
<span class="c1">#   By default no filament sensor is monitored.</span>
<span class="na">ambient_sensor</span><span class="o">:</span>
<span class="c1">#   The name of a configured temperature sensor used to report the ambient</span>
<span class="c1">#   temperature.  The sensor must be configured in Klipper and the full name,</span>
<span class="c1">#   including the prefix, must be specified.  For example, an ambient sensor</span>
<span class="c1">#   specified in Klipper as [temperature_sensor chamber] may be configured as:</span>
<span class="c1">#       ambient_sensor: temperature_sensor chamber</span>
<span class="c1">#   If no ambient_sensor is configured then SimplyPrint will use the extruder</span>
<span class="c1">#   to estimate ambient temperature when the heater is idle and cool.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This module collects and uploads the following data to SimplyPrint:</p>
<ul>
<li>Klipper's version, connection state, and date pulled</li>
<li>Moonraker's version</li>
<li>Currently connected front-end and version</li>
<li>Current python version</li>
<li>Linux distribution and version</li>
<li>Network connection type (wifi or ethernet)</li>
<li>wifi SSID (if connected)</li>
<li>LAN IP address</li>
<li>LAN hostname</li>
<li>CPU model</li>
<li>CPU core count</li>
<li>Total system memory</li>
<li>CPU usage</li>
<li>Memory usage</li>
<li>Current extruder selected</li>
<li>Extruder and bed temperatures</li>
<li>Mesh data (if Klipper has <code>bed_mesh</code> configured)</li>
<li>Current print state</li>
<li>Loaded file metadata, including estimated filament usage and print time</li>
<li>Current print filament usage</li>
<li>Current print time elapse</li>
<li>Estimated ambient temperature</li>
<li>Webcam configuration (if available)</li>
<li>Webcam images.</li>
<li>Power device state (if configured)</li>
<li>Filament sensor state (if configured)</li>
</ul>
</div>
<p>More on how your data is used in the SimplyPrint privacy policy here;
<a href="https://simplyprint.io/legal/privacy">https://simplyprint.io/legal/privacy</a></p>
<h3 id="sensor"><code>[sensor]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#sensor" title="Permanent link"></a></h3>
<p>Enables data collection from additional sensor sources.  Multiple "sensor"
sources may be configured, each with their own section, ie: <code>[sensor current]</code>,
<code>[sensor voltage]</code>.</p>
<h4 id="options-common-to-all-sensor-devices">Options common to all sensor devices<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#options-common-to-all-sensor-devices" title="Permanent link"></a></h4>
<p>The following configuration options are available for all sensor types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_79"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_79 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[sensor my_sensor]</span>
<span class="na">type</span><span class="o">:</span>
<span class="c1">#   The type of device.  Supported types: mqtt</span>
<span class="c1">#   This parameter must be provided.</span>
<span class="na">name</span><span class="o">:</span>
<span class="c1">#   The friendly display name of the sensor.</span>
<span class="c1">#   The default is the sensor source name.</span>
<span class="na">parameter_{parameter_name}</span><span class="o">:</span>
<span class="c1">#   Optional parameter descriptions.  Each sensor can report</span>
<span class="c1">#   one or parameters. Frontends can use this data to accurately</span>
<span class="c1">#   present sensor details to the user.  The {parameter_name} must</span>
<span class="c1">#   be a valid measurement reported by the sensor. The value should be</span>
<span class="c1">#   a newline separated list of key-value pairs describing the</span>
<span class="c1">#   the measurement.  Currently the only key used is "units". For</span>
<span class="c1">#   example, the configuration for a parameter may look like the following:</span>
<span class="c1">#</span>
<span class="c1">#     parameter_energy:</span>
<span class="c1">#       units=kWh</span>
<span class="c1">#</span>
<span class="na">history_field_{field_name}</span><span class="o">:</span>
<span class="c1">#   Optional history field description.  When provided the named</span>
<span class="c1">#   field will be tracked in Moonraker's Job History component.</span>
<span class="c1">#   The "field_name" portion of the option is the identifier used</span>
<span class="c1">#   when reported in the history.  Multiple history fields may be</span>
<span class="c1">#   added and tracked for a sensor.  See the "History Fields" note</span>
<span class="c1">#   for a detailed explanation of this option.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">History Fields</p>
<p>A <code>history_field_{name}</code> option must contain a series of key-value pairs.
The key and value must be separated by an equal sign (=), and each
pair must be separated by a newline.  The following keys are
available:</p>
<ul>
<li><code>parameter</code>: The name of the sensor parameter which is used to
    provide values for this field.  This name must match a field name
    set in the specific sensor implementation (ie: see the
    "state_response_template" option for the MQTT type.)  This must
    be provided.</li>
<li><code>desc</code>: A brief description of the field.</li>
<li><code>strategy</code>:  The tracking strategy used to calculate the value
    stored in the history. See below for available strategies.
    The default is "basic".</li>
<li><code>units</code>:  An optional unit specifier for the value</li>
<li><code>init_tracker</code>:  When set to true the tracked value will be initialized
    to the last sensor measurement when a job starts.  The "delta"
    strategy will initialize its "last value", setting this measurement
    as the reference rather than the first received after the print starts.
    Default is false.</li>
<li><code>exclude_paused</code>:  When set to true the values received when
    a job is paused will be ignored.  Default is false.</li>
<li><code>report_total</code>:  When set to true the value reported for all
    jobs will be accumulated and reported in the history totals.
    Default is false.</li>
<li><code>report_maximum</code>:  When set to true maximum value for all jobs
    will be reported in the history totals.  Default is false.</li>
<li><code>precision</code>:  An integer value indicating the precision to use when
    reporting decimal values.  This precision applies to both job history
    AND job totals.  The default is no precision, ie: no rounding will
    occur.</li>
</ul>
<p>Note that job totals for history fields only persist for a currently
configured sensor and history field name.  If the name of the sensor
changes, the name of the field changes, or if either are removed
from the configuration, then their totals will be discarded.  This
prevents the accumulation of stale totals.</p>
<p>Moonraker provides several history tracking strategies that can be used
accommodate how values should be tracked and stored in the job history:</p>
<ul>
<li><code>basic</code>: This strategy should be used if the value should be stored
  in history directly as it is received.  Simply put, the last value
  received before a job completes will be the value stored in the job
  history.</li>
<li><code>accumulate</code>:  When a job starts, the tracked value initialized to 0 or
  the last received measurement.  New measurements will be added to the
  tracked value as they are received.  The total cumulative value will be
  reported when the job ends.</li>
<li><code>delta</code>:  When a job starts the tracked value is 0.  The total value
  will be the delta between the final measurement received before the job
  ends and the first measurement received when after job begins.  Note that
  if <code>exclude_paused</code> is set then the tracker will accumulate deltas
  between pauses.  If the measurement does not update frequently this could
  significantly alter the final result.</li>
<li><code>average</code>: Reports an average of all measurements received during the job.</li>
<li><code>maximum</code>: Reports the maximum value of all measurements received during
    the job.</li>
<li><code>minimum</code>: Reports the minimum value of all measurements received during
    the job.</li>
<li><code>collect</code>:  Measurements are stored in a list as they are received.
  Duplicate measurements are discarded.  A maximum of 100 entries may
  be stored, the oldest measurements will be discarded when this limit
  is exceeded.  This strategy is useful for a sensor that reports some
  data infrequently and its desirable to include all measurements in the
  job history.  For example, the <code>spoolman</code> component uses this strategy
  to report all spool IDs set during a job.  When this strategy is enabled
  the <code>track_total</code> and <code>track_maximum</code> options are ignored, as it is not
  possible to report totals for a collection.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre id="__code_80"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_80 &gt; code"></button><code>history_field_total_energy:
  parameter=energy
  desc=Printer power consumption
  strategy=delta
  units=kWh
  init_tracker=false
  exclude_paused=false
  report_total=true
  report_maximum=true
  precision=6
</code></pre></div>
</div>
<h4 id="mqtt-sensor-configuration">MQTT Sensor Configuration<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt-sensor-configuration" title="Permanent link"></a></h4>
<p>The following options are available for <code>mqtt</code> sensor types:</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_81"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_81 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="na">qos</span><span class="o">:</span>
<span class="c1">#  The MQTT QOS level to use when publishing and subscribing to topics.</span>
<span class="c1">#  The default is to use the setting supplied in the [mqtt] section.</span>
<span class="na">state_topic</span><span class="o">:</span>
<span class="c1">#  The mqtt topic to subscribe to for sensor state updates.  This parameter</span>
<span class="c1">#  must be provided.</span>
<span class="na">state_response_template</span><span class="o">:</span>
<span class="c1">#  A template used to parse the payload received with the state topic.  A</span>
<span class="c1">#  "payload" variable is provided the template's context. This template must</span>
<span class="c1">#  call the provided set_result() method to pass sensor values to Moonraker.</span>
<span class="c1">#  `set_result()` expects two parameters, the name of the measurement (as</span>
<span class="c1">#  string) and the value of the measurement (either integer or float number).</span>
<span class="c1">#</span>
<span class="c1">#  This allows for sensor that can return multiple readings (e.g. temperature/</span>
<span class="c1">#  humidity sensors or power meters).</span>
<span class="c1">#  For example:</span>
<span class="c1">#    {% set notification = payload|fromjson %}</span>
<span class="c1">#    {set_result("temperature", notification["temperature"]|float)}</span>
<span class="c1">#    {set_result("humidity", notification["humidity"]|float)}</span>
<span class="c1">#    {set_result("pressure", notification["pressure"]|float)}</span>
<span class="c1">#</span>
<span class="c1">#  The above example assumes a json response with multiple fields in a struct</span>
<span class="c1">#  is received. Individual measurements are extracted from that struct, coerced</span>
<span class="c1">#  to a numeric format and passed to Moonraker. This parameter must be provided.</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Moonraker's MQTT client must be properly configured to add a MQTT sensor.
See the <a href="https://moonraker.readthedocs.io/en/latest/configuration/#mqtt">mqtt</a> section for details.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>MQTT is the most robust way of collecting sensor data from networked
devices through Moonraker.  A well implemented MQTT sensor will publish all
changes in state to the <code>state_topic</code>.  Moonraker receives these changes,
updates its internal state, and notifies connected clients.</p>
</div>
<p>Example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_82"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_82 &gt; code"></button><code tabindex="0"><span class="c1"># moonraker.conf</span>

<span class="c1"># Example configuration for a Shelly Pro 1PM (Gen2) switch with</span>
<span class="c1"># integrated power meter running the Shelly firmware over MQTT.</span>
<span class="k">[sensor mqtt_powermeter]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">mqtt</span>
<span class="na">name</span><span class="o">:</span><span class="w"> </span><span class="s">Powermeter</span>
<span class="na">parameter_power</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">W</span>
<span class="na">parameter_voltage</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">V</span>
<span class="na">parameter_current</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">mA</span>
<span class="na">parameter_energy</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">kWh</span>
<span class="c1"># Use a different display name</span>
<span class="na">state_topic</span><span class="o">:</span><span class="w"> </span><span class="s">shellypro1pm-8cb113caba09/status/switch:0</span>
<span class="c1"># The response is a JSON object with a multiple fields that we convert to</span>
<span class="c1"># float values before passing them to Moonraker.</span>
<span class="na">state_response_template</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set notification</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">payload|fromjson %}</span>
<span class="w">  </span><span class="na">{set_result("power", notification["apower"]|float)}</span>
<span class="w">  </span><span class="na">{set_result("voltage", notification["voltage"]|float)}</span>
<span class="w">  </span><span class="na">{set_result("current", notification["current"]|float)}</span>
<span class="w">  </span><span class="na">{set_result("energy", notification["aenergy"]["by_minute"][0]|float * 0.000001)}</span>
</code></pre></div>
<p>Tasmota Example:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It may be necessary to set Tasmota's Telemetry Period to a low value
to achieve a decent response.  This can be done in the with the
<code>TelePeriod</code> command via the console.  For example, the command
to set the telemetry period to 10 seconds is:</p>
<p><code>cmnd/%device_name%/TelePeriod</code> with a payload of <code>10</code>.</p>
</div>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_83"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_83 &gt; code"></button><code><span class="k">[sensor tasmota_power]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">mqtt</span>
<span class="na">state_topic</span><span class="o">:</span><span class="w"> </span><span class="s">tele/tasmota_switch/SENSOR</span>
<span class="na">state_response_template</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set resp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">payload|fromjson %}</span>
<span class="w">  </span><span class="na">{% set edata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">resp["ENERGY"] %}</span>
<span class="w">  </span><span class="na">{set_result("energy", edata["Total"])}</span>
<span class="w">  </span><span class="na">{set_result("voltage", edata["Voltage"])}</span>
<span class="w">  </span><span class="na">{set_result("power", edata["Power"])}</span>
<span class="w">  </span><span class="na">{set_result("current", edata["Current"])}</span>
<span class="na">parameter_power</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">W</span>
<span class="na">parameter_voltage</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">V</span>
<span class="na">parameter_current</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">mA</span>
<span class="na">parameter_energy</span><span class="o">:</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">kWh</span>
<span class="na">history_field_energy_consumption</span><span class="o">:</span>
<span class="w">  </span><span class="na">parameter</span><span class="o">=</span><span class="s">energy</span>
<span class="w">  </span><span class="na">desc</span><span class="o">=</span><span class="s">Printer energy consumption</span>
<span class="w">  </span><span class="na">strategy</span><span class="o">=</span><span class="s">delta</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">kWh</span>
<span class="w">  </span><span class="na">init_tracker</span><span class="o">=</span><span class="s">true</span>
<span class="w">  </span><span class="na">precision</span><span class="o">=</span><span class="s">6</span>
<span class="w">  </span><span class="na">exclude_paused</span><span class="o">=</span><span class="s">false</span>
<span class="w">  </span><span class="na">report_total</span><span class="o">=</span><span class="s">true</span>
<span class="w">  </span><span class="na">report_maximum</span><span class="o">=</span><span class="s">true</span>
<span class="na">history_field_average_current</span><span class="o">:</span>
<span class="w">  </span><span class="na">parameter</span><span class="o">=</span><span class="s">current</span>
<span class="w">  </span><span class="na">desc</span><span class="o">=</span><span class="s">Average current draw</span>
<span class="w">  </span><span class="na">strategy</span><span class="o">=</span><span class="s">average</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">A</span>
<span class="w">  </span><span class="na">report_total</span><span class="o">=</span><span class="s">false</span>
<span class="w">  </span><span class="na">report_maximum</span><span class="o">=</span><span class="s">true</span>
<span class="c1"># Multiple history fields may track the same sensor parameter:</span>
<span class="na">history_field_max_current</span><span class="o">:</span>
<span class="w">  </span><span class="na">parameter</span><span class="o">=</span><span class="s">current</span>
<span class="w">  </span><span class="na">desc</span><span class="o">=</span><span class="s">Maximum current draw</span>
<span class="w">  </span><span class="na">strategy</span><span class="o">=</span><span class="s">maximum</span>
<span class="w">  </span><span class="na">units</span><span class="o">=</span><span class="s">A</span>
<span class="w">  </span><span class="na">init_tracker</span><span class="o">=</span><span class="s">true</span>
<span class="w">  </span><span class="na">report_total</span><span class="o">=</span><span class="s">false</span>
<span class="w">  </span><span class="na">report_maximum</span><span class="o">=</span><span class="s">false</span>
</code></pre></div>
<h3 id="spoolman"><code>[spoolman]</code><a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#spoolman" title="Permanent link"></a></h3>
<p>Enables integration with the <a href="https://github.com/Donkie/Spoolman">Spoolman</a>
filament manager. Moonraker will automatically send filament usage updates to
the Spoolman database.</p>
<p>Front ends can also utilize this config to provide a built-in management tool.</p>
<div class="highlight"><span class="filename">Moonraker Config Specification</span><pre id="__code_84"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_84 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[spoolman]</span>
<span class="na">server</span><span class="o">:</span><span class="w"> </span><span class="s">http://192.168.0.123:7912</span>
<span class="c1">#   URL to the Spoolman instance. This parameter must be provided.</span>
<span class="na">sync_rate</span><span class="o">:</span><span class="w"> </span><span class="s">5</span>
<span class="c1">#   The interval, in seconds, between sync requests with the</span>
<span class="c1">#   Spoolman server.  The default is 5.</span>
</code></pre></div>
<h4 id="setting-the-active-spool-from-klipper">Setting the active spool from Klipper<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#setting-the-active-spool-from-klipper" title="Permanent link"></a></h4>
<p>The <code>spoolman</code> module registers the <code>spoolman_set_active_spool</code> remote method
with Klipper.  This method may be used to set the active spool ID, or clear it,
using gcode macros.  For example, the following could be added to Klipper's
<code>printer.cfg</code>:</p>
<div class="highlight"><span class="filename">Klipper Config Example</span><pre id="__code_85"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_85 &gt; code"></button><code><span class="c1"># printer.cfg</span>

<span class="k">[gcode_macro SET_ACTIVE_SPOOL]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% if params.ID %}</span>
<span class="w">    </span><span class="na">{% set id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">params.ID|int %}</span>
<span class="w">    </span><span class="na">{action_call_remote_method(</span>
<span class="w">       </span><span class="na">"spoolman_set_active_spool",</span>
<span class="w">       </span><span class="na">spool_id</span><span class="o">=</span><span class="s">id</span>
<span class="w">    </span><span class="na">)}</span>
<span class="w">  </span><span class="na">{% else %}</span>
<span class="w">    </span><span class="na">{action_respond_info("Parameter 'ID' is required")}</span>
<span class="w">  </span><span class="na">{% endif %}</span>

<span class="k">[gcode_macro CLEAR_ACTIVE_SPOOL]</span>
<span class="na">gcode</span><span class="o">:</span>
<span class="w">  </span><span class="na">{action_call_remote_method(</span>
<span class="w">    </span><span class="na">"spoolman_set_active_spool",</span>
<span class="w">    </span><span class="na">spool_id</span><span class="o">=</span><span class="s">None</span>
<span class="w">  </span><span class="na">)}</span>
</code></pre></div>
<p>With the above configuration it is possible to run the <code>SET_ACTIVE_SPOOL ID=1</code>
command to set the currently tracked spool ID to <code>1</code>, and the <code>CLEAR_ACTIVE_SPOOL</code>
to clear spool tracking (useful when unloading filament for example).</p>
<h2 id="include-directives">Include directives<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#include-directives" title="Permanent link"></a></h2>
<p>It is possible to include configuration from other files via include
directives.  Include directives in Moonraker are specified identically
to those in Klipper, ie: <code>[include relative_path]</code>.  The <code>relative_path</code>
is a path relative to the configuration file's parent folder, and may
include wildcards.  For example:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_86"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_86 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[include my_extra_config.conf]</span>

<span class="k">[include subfolder/*.conf]</span>
</code></pre></div>
<p>If a section is duplicated in an included file the options from both
sections will be merged, with the latest section parsed taking precedence.
The order in which a section is parsed depends on the location of the
include directive.  When wildcards are specified all matches are parsed in
alphabetical order.</p>
<h2 id="jinja2-templates">Jinja2 Templates<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#jinja2-templates" title="Permanent link"></a></h2>
<p>Some Moonraker configuration options make use of Jinja2 Templates.  For
consistency, Moonraker uses the same Jinja2 syntax as Klipper. Statements
should be enclosed in <code>{% %}</code>, and expressions in <code>{ }</code>.  There are some
key differences, as outlined below:</p>
<ul>
<li>Moonraker templates do not currently include globals like
 <code>printer</code> and <code>params</code> in the context.  Variables included in the
 context will be specified in the option's documentation.</li>
<li>Moonraker's template environment adds the <code>ext.do</code> extension.  The
  <code>{% do expression %}</code> statement can be used to modify variables without
  printing any text.  See the example below for details.</li>
<li>Klipper uses Jinja2 exclusively for evaluating gcode statements.  Moonraker
  uses it to provide configuration options that may need to change based on
  runtime parameters.</li>
</ul>
<p>For an example of how to use the <code>do</code> statement, lets assume we need to
send a specific json payload with an MQTT power device command.  Rather
than attempt to type out the json ourselves, it may be easier to create
a <code>dictionary</code> object and convert it to json:
</p><div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_87"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_87 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[power my_mqtt_device]</span>
<span class="na">type</span><span class="o">:</span><span class="w"> </span><span class="s">mqtt</span>
<span class="na">command_topic</span><span class="o">:</span><span class="w"> </span><span class="s">my/mqtt/command</span>
<span class="c1"># Lets assume this device requires a json payload with each command.</span>
<span class="c1"># We will use a dict to generate the payload</span>
<span class="na">command_payload</span><span class="o">:</span>
<span class="w">  </span><span class="na">{% set my_payload = {"SOME_FIELD"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="na">} %}</span>
<span class="w">  </span><span class="c1"># example of calling the dict.update method</span>
<span class="w">  </span><span class="na">{% do my_payload.update({"SOME_FIELD"</span><span class="o">:</span><span class="w"> </span><span class="s">"a string value"</span><span class="na">}) %}</span>
<span class="w">  </span><span class="c1"># Here we set the actual command, the "command" variable</span>
<span class="w">  </span><span class="c1"># is passed to the context of this template</span>
<span class="w">  </span><span class="na">{% do my_payload.__setitem__("POWER_COMMAND", command) %}</span>
<span class="w">  </span><span class="c1"># generate the json output</span>
<span class="w">  </span><span class="na">{ my_payload|tojson }</span>
</code></pre></div><p></p>
<h2 id="option-moved-deprecations">Option Moved Deprecations<a class="headerlink" href="https://moonraker.readthedocs.io/en/latest/configuration/#option-moved-deprecations" title="Permanent link"></a></h2>
<p>On November 7<sup>th</sup> 2021 a change to Moonraker was made regarding configuration of
<code>core components</code>.  Moonraker defines a <code>core component</code> as a component that
is required for Moonraker to function and is always loaded.  Prior to November
7<sup>th</sup> all core components were configured in the <code>[server]</code> section.  As
Moonraker's functionality expanded, this became untenable as the <code>[server]</code>
section began to bloat.  Thus a change was made to move the configuration
for <code>core components</code> out of <code>[server]</code> into their own sections.  This was
not a breaking change, Moonraker would fall back to the <code>[server]</code> section
for core component configuration if no section was present.</p>
<p>On April 6<sup>th</sup> 2022 the fallback was deprecated.  Moonraker will still function
normally if <code>core components</code> are configured in the <code>[server]</code> section,
however Moonraker now generates warnings when it detects this condition,
such as:</p>
<div class="highlight"><pre id="__code_88"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_88 &gt; code"></button><code tabindex="0">[server]: Option 'temperature_store_size' has been moved to section [data_store]. Please correct your configuration, see https://moonraker.readthedocs.io/en/latest/configuration for detailed documentation.
[server]: Option 'gcode_store_size' has been moved to section [data_store]. Please correct your configuration, see https://moonraker.readthedocs.io/en/latest/configuration for detailed documentation
</code></pre></div>
<p>To correct these warnings, the user must modify <code>moonraker.conf</code>.  For example,
your current configuration may look like the following:</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_89"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_89 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[server]</span>
<span class="na">host</span><span class="o">:</span><span class="w"> </span><span class="s">0.0.0.0</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">7125</span>
<span class="na">temperature_store_size</span><span class="o">:</span><span class="w"> </span><span class="s">600</span>
<span class="na">gcode_store_size</span><span class="o">:</span><span class="w"> </span><span class="s">1000</span>
</code></pre></div>
<p>You will need to change it to the following;</p>
<div class="highlight"><span class="filename">Moonraker Config Example</span><pre id="__code_90"><span></span><button class="md-clipboard md-icon" title="Copy to clipboard" data-clipboard-target="#__code_90 &gt; code"></button><code><span class="c1"># moonraker.conf</span>

<span class="k">[server]</span>
<span class="na">host</span><span class="o">:</span><span class="w"> </span><span class="s">0.0.0.0</span>
<span class="na">port</span><span class="o">:</span><span class="w"> </span><span class="s">7125</span>

<span class="k">[data_store]</span>
<span class="na">temperature_store_size</span><span class="o">:</span><span class="w"> </span><span class="s">600</span>
<span class="na">gcode_store_size</span><span class="o">:</span><span class="w"> </span><span class="s">1000</span>
</code></pre></div>
<p>The common front-ends provide a UI for modifying <code>moonraker.conf</code>, otherwise
it will be necessary to ssh into the host and use a tool such as <code>nano</code> to
make the changes.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure <code>moonraker.conf</code> does not have duplicate sections, and double
check to make sure that the formatting is correct.</p>
</div>
<p>Once the changes are complete you may use the UI to restart Moonraker and
the warnings should clear.</p>












                
              </article>
            <div class="raised adaptive-css" data-ea-type="text" data-ea-manual="true" data-ea-publisher="readthedocs" data-ea-keywords="3d-printer|klipper|python|readthedocs-project-646050|readthedocs-project-moonraker" data-ea-campaign-types="community|house|paid" id="readthedocs-ea-text-nostyle-mkdocs-material"></div></div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden="" tabindex="-1" style="top: 69px;">
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top", "navigation.instant", "navigation.indexes", "navigation.expand", "toc.follow", "content.tabs.link", "search.share", "search.highlight", "search.suggest", "content.code.copy", "content.code.annotations"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="https://moonraker.readthedocs.io/en/latest/assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="../src/js/compact-tables-qqTQvuZ9.js"></script>
      
    
  
<readthedocs-flyout></readthedocs-flyout><readthedocs-notification class="raised toast"></readthedocs-notification><readthedocs-search class="raised floating"></readthedocs-search><readthedocs-hotkeys></readthedocs-hotkeys>
